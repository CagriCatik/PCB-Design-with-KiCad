KiCad 7 STM32 Bluetooth Hardware Design (1/2 Schematic) - Phil's Lab #127 - YouTube
https://www.youtube.com/watch?v=nkHFoxe0mrU

Transcript:
(00:00) in this video we will go step by step through a complete Hardware design in kecat 7 for a Bluetooth capable stm32 microcontroller from Project creation through to drawing the schematic and figuring out the circuitry required laying out and rooting the PCB and finally ordering the boards at PCB way the board you are seeing here is something very similar to what we are going to create and features an st32 WB 55 microcontroller USB type-c connector for power and data as as well as a tag connect programming header and a chip
(00:32) antenna most of the design we will be creating in this video given the time constraints will be nearly identical however we will be using a generic UFL antenna connector instead of a chip antenna and won't root out all of the microcontrollers interfaces I will put relevant links in the description box below as well as timestamps of all sections of this video I really hope this video helps you design your own sc32 Bluetooth capable all projects and if it does please do leave a like a comment comment and subscribe for more
(01:01) Hardware design content in the future a huge thank you to PCB way for sponsoring this video the pcbs you saw at the beginning of this video were manufactured and assembled by PCB way those were four- layer boards and included double-sided assembly and they did a fantastic job I'll show you at the end of this video once we finish the design of our own sm32 Bluetooth capable Hardware what the ordering process is like at PCB way what files we need to submit and what the usual durations and costs are so make sure to check out that
(01:32) section near the end of the video make sure to go to pcb.com to check out their services but also make sure to follow them on Instagram to check out the selection of designs that PCB way have manufactured and assembled it has been about a year now since this video on keycard s32 PCB design came out and this was video number 65 on my channel where we went through a complete sim32 based Hardware design looking the schematic PCB design and how to get this manufactured in just under 2 hours this used a pretty basic stm32 F1
(02:04) microcontroller USB some peripherals and so on and this video will be another full tutorial except we are now moving to kycad 7 so I'd strongly suggest going to the kycad website and I'll leave links in the description below getting kecat 7 and following along I will assume a tiny bit of Prior Electronics knowledge and maybe that you've designed one or two pcbs beforehand but I will show you the entire process from creating the project creating the schematic all the way to PP layout and routing and then how to get this design
(02:33) manufactured other than using kecat 7 what you probably already saw from the title of this video is that we'll be using a Bluetooth capable microcontroller from St called the stm32 WB the specific part number we're using is this 55c I'll leave the specs in the link in the description below it's a very low power dual core arm cortex in4 micr contr controller it can run up to 64 MHz clock speed for one core and 32 MHz for the other and it has certain number flash memory Bluetooth capable USB and so on and I'll show you the
(03:04) basic circuitry you need to set this up to get this working how to do the RF Bluetooth connection and all the supporting circuitry the actual part of mouse so we can see here costs about $6 a piece in low quantities throughout this video I'll show you the relevant documents we need that help us design Hardware such as this for example application notes data sheets for external components or data sheets for the microcontroller itself and we'll look at other components we need that we need to add to our design to get this up
(03:32) and running the Border you saw at the beginning of this video used exactly this stm32 WB 55 microcontroller except for the RF part I used a chip antenna so a very small PCB based antenna whereas in this video for the sake of Simplicity we will be simply using an antenna connector and then you can attach whatever antenna you want to use before we continue please make sure you have keycard installed and ready and again just go to key cad.
(04:00) org and download the latest version for your operating system what I also strongly suggest you download when this is the tool we'll be using for the pinout and this is the tool you would typically use for example to program and write your firmware is called stm32 Cube IDE which is a free Eclipse based editor which you can download from st.
(04:18) com again I'll be leaving a link to this in the description box below once you have all of that we're ready to jump to creating our project we can only scratch the surface in one of these fairly short YouTube videos going through the whole design Des but I do have full length courses available via fedl and I'll leave a link to this in the description below signing up to courses really supports me helps the channel and allows me to make this free content I have a mix signal Hardware design course with kycad using kycad 6 but it's applicable
(04:45) to many different ecad tools as well as an advanced digital Hardware design course where you can learn how to design with BGA packages highspeed systems such as gdr3 memory fpga system on ships and so on again I'll leave a link to this in the description below and thank you so much for your support with key CAD 7 open what you need to do as a first step is go to file new project and then simply create a new project in whatever folder you want to and give it a name in key CAD we have several different steps we need to go through first all is of
(05:15) course the project then we need to create the schematic so the lecture called Drawing so to speak where we place components we wire them up add in the peripherals we need and so on before we can then later move for example to the PCB editor where we take what was on the schematic and then place the physical components so to speak and wire them up we'll start with a schematic editor right at the top so click on that this will then greet us with a simple blank schematic page I can of course just move my mouse cursor but holding
(05:41) for example middle Mouse button down and then moving my mouse let's you navigate across the page I can use the middle Mouse wheel to scroll in and out left click and drag to select right click opens up for example A Properties window I'll try to include of course the basic command as we go along but it does of course require a bit of practice to get familiar with them in key CAD the way we add symbols to a schematic is by looking at the right side of the toolbar this opamp symbol add a symbol we can click on that and key card contains a pretty
(06:10) large library of pre-made components so this could be from adcs connectors dodes resistors and so on and we'd simply open up one of these dropdowns and select the part we want click okay and add it into the design we can also use the filter the top for example if I type in R it'll immediately jump for example to the resistor I could double click on that move around on the schematic with my mouse I can zoom in with my middle Mouse wheel and click to place I can then right click cancel or simply press escape to cancel the command and now I
(06:41) have a resistor placed on the schematic the little node with a circle we see here indicates that this component or that end of the component is not connected to anything yet when I hover over this node with my mouse you can see this little kind of wand or line appears if I left click I can then draw a wire and again click click click and I can draw an arbit tree-shaped wire double click to finish the command or escape to cancel if you don't want to draw that wire and contrl Zed of course to undo as usual you might also seen on the right
(07:09) hand side under add a symbol we also have a shortcut a so I can just press a on my keyboard and that brings up the same menu I can type in for example C and that puts in a capacitor like so to copy a component I can simply click crl C and then CR V and then crl + v as many times as I want and place loads of different components other than for example Hing over the nodes to draw a wire I can also press W or go to the wire command on the right hand side and then I can draw my wire as usual other things we need to know are for example
(07:41) adding a power symbol so for example if you want to add ground or some sort of power net just 3.3 Vols and so on you would press P or on the right hand side click this ground symbol so if we click on that we hit a different menu we expand the power sections we get different predefined Power symbols as well as various different ground symbols as well so if I can click on a ground I could for example attach that to this resistor just as a very simple example additionally what we'll be using is add a net label on the right side we can
(08:10) either press l or click on this button on the right and this labels our Nets the reason we want to label our Nets and we'll see that on the PCB design later on is because if we click on this net and then look on the bottom left hand side we can see the connection name is net C1 pad 1 net C1 pad 1 doesn't tell us particularly much however if we for example give this a net label so press l or click this button and then we call it for example RC and this is a very very crude example and then we place this net label on our net cancel the command and
(08:41) then click on the net again we can see the connection name has now changed to something maybe more sensible such as RC and we'll see this in more detail later on for example when we're hooking up USB and so on we need to use net labels there are of course many many other commands and we'll probably explore them or some of them as we progress through this video with the basics out of the way we can drag and select with our Mouse and press delete on our keyboard and again we start with empty schematic so now we have the basics out of the way
(09:09) the bit I would like to start with is our s32 WB microcontroller and in particular we'll be using the s32 WB 55 ce6 and this happens to be a qfn style package with 48 pins and you can read more about the specifics in the data sheet which I'll leave in the links in the description below so this is the first part I would like us to add to our key cut schematic because this will form pretty much the centerpiece of the design and we will be designing around this part as we'll see this part will require some external circuitry we might
(09:40) want to add some peripherals for example some uard connections or programming interface and so on so it does make sense to start with our centerpiece for this specific design so going back to keycard again we can press a or on the right hand side go to the toolbar I'll press a and then we can look for our microcontroller so s32 WB 55 ceu and luckily enough and nicely enough for us the key libraries already include this part and you can see it's within Little X at the end because there are different variations of this part but this fits
(10:10) our description quite well typically I'd strongly advise against using third party libraries especially ones you download off the internet because they many many times contain errors they're not consistent and it's much better to create your own symbols and Footprints and we'll see how to do that later on as well but in the case of the keycard libraries they are pretty decent so that's why for this this is okay and also for the sake of time so click on this we can double click move around and we'll place this somewhere in the center
(10:37) of our schematic escape to cancel and then we can zoom in to look at this part this is a microcontroller so it has a lot of many many generic pins and these are arranged into banks for example PA pa1 2 3 up to PA 15 are assigned to pins on the package the physical package so PA not is mapped to pin 9 on the physical package pa1 to 10 and and so on we also have a second bank so PB not which are mapped to different pins left hand side we have PC we have pH P4 and these are generic gpio let's call them and they might have certain constraints
(11:11) which we can get from the data sheet or from other software which we'll see later on we also of course have power pins because we have to power this active device and these typically sit at the top of a symbol so we have vdd which is digital voltage input so to speak we have vbat if you want to connect this to for example a Battery Source when vdd is disconnected we have vdda which typically references to an analog Supply vdd RF RF being radio frequency so we can assume what that is and some other pins as well which we'll explore
(11:39) throughout the design at the bottom we also have vsss pins and vsss are typically ground pins or negative Supply rout pins we have vsss vsss RF and vsss smps or switch mode power supply and we'll see why we need that later on of course there are many other pins and this depends on what M controller you're using you might have oscillator input pins you might have a reset pin programming interface pins it depends on the mic controller but we'll see for example for the STM 32 line how we can find out what we need to connect where
(12:09) how to choose our pinouts and so on on that note the first place you should pretty much always look is the data sheet the data sheet will tell you the main aspects of what this Mar contral is capable of so for example core frequencies what the supply voltage rails ranges are what crystal oscillators they support what Memories they have what peripherals they have and so on so it really make sense to look through the data sheet and we could work through the data sheet and then simply carry over that information to our mic
(12:37) controller design in kecat now this is of course perfectly fine but it's a bit tedious because they have other tools available other than the data sheet there are usually application notes or evaluation kits provided by the manufacturer in the case of the RF line for the s32 mic controllers St provides an application note 5165 titled how to develop RF Hardware using sd32 WB microcontrollers this is the document we will be referring to quite a bit because it provides reference designs and external components we need to get the
(13:10) basics up and running for our stm32 wireless or Bluetooth microcontroller we can see here that they have a section on reference board schematics how to choose components for example external capacitors inductors how they might do layout and routing and so on and this is a document in particular for the reference board schematics if we click on that we can see there have just the basics already set up for various microcontrollers and different packages so for example on page 13 we are also using the part which has a qfn 48 pin
(13:40) style package and this is the schematic we will be referring to just to save ourselves quite a bit of time of course we'll look at some rules of thumbs and guidelines and why these components are there so I wouldn't recommend just blindly copying what you see in a reference design but understanding why these components are't there and we'll talk through that as we progress through this video on another note so other than looking at data sheets and application notes you should also look at the firmware or software that the
(14:06) manufacturer provides in this case this was stm32 QBE IDE which we saw near the beginning of this video I have stm32 QBE IDE open and downloaded and I'd strongly suggest if you'd like to follow along to download this as well and start it up at the moment in Q we can go to the top left file new stm32 project and this brings up this MCU selector panel so they have all the microcontrollers or pretty much all the microcontrollers St manufacturers and we can pick one of them and use that for our project the one we would like to use is of course
(14:38) the sim32 WB 55 ce6 so I type this into the commercial part number field at the top and we're presented with two options here and we'll just go with the cuu 6 variant we can immediately see that it's active so it's still recommended for new designs we can see the package type the amount of flash Ram I/O core frequency and so on so we click on that click next give our project a name and we can click finish for now what we're using s32 Cube IDE for is to do basic pinout planning as we'll see this is incredibly useful
(15:09) interface for these types of microcontrollers to do pinout planning immediately after project creation we're presented with this ioc window oroc file and this is a top- down view of the physical package of our microcontroller at the top left we can see if we hover over a pin this is pin one then pin 2 3 4 5 so they're arranged in this kind of counterclockwise fashion as they are on the actual package itself we can see this package has 48 pins and we'll later see that we actually have a 49th one which is underneath which is an exposed
(15:41) Pad but more on that later but we have some pins that are different colors for example this vdd is this kind of beigey color I believe it is so if you hover over that we see vdd is power if we hover vbat that's power bdda is power bdd and so on we can see all these power pins other than that we can also see some other colored pins so for example n reset I don't know is that yellowish green that's pin seven and this tells us maybe this is something to do with reset then these 81 pins got a different color but also these oscillator so OS out and
(16:14) Os in as well as the RF pin rf1 pin pin 21 also has a different color so immediately we can see these might have different functions we might need to pay extra care to those pins other than those pins we also have these kind of light gray pins so for example pc40 pb8 pb9 PA 1 2 3 and so on and these are our gpio moving back to the schematic just cross referencing these are these PA to pa15 pins PB to pb9 and so on and what we also just saw were the vdd vsss pins and so on so in this case vbat vdd and so on are fixed pins they are power
(16:49) input we can't move them around but for example pb8 if we left click on it we can see the different options we have for that pin so this could be an i c clock line or it could be a simp simple gpio input or it could be a timer Channel if you look at pb1 this has different options it could be a low power timer or paa to the bottom this could be a masterclock output or an ADC input and so on so in this way because microcontrollers are so flexible the pins are Multiplex so one pin can do many many different functions but really
(17:18) only one at a time so this is how we do our pinout planning we would see what functions do we need do we need an ADC then we might select this pin and select okay we want ADC here this pin needs to be I don't know SP SPI clock pin and so on what we can also do rather than clicking on individual pins and then figuring it out that way we of course could go to the data sheet route or on the left hand side you probably will have already noticed we have various categories so if we go to connectivity we can see we have two I C's available
(17:47) if I click on one of these I C's open the drop down select i c we can see stm32 QBE IDE already maps pb8 and pb9 to ice C clock and data if I control click on one of these pins you can see pb6 now starts to flash and this is because pb6 can also do iqu C1 scl so I could remap it there and pv9 I could remap it to pv7 or P 10 the flashing pins why we would want to do this this is when we come to the PB layout and rooting stage if we have flexibility and we're not using all the pins of the microcontroller we can simply rearrange
(18:22) for example this ice SE to be up here if this means it's closer to a peripheral or closer to a connector this is a really nice thing about microcontrollers and fpj's is that they are rather flexible within reason and we can see this within reason part by using these tools so for example if I want to enable USB I click on USB enable it as a device and then the pins are Mount to PA 11 and pa2 if I control click on these pins we can see there's nothing else flashing and this is quite often the case for maybe higher speed peripherals such as
(18:52) USB is that their functions cannot be remapped to different pins so that internally it's fixed mapping to p 11 and pa2 the same thing we have at the bottom here at this RF pin the RF pin is a very very important pin as you might have expected this is the radio frequency or Bluetooth interface to our antenna and this of course can't be remapped either we now have all of the basics in place to start the schematic properly we really have our centerpiece our stm32 WB 55 microcontroller we know approximately what these pins are and
(19:25) now we need to figure a way of how to hook them up or to connect them to and so on given that this is a somewhat short video and a very condensed video I won't be making a full board with this but rather I want to show you how to choose fals how to map them out and how to connect out the main essential circuitry of this device first thing I want to do and will this will become a bit clearer later on is Select this part and then press X on my keyboard and that rotates it or mirrors it around the Y AIS then I can take these labels click
(19:54) and then drag just to move them into place we can see we have two labels s of speak the bottom is our part number and the top is what's called a reference designator so this designator needs to be unique to whatever component we have on our schematic so we might have many different components we might have a couple different microcontrollers or processors and we have three microcontrollers we have U1 U2 u3 there different resistors it would be R1 R2 R3 and so on and so forth they are unique identifiers for components on our PCB
(20:23) and components on our schematic the part number isn't quite correct either so I'll double click on that and change the X to CU 6 the first thing I'd like to do is connect my ground pins right at the bottom to ground so as we saw at the start we can add a power symbol or press p and I'll add a ground double click and place it at the ground pins now I personally don't like having the ground label showing I think it's fairly obvious from the symbol of what this ground is so I'll double click on this and hide the value then I'd like to
(20:53) connect up my ground flag or my ground symbol to the vsss pins which are the ground pins of our microcontroller so I can press W and click and root all of these pins up like so and this means we have now pins 32 22 and 49 all hooked up together to ground at the top side of our device or at least in the schematic we have all these power pins so we have VD USB s smps RF vdda vdds and so on now this can be quite confusing knowing what voltages to hook these pins up to again we could either refer to a reference
(21:25) design such as from this application note and we can see what they're doing for this particular part they've hooked up vdds and V bats Al together but then they have a separate vdd USB but they're actually connecting vdda also to 3.3 volts another place we could of course look is of course the data sheet for example section 3.
(21:44) 7 looking at Supply management and this will tell us all about various configurations of our power distribution what external components we need what voltage ranges we have on various pins so for example here vdd can be 1.71 to 3.6 Vols vdd da a has a different voltage range vdd USB has this voltage range and they tell us more about these different pins to give you a condensed answer typically vdd pins are what your logic levels are if you're interfacing your microcontroller to other peripherals that also run off 3.3 volt logic you would of course want
(22:15) to run vdd your core or your IO voltage also off the same voltage vdd therefore typically for mic controllers will be for example 3.3 Vols for low power designs this might be 1.8 Vols but you can go anywhere in the range that data sheet allows you to the vdda pin pin 8 is the analog supply pin because the a at the end and this is a separate supply to the vdd pin which is the digital Supply because the vdda pin feeds for example analog to digital converters or in certain cases Dax so digital to analog converters so vdda pin 8 might
(22:50) need some extra filtering to maybe isolate it a bit more or reduce the noise from the digital Supply bdd RF feeds the RF front end so this will feed for example our Bluetooth front end vbat we can connect to VD if we're not using a battery or connect to a separate Battery Source if we are using a battery for example if vdd is disconnected vdd USB Powers the USB transceivers within the microcontroller and this can be a separate Supply to vdd so for example a vdd is only at 1.
(23:22) 8 volts we saw from the data sheet that vdd USB needs to be 3.0 to 3.6 volts so for example we you could power vdd USB separately to vdd if you need different voltages this part is a bit peculiar because we also have this vdd s smps and snps stands for switch mode power supply these s32 WB microcontrollers have several low power modes and it can generate its own internal voltages and it can generate its own voltages using its own switch mode power supply or switcher so this would take an input voltage at 34 pin 34 and it has a switch node at Pin 33 and
(23:56) it can generate its own voltages and we'll look at this in detail in just a second my recommendation if you haven't done this before is to just follow the application notes so for example here they've tied everything pretty much to 3.3 Vols also the vdda they've tied without extra filtering directly to 3.3 volts also the vdd s smps pin 34 they've tied to 3.
(24:20) 3 volts but vdd USB they've tied to a separate voltage which seemly they've tied to a header what we'll do in our case we'll follow this we'll tie everything to 3.3 volts but also vdd USB to 3.3 volts meaning the USB transceivers are active all the time and this is just for Simplicity you've course can change this depending on your power supply scheme requirements if you need lower power modes if you don't want the USB transceivers enabled and so on but we will TI everything to 3.
(24:46) 3 Vols for Simplicity what we'll also see is that we have what's known as decoupling capacitors placed next to these pins so we have these 100 nanopar capacitors usually but then we have these larger for example 4.7 microfarad capacitors connected up to these pins anti- coupling capacitors very simply speaking provide a local energy storage right next to the relevant pins so this is hard to see on the schematic but once you come to PCB layout and routing later on pin 20 will be a physical pin on the device and we want to place a decoupling
(25:18) capacitor very close to that pin 20 this is so that we have a local energy storage so when our microcontroller through pin 20 draws a sudden burst of current this can be supplied directly by our local energy Reservoir very simply speaking which is a short low inductance connection from C10 or whatever capacitor is close to that pin so we typically have 100 narad capacitor per pin so as we can see here we have 20 35 48 and 1 so four pins and therefore we have four individual 100 narad capacitors same thing for vdd USB this
(25:53) has its own local decoupling capacitor then we have some exceptions to that rule sometimes manufacturers recommend specific values for decoupling capacitors so example for vdda they recommend c17 and c18 to be 1 microfarad and 10 nanofarads and for example the vdd S smps 4.7 microfarads and 100 nanofarad and this should always be taken with a slight pinch of salt typically paralleling different types of capacitors is not a good idea and typically also not necessary so in our case I would simply Place one 100 Nar
(26:26) capacitor close to vdda and for the switch mode power supply we do have a requirement that we need quite a large capacitance and we'll see where that comes from in just a second but in general one 100 narad capacitor per Power Pin is what we want we also have noticed C6 on the left side here which is a 4.
(26:45) 7 mic capacitor so quite a bit larger than these 100 Nan capacitors and this is what's known as a bulk Bypass or bulk decoupling capacitor this is a capacitor that should be somewhere close to the device it's a bit of a larger local energy storage but doesn't have to be particularly close to any individual pin it should just be placed close to the package of our microcontroller simil on the reference design we also see we have vdrf from the top right corner and here they also have two paralleled capacitors so 1 C1 at 100 narad and a C2 at 100 picofarads for the vdd RF section
(27:18) again paralleling capacitors only really makes sense if the package sizes of the components are vely different so if we're using a very very large package so very physically large pack package with this 100 narad capacitor and a comparatively much smaller package for this 100 picofarad capacitor then okay it might make sense to place C2 close to p23 in a much smaller package and C1 is then a bit further away as we'll see later in the PCB design but for modern packages and because we'll be using very small packages in this design anyway we
(27:48) could typically get away with just 100 narad capacitor placed at pin 23 so in essence going back to keycard what this all boils down to is that we have the these power pins at the top and they all need their own decoupling or bypass capacitors so we have 1 2 3 4 5 6 7 8 so we have vbat 3 times vdd vdda vdd USB so they all need 100 nanofarad and then we have vdd smps which needs a 4.
(28:15) 7 microfarad capacitor and vdd RF which also is tied to 3.3 volts which also needs 100 nanofarads the way I would like to then organize my schematics just to make it easier then for the PCB layout and routing is to place capacitors where they need to be and also segment them in certain sections so to me pin 40 vdd USB vdda the three vdds and vbat belong together vdd snps is its own entity and vdd RF is its own entity so to add a symbol press a look for C or type in C and then we'll select this capacitor we'll just Place one press
(28:49) escape double click on the C value and we'll change this to 100 narad I can then press the Y command so w to start drawing y and I'll start with vbat and I'll just hook up this one section so vdd USB vdda the three vdds and vbat and this is one section it's good always to deliver design intent within the schematic already for example you have separate PCB layout engineers and schematic or Hardware designers to deliver intent so we have vdd USB 1 2 3 4 5 6 so we need six of these capacitors I can drag and move contrl C and I want
(29:25) six of these these six should hooked up to the connections we just made and the bottom side of these capacitors should be ground so we can just copy the ground symbol we had here so drag contrl C and just place it below the capacitors and again just the wire tool with W hook these up like so I'd also like to add in a bulk capacitor just for these pins so I can again either just copy these so I've placed another capacitor I can change the value to 4 U7 which is the same as 4.
(29:57) 7 microfarads so now we have all these pass is hooked up to these specific power pins what I'd like to do is add in 3.3 Vol symbol so I can click on this symbol on the right side add a power symbol or press p and then we can look for 3.3 volts and we'll take this one here move it to the top of these capacitors W to change to Wi tool and now we have a 3.
(30:16) 3 volts hooked up to these pins now we still have to hook up the vdd snps and the vdd RF section so simply take C7 and C1 and create this structure which ties in directly to vdd smps and this is how I would segment my schematics so this immediately shows me for example C8 C9 in this case belong to 34 now of course you could put all these capacitors in just in a single row because they're tied to 3.
(30:46) 3 Vol in ground but this to me compartmentalizes the schematic a tiny bit more then we have our vdd RF section which ties up in our case just to 100 Nar capacitor of course if you want to you can follow the hardware reference design guide but I found this 100 Pea farat in parallel as long as the package size is sufficiently small doesn't matter and doesn't add anything so that's why we were just using 100 nanofarad capacitor and this is how easily we've now hooked up our power and ground to our micro controller so very simple we tied all our grounds to ground
(31:16) and we figured out using the data sheet and reference design guides what the power pins need to be tied to keep in mind this depends on the scenario if you want to use the switch mode power supply if you want to do some filtering on the vdda pin if you have an external battery and so on but for our just USB powered case this is completely sufficient now that we have our power supplies in place at least most of them we need to look at the next section of the essentials to get this microcontroller up and running
(31:45) and these pins happen to live on the right hand side of this symbol so for example the other parts of the switch mode power supply so snps vlx so pin 33 pin 31 as well as the crystal oscillators we have to attach to some of these pins and of course the RF section again referring to the data sheet for example section 3.
(32:07) 7 we can look at the power supply distribution section and see that this part as we saw before contains a switch mode power supply that we can either use or not it also tells us that the switch node power supply step down converter improves low power performance with a sufficiently high vdd voltage as we said before the Switch Road power supply can regulate vdd down to a lower Supply voltage again for low power mode so we would like to use this so therefore we can see on the snps configuration in the data sheet we need this inductor L1 connected between vlx
(32:41) and vfb as well as this C2 capacitor luckily enough Table Six gives us typical component values as well as part numbers for these parts so C2 should normally be 4.7 microfarads and they gave us a suit or part number just in case and L1 depends on the switching frequency of the switching power supply so for 8 MHz switching frequency we need 2.
(33:07) 2 micr Henri's for 4 MHz we need 10 microhenry what is also not actually shown in the top picture but only shown as a footnote in footnote 2 we need two Series inductors so we need L1 a and l1b very simply speaking we need an extra 10 nah Henry inductor again they're giving a part number in series with L1 to apparently improve the receiver performance it turns out for L1 at least our main bulk inductor let's call it we are running actually at 4 MHz switching frequency and that's why we need this larger 10 Micro Henry inductor and then we can see the footnote 4 we would
(33:38) choose for example a Morata part titled as so and we could of course also just take this information from the application node where we see the vlx vfb pins we have this 10 nah Henry Siri inductor 10 microhenry bolk inductor let's call it and a nominally 4.7 microfarad capacitor and this is how we need to hook it up remember we already hooked up vdd snps with our bulk and 100 narad capacitor to 3.
(34:04) 3 Vols so that's our power supply input and we hooked up the vsss switch mode power supply pin to ground so now with this information taken from the data sheet taken from the application notes we can add this into our schematic unfortunately the key cat schematic part isn't particularly great because it splits up vlx and vfb between these oscillator pins so this could become maybe a tiny bit messy in any case we want to add a part so what we do is as usual press a and we want to add an inductor so I'll type in l and this will jump immediately to inductor I can
(34:35) press R to rotate the component on my keyboard so we want one inductor here copy that and we want another inductor remember we want the 10 Nan Henri and the 10 Micro Henri's and then we want our output capacitor so I'm just going to press escape to cancel and I'm going to copy one of these 4.7 microfarad capacitors at the output the wire tool or just click on the nodes to join these components up and remember vfb smps needs to connect to the output after the inductor so you could either draw this in here but technically it should be
(35:08) taken at the output after the capacitor and this just shows a bit of design intent but for the sake of Simplicity and keeping the schematic a bit neater I'm just going to move the connection like so remember the other side of this capacitor needs to connect to ground so I'll just copy a ground symbol place it and hook it up now let's type in the component so for L1 we want the 10 nano Henry inductor first as taken from the application note and the 10 Micro Henry inductor afterwards remember we talked earlier also about net labels and this
(35:38) is the first place where we'll add some net labels without net labels if you just click on for example this y segment here looking at the bottom left we see net U1 vlx S&S which as itself is an okay netname it kind of tells us what it is but we could just simplify that by adding a net label so either press L on on the right hand side add net label and I'll just call this s smps LX and place it on the net and then I just want to make it smaller I'll make this text size to for example 0.
(36:10) 5 and this way now we have switch mode power supply LX this tells us it's the switch power supply and it's the switch node I can copy this net label put it over here and keep in mind this might not be the greatest of net names but SM lxl is the junction of our inductors and then we copy this net label again put it down here and this is effectively the feedback snps so that's what I'll label it like so and this might not seem particularly important now in the schematic but it does help us quite a bit when we come to the PCB design because we instantly see without
(36:42) having to jump back to the schematic but this net is the feedback or the output of our switch node this is the feedback pin and this is the switch node pin for example so now we've moved over all of the power as well as the switch mode power supply section of the microcontroller to get this part up and running before we can for example interface with gpio various interfaces such as art i c and so on WE of course want to use Bluetooth functionality so we'll have to hook up pin 21 which is this rf1 pin and this needs to be hooked
(37:12) up to a matching Network antenna and so on and we'll get more to that in just a second but also we need a programming interface and this could be J tag it could be serial y debug but we also need crystal oscillators now this part does have oscillators but for timing and also for low power modes we need to attach both a highspeed external Crystal so to pins 25 and 24 this will be a 32 MHz Crystal but also to pins 2 and three this will actually be a low speed external Crystal or lsse for short this needs to be a
(37:43) 32.768 khz crystal so let's attach those next we can get the required Crystal parameters again looking at the data sheet so for example section 6.3.1 looking at external clock Source characteristics so again we have the high speeded external which is a 32 MHz Crystal oscillator or of course you can supply just from a seos oscillator and needs to be in the range of 68 Pat of load capacitance similarly for the lad speed external Crystal this needs to be a 32.
(38:14) 768 crystal resonator we can see how these crystals might typically be attached for example for the lsse the low speed external we'd have the pins on the microcontroller and internally it has an amplifier and Driver externally we have the crystal resonator and sometimes these crystals include the load capacitors and sometimes we'll have to place these external load capacitors around the crystal as well for the high-speed external Crystal which is fairly unique to this specific part we can see the data sheet says the device includes internal programmable
(38:41) capacitances that can be used to tune the crystal frequency so the nice thing is for the highspeed external part we actually don't need to supply external load capacitors around the crystal now I know I'm just skimming over Crystal oscillator design for microcontrollers but St actually does have an application note this is application note 2867 and I'd strongly suggest you read through this or at least skim through this before you continue this tells you why you need a crystal oscillator why we need load capacitances to get these
(39:11) working and how to tune the frequency and how to compute the value of these load capacitances such as these formulas here and how to estimate for example stray capacitances how to calculate external resistances and so on I know it's fairly lengthy at about 60 pages but it's well worth a read because a lot of mcus and a lot of scenarios might require the use of an external Crystal also going back to s32 cube IDE we can see those oscillator pins on our configuration window so in the bottom right we can see oscillator in pin 25
(39:43) oscillated out pin 24 if we go to system call on the left hand side click on RCC and then highspeed Clock Crystal ceramic resonator those pins are then enabled so this is the highspeed external Crystal and the low speed clock or that lsse low speed external we'll select a crystal ceramic resonator and we can see those are pins pc14 and pc15 so these are the pins that we need to hook up our crystal oscillators to and just as a little preview you might have already noticed the clock configuration tab at the top
(40:13) here if I click on that we can see on the left hand side we have our Crystal oscillator input frequencies so at the top we have the lsse at 32.768 and this is a fixed frequency and for the hsse this can actually seemingly be a variable frequency anywhere from 4 to 48 with 32 MHz is the recommended hsse and internally to the micr controller there are various PLS so phase lock loops and this lets you step up and down the frequencies to then clock for example the cores or the various peripherals in the device but it's important that we do
(40:44) Supply a low- speed external and a highs speed external Crystal at the pins we just saw so back in keycard remember pin 25 pin 24 is for the highp speed external pin 2 and pin 3 or pc14 pc15 is for the low speed external again in Key Cat a to add part I'm just going to type in Crystal and we have many different choices so we have just a two pin Crystal we have a three pin Crystal with pin two on ground there's a four pin Crystal with pins two and four on ground and so on typically high-speed external crystals so in the megahertz range
(41:18) typically come in these Crystal ground two four packages where we have one and three are the main Crystal Terminals and pin and two and four are effectively connected to the casee which are grounded so the high speed external will use this schematic symbol and we'll press a again and for the 32.
(41:36) 768 crystal we will actually use the two pin crystal symbol because the low speed external crystals typically come in this kind of configuration so I'll choose this symbol here like so I typically also give my crystals not the identifier y but the identifier X so I'll call this X1 and I'll give this the designator X2 we can immediately instead of having Crystal I'll type in the actual ual frequency so that's 32768 khz and our high speed external was 32 MHz and I can drag just to clean up these parts of the schematic already now again unfortunately this schematic
(42:10) symbol the keycard default one isn't particularly great because now we're going have to have a bit of a messy schematic to rout for example pins 25 and 2024 to the high speed external and pc4 pc15 is somewhat okay so pc14 pc15 is the low speed external sometimes the crystal itself can include the load capacitors but in the case it doesn't and want to design maybe for most use cases we'll add in the load capacitances externally so I'll place a capacitor so I'll press a type in C place the capacitor and we'll place in two load
(42:44) capacitors around our device so maybe something like so just cleaning these up just a tiny bit can mind this is fairly crude W to draw a wire and this is how we then hook up our Crystal so so to the load capacitors and then the crystal in between so to speak the other side of the load capacitors will hook up to ground so I'll copy a ground symbol W for wire and there we go now we have pc14 pc15 hooked up to an external Crystal oscillator this is our low speed external two load capacitors and the values of these will leave as not
(43:17) defined for now because we'll do that later when we choose the actual part because these loow capacit again referring back to the application node by St depend on the type of Crystal we choose nicely enough for the highspeed external so this 32 MHz Crystal oscillator the load capacitors are actually effectively inside the MCU and these are tunable so we don't actually have to supply external Crystal load capacitors for the highspeed external we simply just have to root it out and again I apologize for this symbol which
(43:46) is the keycard default but it makes me rout past all these sections and I don't really like the look of this so I apologize like so and oscillator in maybe something like so then of course we have pins two and form so effectively connected to the casing of the crystal I want to ground though so I'll copy a ground symbol W for my wire and connect pins 2 and four like so and again you can clean up the schematic as much as you want you always want to keep it legible if you can so spacing things out keeping things connected VI yse if you
(44:20) can and then of course adding net labels I'll just copy net label contrl c contrl v double click and then I'll just call it hscore in and hscore out now keep in mind in this configuration we haven't added any series resistors and series resistors for example looking at the St application node a 2867 page 21 typically we would want to add this RX so an external resistor a series resistor which is the output of the amplifier internal to the microcontroller which feeds the external Crystal oscillator circuitry the reason
(44:55) we would want to to place RX is to limit the drive strength to the crystal so we don't distort the crystal which could reduce its lifespan but also RX in combination with the capacitance that follows forms a low pass filter and that can filter out some of the higher frequency harmonics in case of distortion I would typically always advise to place a series external resistor even if it's just a zero ohm resistor to start with because you can increase the longevity of your product and you might need to tune this value in
(45:24) any case please refer to application node 2867 to figure out how to calculate the value of the resistor this depends on the drive strength of the amplifier the crystal you've chosen and so on but for the sake of Simplicity and because it does in many cases work without this and for this very simple video we'll leave it without but please do keep this in mind back to the net labels hsse in I'm going to copy here and this is of course our lowp speed external and our low speed external and there we go now we've done all of our net labels we've
(45:55) hooked up our Crystal oscillators keep in mind the structure and the flow of key CAD is that we simply Define component values yet but we actually haven't assigned specific Footprints so sizes of these components and we haven't assigned specific part numbers in keycard the flow is a bit odd in my opinion but this is just the way we'll do it for now we're getting close to having the main structures in place that allow this microcontroller at least to boot up of course you still need a power source USB connection and so on but the
(46:24) main external circuitry for this microl is getting close to be done importantly now we would like to look at this RF section and this is quite a bit more involved especially if you haven't seen this kind of stuff before so pin 21 rf1 which is eventually effectively an rfo port for Bluetooth in this case RF design can seem a bit intimidating to start with but luckily manufacturers such as St make this process very simple and tell us pretty much exactly what to do and again for this we refer to a 5165 the if have Hardware application node
(46:56) for s32 WB microcontrollers the RF section we have a ground pin so pin 22 we have the vdd RF which you already looked at before and we have pin 21 which is the next step we want to look at now very simply speaking and of course I'm just glossing over the details at the moment rf1 that pin has a particular impedance that needs to be matched to whatever we're connecting it to if this is an SMA or UFL connector or some antenna a chip antenna PCB antenna so on we need to match those impedances otherwise we don't get maximum power
(47:30) transfer we get less signal strength and it might not even work at all so following from the rf1 pin we need to do an impedance matching Network and this is something shown here so this is a pi impedance matching Network consisting of a capacitor inductor capacitor this then matches this rf-1 pin to a 50 ohm characteristic impedance that we might see for example at an antenna what we also need in the case of these sm32 WB microcontrollers is following the matching Network we need a low pass filter and they are recommending a
(48:02) specific low pass filter here which is specific for these 2.4 GHz Bluetooth frequencies and this is to reduce the out of band interference and again taken from this application Noe so we have the rf1 pin we have this Pi matching filter made up of discrete components then this low pass filter and then in our case we will place a UFL so very small antenna connector you could of course get with SMA or Trace antenna or a chip antenna for most flexibility and because of the size I will go with a UFL connector and
(48:33) here this is what a UFL connector typically looks like there's these very small RF sockets and they're also rather cheap the low pass filter St recommends is this TDK part if you look at the data sheet it's a low pass filter for the frequency Band 2 1/2 to 2.5 GHz it's a rather small package 1.6 mm by 0.
(48:55) 8 mm four pins so it has effectively ground and IO and this is something we need to create our own symbol and footprint for but let's start off with adding in this matching Network luckily for us they also give us immediately the component or the manufactured part numbers so we need a 0.8 Paar capacitor 2.
(49:13) 7 Nano Henry inductor and a 0.3 pikaar capacitor so let's add that in going back to key CAD let's add in a capacitor so again a and then C I'll add in a capacitor add in an indu so a and then l r to rotate you can of course just do this by copying components as well whatever is easiest component values we take from the application node so 0.8 2.7 0.
(49:40) 3 and you can see instead of doing dots what youve probably already noticed is that I do for example Nano or Pico first so I do Z Pico 8 and this to me is far easier to read dots are often times very hard to read so that's why I do this kind of designation so from our rf1 Port we simp simply take a wire and feed that in to our capacitor inductor and the output capacitor inductor this is our matching network of course we still need a ground connection example like so and this then needs to feed into this low pass filter
(50:11) so have RF pin feeds into our matching Network feeds into our low pass filter then feeds into our antenna or antenna connector so now we need to move over to create our own schematic symbol and PCB footprint because if we go to a add components we can see we don't actually have this dlf low pass filter as part of the symbol library and there's no alternative as we can see so far so we have to create our own schematic symbol and footprint first let's start off with creating a schematic symbol for this part to do that all we need is pretty
(50:43) much the data sheet now data sheets will always vary sometimes data sheets will not contain all the information you need but typically they will so for this TDK part you can go to the TDK directly or I typically always go to Mouser because they have the data sheet immediately linked and then you can open the data sheet a PDF document usually and scroll down and in this case we already have pretty much all we need on the second page to create both the schematic symbol as well as the footprint what we need for the schematic symbol are simply the
(51:10) number of pins we have so in this case we have four 1 2 3 4 as well as the pin functions in this case it's very very easy because this is a passive device we have two input output terminals 1 and three and then we have two ground terminals 2 and four and that's what we need to transfer over to our schematic symbol in keycard what we can do is go to tools symbol editor unfortunately the library that come with key CAD so for example if you go to RF filter right click and then new symbol we can see the library is actually not writable so we
(51:45) have to create our own symbol library in this case and this is typically a good idea if you for example working in kead on predominant in kead or whatever EAD tool you're using is to have your own schematic symbol and and footprint libraries so we'll go to file new library we'll just make this a project Library just for now I'll will just call this Library as the project name and then uncore schematic symbols click save and now we have a new library entry in the simil editor so I can either click at the top left here create new symbol
(52:12) or of course right click new symbol the symbol name is the name of the part so I'll just copy the manufacturer number go back to Key Cat symbol name we won't derive this from an existing symbol and the reference designator this could be you for example for active IC could be R for resistors L for inductors and so on for a filter we might do FLT for fil number of units per package is simply one and we can just simply press okay what we need to do now is add pins we can either do that with the top with this pin table where you can bulk edit
(52:44) or we can on the right hand side click P or add a pin and this lets us Define pins like so I will go the bulk method so at the top click on the table and I'll add in four pins number one 2 3 and four and then we go to the data sheet to look at the names so one was in two ground three out four ground in ground out ground then we have the electrical type and this is useful for the electrical rules check and for sanity checks so ground you could just Define this for example as a power as a passive or a Power Pin we'll just go for Passive
(53:18) A now and the in you could of course specify as an input but this is actually a bidirectional filter so this could be a bidirectional or will just keep it passive for now but make sure to specify this for example for microcontroller if we have a vdd pin this would be a power input or if we have just a an output pin then we select a power output and so on we can select an orientation so for example input would be left ground down output right ground down and if we just click okay we can drag our pins press R
(53:48) to rotate and just align them properly so we typically want inputs on the left outputs on the right and ground example at the bottom and I'll just do it in the right pin order now we would of course like a bounding box for example as well this will be just a very basic symbol so on the right hand side right hand side I can add a rectangle and we could for example draw a rectangle like so and you could of course make it as neat as you wanted to so something like this might be okay just as a very very basic symbol
(54:19) we can also change the Box outline color to make it more in line with key card so double click and fill style fill with body background color and this looks more key cadish let's call it now often times I'd like to add a bit more description inside this part so on the right hand side I can click add text item and then you can add a text in for example I could say this is a 2.4 to 3.
(54:39) 5 GHz low pass filter for example just as a very very basic example but pretty much everything here is just taken from the data sheet so that it's a low pass filter the frequency range so to speak and the pin out function so one in two ground three out four ground is simply what we've created here so in one two ground for ground through out and we can save that if we go in key CAD in the simol edit at the top you can see this simol property dialog button we click on that we can see the reference will totally be filed we can add in a value
(55:13) and for this I usually put in the symbol name as well we can add links to data sheets and so on and this definitely makes sense to fill in for your own libraries for the sake of time we will leave this blank for now what we need to do is now create create a footprint that we can then link with this part so now we've created the schematic symbol which lives on the schematic but we also need a physical part the footprint which then looks like the shape we see here with these pads of these certain dimensions and we need to create that and Link that
(55:40) to the schematic symbol back in the schematic editor just as we use the create delete and edit symbol button two to the right we can click on this icon at the top toolbar which is create delete and edit Footprints so that's exactly what we're going to do as before we we can browse through the various Footprints we see here for these example Footprints we have various pads various Dimensions silk screen layers and so on and these will be become more clear what they are when we move over to PCB design but as before we need to create a new
(56:07) library so go to file new library we'll do this a project library and I'll just give this a somewhat sensible name click save and on the left hand side we now see the libraries has a new entry with our own footprint Library we can right click and create a new footprint this footprint name again we take from the data sheet so for Fairly generic components we could create for example a generic footprint that is called UF qfn48 and that would fit all ic's that are in that package or for a resistor we might have 042 or 0603 Footprints and
(56:38) those are fairly generic for something like this filter there could of course be filters that have very similar packages and then we would create a generic footprint for these types of packages we can see the package case here doesn't have a specific name it only gives us the dimensions so to speak the data sheet also o doesn't tell us a specific package name unfortunately for the sake of Simplicity I'm just going to call the footprint the same as the part number itself because we don't have a distinct footprint name for this and the
(57:07) footprint type is an SMD because this is just a surface mount device and click okay and now we have a new empty footprint or blank footprint in our footprint editor what we need to do is then take over these pad Dimensions so there's a recommended land pattern that's another way of saying recommended footprint these pad then map to the terminal functions like so and keep in mind data sheets of have this third angle projection so have top side and bottom view so this image same as the recommanded land pattern is
(57:37) actually viewed from the bottom side so this is pin one pin two pin four pin three but this is from the bottom side so actually from the top side pin one is on the left pin four is on the top pin two is on the bottom and pin three is on the right hand side for us it doesn't really make too much of a difference it's a bidirectional device pin one and three are input outputs and two and four are grounds so all we have to do is then create this land pattern these SMD patterns and pads based on these Dimensions so for example with these
(58:07) elongated pads we have 275 mm width 7 mm height so key card going to the top copper layer on the right hand side I can click on this circular looking icon add a pad and I'll just place the pad somewhere escape to cancel zoom in and double click to edit the properties what we need to change is the pad number so that's 1 2 3 or four in this particular case we need to change the pad position the pad shape as well as the pad size so the pad size is the easiest so the X was this 0.
(58:42) 275 so let me type that in 0.275 and our height from the data sheet was 0.7 and this is taken from the recommended land pattern 0.7 typically it's suggested also by APC to keep your pad shapes if they suggested as Square make them as rounded rectangle and this provides better gasketing when applying the solder paste via a stencil for example you could of course just go with rectangular but I make my footprints pretty much always with rounded rectangle and a corner radius about 25% if it's just a normal pad then we have the X and Y positions and this
(59:16) unfortunately can be a bit more involved because data sheets don't clearly give you that information you'll pretty much always have to calculate that yourself based on the dimension they give you for example here assuming the center is directly in the center of the part so the y and x axis on the center of the part they only give us the dimensions so the spacing between the pads for example here or the spacing vertically between the pads and we have to figure out the centers of these pads ourselves so for example the center of the upper and
(59:45) lower pads are given from the center origin are 0.21 plus the height of one of those paths so it's 245 / 2 similar similarly the X centers of the left and right pads are half the one of these pad widths plus a whole distance between the left pad and the center pad so 0.25 plus half of this distance so 0.
(1:00:10) 45 / 2 plus 0.25 plus 0.275 / 2 so that turns out to be about 0.613 so that's what we type in the position X is what we just calculated and again you won't be able to get this Precision also with Manufacturing all these four decimal places so it might make sense to round down for example to - 0.61 or to minus 0.
(1:00:33) 613 rather than having four significant figures but we'll just leave it for now for the sake of Simplicity then press okay and now we have this tiny pad added here we can copy that pad add it again and simply type in 06125 and this is the right pad which is pad three so we'll change the pad number press okay and then we need the two Central pads so pads 2 and four which are our ground pads so again we can just copy this edit it at number two which will be the bottom one remember this is the bottom view so it's flipped then again for this it doesn't really matter
(1:01:03) because two and four are ground pads and then we need to define the dimensions which are 0.25 for the height and 0.45 for the width so 0.45 and 0.245 and the X position is zero because it's aligned with the center and the Y position is a half of 0.21 plus a half of our pad height which is 0 25 and that's 2275 and press okay there we go now we have 1 2 and three we'll copy this pad and then this is minus 0.
(1:01:38) 227 5 pad dimensions are the same pad number is four and this is- 0.225 press okay this should hopefully be our footprint now this is done very quickly so remember to check your Footprints very thoroughly and the pad positions this is incredibly important otherwise this component will not be able to be assembled properly so other than just having the pads in Copper and we can see this in 3D by going to view 3D viewer here is what this would look like on the PCB we have exposed copper our exposed pads as we've drawn them in and sized them just now taken from the
(1:02:10) data sheet what we'd also like to do is maybe draw a bounding box in terms of a silk screen or some sort of Courtyard and do pin one indications as well as add in a 3D model what I'd like to do now is first of all add a 3D model I think it's incredibly important to always add 3D models to any footprint you are using for mechanical checks for sanity checks 3D models can sometimes be hard to find for example if we go to the TDK product Center I've looked for this part number and there are various documents such as the DAT sheet
(1:02:41) technical information so on but there seemingly isn't a 3D step file or model that we would need to import that into key CAD which is unfortunate and I wish more manufacturers and vendors would provide 3D models because it's such a useful tool all and often times they do of course but in this case we need to find a different way of finding a 3D model so what I would typically do is type in the part number and then type in Step at the end and then we can find 3D models or 3D step files so there are sites for example utra librarian that
(1:03:10) have for example Footprints and symbols and step models already available but if you for example look at the symbol on the left hand side we can see this has been automatically generated and we have pretty bad placement of the symbol pins so ground is on the left but also on the right the top and the footprint we would have to verify and check ourselves anyway that's why I'd strongly suggest creating your own schematic symbols and Footprints checking them thoroughly staying within your own standards but if you can find an external 3D model or of
(1:03:39) course create your own preferably find a model created by the vendor or the manufacturer rather themselves in this case Ultra librarian seems to have a 3D model now this doesn't look entirely accurate if you look at the 3D model here we can see these pads extend out it doesn't look entirely right compared to for example the manufacturer website but it might be a good starting point and it might be somewhat of a close sanity check if it fits for example our footprint at least dimensionality wise but I would suggest creating your own or
(1:04:07) finding a somewhat accurate model of course verifying everything as you go I've downloaded this model I've added it here into the project folder this step file in keycard we can go back to the footprint at the top side click on edit footprint properties go to 3D models in the top tab click the plus and then open the set file now you can play around with rotations and offsets if it's not correctly aligned but this looks like it's aligned on our pads and again this isn't an entirely accurate 3D model so you'd have to verify the 3D model but
(1:04:36) it's always good to include one after it's been checked on to your footprint as well you can also of course change the opacity and various other parameters but for the sake of Simplicity we'll leave it as it is for now and click okay now other than having the exposed copper or if you have three hole pads and so on we have various other layers in our PCB design that will become more familiar with later on when we actually come to the PCB design right now we're just creating the footprint so we can link it to the schematic symbol we have other
(1:05:03) layers other than copper we also have for example mask layers silk screen layers paste layers and so on what is often times helpful and what you should do is put a pin one indication now even though this might be a bidirectional part we also have a pin one and also from the manufacturer website we can see there's a pin one marking on the top of this device so this is what we like to indicate at either on a drawing layer or on the silk screen which is the text such as this white text you would see printed on a PCB the way you can do that
(1:05:32) is switch the silk screen layer on the right hand side I've selected it with this Arrow I can click draw a circle change my grid at the top maybe to something smaller and just click once and draw it a circle escape to finish double click on the circle and I can change the line width radius and so on so for example I can place this pin one indicator Circle next to pin one pad so in the 3D viewer alt 3 or view 3D viewer we now have this pin one indication next to pin one what we can of course do and what is sometimes helpful is also draw
(1:06:03) an outline in the silk screen layer so select silk screen then draw the line line tool and we could for example draw an outline and we could for example draw an outline around the part again this is very crude but it gets an indication for placement of this part so for example we could leave it as something like this please take this with a slight pinch of salt this is just a very simple basic example contrl s to save and we've now created our footprint so we can close this window we return back to our schematic symbol editor click again on
(1:06:33) the display symbol properties and now we can finally assign the footprint so I'll click on the footprint I'll navigate to our new library select the footprint we created double click and now it's assigned directly to our schematic symbol click okay save the library and we can close that window now with all of that work in place we've created our own schematic symbol we've created our own PCB footprint and now we can finally get back to our schematic now after all of that work of creating our own schematic symbol and
(1:07:02) footprint we can finally add in the low pass filter after the RF maxing Network let's just briefly remind ourselves remember we had pin if1 of the microcontroller which was our if Bluetooth interface so to speak then we had this 50 ohm matching Network this Pi filter and now we have this low pass filter after that we'll connect this to our UFL connector which is a effectively our antenna connection and this dlf part is the one we just created so back in key CAD we can now press a or add component and we'll look for our dlf1 16
(1:07:35) and as we should expect we have our own schematic symbol library and our part which shows the schematic symbol as well as the footprint so click okay and we just attach that simply to the end of our matching Network we have to copy one ground and then we can hook up ground as well again using the wire command and now we have our low Plus filter in place finally then we need to connect our connector so what we could do is again press a and we could look for various connectors so there's these various symbols which are available pin socket
(1:08:06) COA but then there's also these connectors called COA connectors which most resemble for example UFL or an SMA connector so I'll go with this Conor coaxial double click place it next to our low pass filter the wire tool to hook things up copy the ground and here we go then we have the RF pin from a mic controller matching Network low pass filter cor actual connector now keep in mind this is the bbone circuit you might want to add in protection at any connector you typically want to add protection you could use different
(1:08:38) matching Network structures depending what type of anten you use this is the most basic form so keep in mind when you're designing for a different system now of course you want to add net labels again for example the RF Port here then we have for example the output of our matching Network and finally of course we have our antenna connection over here the way I'm labeling my Nets is that they are somewhat sensibly named so for example the RF section I'm starting everything with RF the smitch mode power supply everything snps and so on this
(1:09:08) will help when creating net classes which we'll see later on as well as in the PCB design so here we go this seems like a good first structure of this part of the schematic what we need to do next is make sure that we have some programming interface available for this microcontroller now there's different ways of programming the microcontroller one might be that you use the s32s internal bootloader to program this device via for example uart or USB but the preferred method and the one I'd suggest is going via JTAG or serial wire
(1:09:39) debug now of course there's application notes and many guides on the internet of how to do this for example st's 4989 how to debug for example stm32 microcontrollers and this tells you about serial wire debug how to use a debugger what part parts to connect and what debuggers are useful for to go into more detail I do have a number of videos on my channel that tell you about Cy debug using the debug probe through this St link and Cube IDE to program and configure custom Hardware I'll leave those links in the description below and
(1:10:09) of course I also have a video on USB device firmware upgrade or dfu how to program your devices via USB searching for boot loader in the s32 WB 55 data sheet we can see section 3.5 tell us about the boot modes and firmware update we can see that we can update the code again via ser dbug and JTAG which again should be the preferred method but also via USB you I C your SPI this also hints at at the top we can see the boot zero pin and boot one option bit can be used to select various boot modes and for us what's important is the boot zero pin
(1:10:47) which you might have already seen before the boot zero pin is a tiny bit hidden if we hover over ph3 pin four of our particular microcontroller we can see ph3 also is called boot zero and this pin is particularly important and this needs to be tied to either low or high voltage at startup if we tie boot zero pin low effectively tying this pin low boot zero low at startup the device this microcontroller will jump straight into application code and you won't be able to use for example bootloader to flash programs by USB or I squid C or uart if
(1:11:22) however at startup this boot zero pin is pulled High then the boot loader will initialize and we can program this particular micr trailer for example via USB uart and so on so we should keep this in mind and make boot zero a variable or switchable pin zerowire debug in any case is accessible as long as you've enabled it as a peripheral with Ser debug we need to break out a couple of pins which are then connected for example to an stlink which is st's version of a debugger this debugger then connect to your board via the Seri d
(1:11:54) pins power and ground and to the other side via USB to your host computer which you can then use to set breakpoints program your code debug your code and so on so we really really want to expose these pins in every design at least every design I've seen so far so let's see how to do that in Cube IDE we can go to CIS on the left hand side and then debug here we can see the various debug options we have so serial wire debug so s swd for short we have JTAG and Trace asynchronous if we just enable serial wire we can see two pins have been added
(1:12:27) pa13 is serial wire data and pa14 is serial wire clock so just with two pins this is enough to have a debugger interface with this device simply speaking if we change this to trace a synchronous we add another pin and this is the trace output or S swo output so this is an optional pin but I'd strongly suggest if you have the space to break out this pin as well because the trace output can be very useful for monitoring variables and so on so this is the option we'll select you can of course use JTAG as well but I'd strongly
(1:12:58) suggest if your device supports It Go with Trace siry debug so we have pa13 pa14 and pb3 along with the Ser wild debug interface we also have this n reset pin this n reset pin n just stands for inverted logic so when this pin is PED low the s32 is put into a reset State when this pin is pulled high this stm32 micr controller is pulled out of reset and starts running so to speak and this pin is typically also connected up to an st link or to your debugger so we need an reset we need our Trace pin pb3 we need our clock pa14 and pa13 our data
(1:13:37) IO and this will hook up to a debugger now there's many different ways and different cables as you can see here every different image seems to have a different way of interfacing to your debugger and this is maybe a start of a problem let's very simply call it because there's many different ways of interfacing so you could either put a a header onto your board for example a header like the one you see here this ribbon con cable is connecting to but my preferred method is using tag connect cables tag connect cables or headers
(1:14:04) connect on one end to your debugger and on the other end they have these Pogo pins these are effectively spring loaded pins and we can see this picture here so we don't actually have to mount any header on our PCB so we save cost for every PCB and we can simply plug in this header which goes to our debugger so all we have to have on the PCB is a couple of through holes and a couple of exposed pads and this is where our serial wire debar connections go into and between our microcontroller and this connector I'll leave a link to tag connect in the
(1:14:34) description below and also to the St line of products and which are compatible for the St link and where to order these parts in any case let's remind ourselves of the pins that we need to expose so pb3 pa14 pa13 and N reset and we like to connect these to this tag connect header in the case of this board so going back to key CAD it was pb3 so I'll just draw a wire here just to help us remind ourselves pa1 14 and pa13 and then of course we have n reset at the top here on the top right if I press a I can add a component as usual
(1:15:07) and I'll look for TC 2030 and this is the connector we just looked at from TAG connect and effectively it's the end on our PCB that can interface with this Pogo pin header that POG up in header goes via an adapter to our stlink so we just want to place the pads on our PCB so while this is a component it's actually not a component that's on the bill of materials these are simply through holes and they are simply pads there are two versions there's the one with legs which easily Clips onto the board and there's one without legs which
(1:15:35) saves a bit more space but it does require an additional retainer clip that's why we'll go with a TC 2030 so we add that in and put it somewhere to the left hand side of the board nicely enough the key Cat symbol already contains the correct pin out for this TC 2030 so we need to connect VCC and ground VCC is whatever logic voltage you're using for your microcontroller in our case this is of course 3.
(1:15:58) 3 volts we have the N reset signal which needs to go to you guested and reset we have S wire clock s wire data and S wire Trace s wire Trace was pb3 serial wire data was PA 13 and serial wire clock was pa14 so as you see here pa4 clock pa3 data s swo pb3 then ground and Power then of course we have our reset but we could of course draw a wire that kind of jumpers over like so but I find that a bit messy unfortunately so what we'll do we'll just do extend this wire out a bit to just make it obvious that we're doing a jump add a net label we'll call this swd
(1:16:40) and reset I can change the orientation by double clicking changing orientation and this is just now indicative that this is a jump so I can contrl C and hook it up to my reset like so and this is kind of an indication that this jumps we also want to add net labels to PA 13 pa14 and pb3 for example something like so so we have pa13 is dat iio and again this is just how forth of a PCB design aspect as well and trace of course you can increase the font sizes and so on depending on your preferences now for the Ser wild debug header or any
(1:17:12) connector any exposed interface you typically should add ESD protection to make sure when you're messing around with a board so to speak you don't accidentally fry your devices however from experience these STS are pretty resilient so for example for simple test boards like this it's absolutely fine but I wouldn't recommend this on connectors for example on a commercial product one particular note we should take care of however is this n reset pin so let's look at the data sheet so jumping to section 6.3.8 I just typed it
(1:17:41) n reset in my search tool to scan through the PDF of this s32 data sheet we can see the characteristics we can see the input high and input low levels as well as the recommended external circuitry Tre in figure 28 for the N reset pin we can see that internally to the microcontroller in the Box on the right hand side we have an internal pull-up and from the table above this a pullup resistance is approximately typically about 40 khms but can range anywhere from 25 to 55 khms so this is nice by default we actually don't have
(1:18:11) to connect this n reset pin because it's internally pulled up and immediately on boot without an external connection this microcontroller would simply start booting up so to speak however they do recommend an external reset circuit so a filtering capacitor AUD bouncing capacitor and a switch now I found that typically I don't need a switch on an N reset because I'm doing the switching via the debugger we've connected anyway but I typically do place a capacitor this 100 nanar capacitor on the N reset line and we don't need an external
(1:18:41) pull-up because that's already in the device so from that information what we can do is just copy one of these capacitors now you can either place it at the TC 2030 or your debug header or at the N reset pin I'll just place it at the N reset pin for example like so just to make clear we're coming from somewhere some different part of the schematic and that is from our tag connect header and before we go into the pin we have this effectively built- in capacitor that goes to the end reset line keep in mind we're still going to
(1:19:09) clean the schematic up after we're done with adding all the components in so we'll draw bounding boxes we'll fill in the title blocks and so on to do keep that in mind that this is still work in progress but now we have our Ser wi debug our main programming interface in place as well now that we have the serial wire debug header in place as well as the connections to that header there's one thing we still have to remember to implement unfortunately this isn't entirely clear just from the schematic symbol if remember back for
(1:19:36) example looking at stm32 Q by on pin 4 ph3 this is an alternate function pin that also has boot zero on that pin so again boot zero if we pull that low before startup we are simply in run mode very simply speaking and if we pull this pin high before startup then we toggle or trigger the boot loader internal to the s32 microcontroller and we can program this device by USB uart and so on and we definitely want to make this toggleable because it could of course be that you don't always have a St link or debugger with you and you want to
(1:20:08) program it via USB this pin ph3 is kind of hidden in the schematic symbol and we can see it here ph3 pin 4 so this we want to root out so again we just take a wire and we root out past these symbols we'll clean this up in just a second because we're going be using this so to make this a bit cleaner I'm going to just click and drag and move these designators and these component values just to one side just so we make it a tiny bit cleaner so by default we want ph3 which is our boot zero switch to be pulled low because we always just
(1:20:39) basically want to assume we want to be in run mode that's the default most of the time but in certain times we want to pull this pin High we can do this via switch we can do this by a button or a different methodology the easiest is usually just a switch or a button that then pulls this pin pH 3 to 3.
(1:20:54) 3 volts which is in our case the core Logic Supply so what we need then is a pull down resistor so we Press A and R to go resistor and we can place it somewhere sensible in line with other components then we attach our wire to that resistor and that other end of the resistor to ground I'm just copying symbols W as usual as our y command the value of this P down resistor we will determine in in just a bit it's not too critical as long as it's a couple kiloohms this could be 5 10 and even a bit larger than that is okay for this pull down another thing to
(1:21:25) mention is that this ph3 is not just a boot zero pin if we go to cube IDE again click on boot 3 we can see it has many different options we could do an analog input uh GP input output and so on so after startup once this boot zero pin has been sampled by the boot loader we can actually use this for example as a typical input so it could be a user input and that's exactly what we then could use it for so what I'd like to add is a button in this case so just a tactile button which then a user could interface with so again press a then we
(1:21:56) can scroll down for example to switch and under switch there's many different types we could put in a dip switch for example or any of these other switches but what we want is a switch undor push so just a tactile push button switch click okay and we can add that somewhere to the design for example now if we were just to wire this up like so one side of the switch goes to the boot zero pin so pin ph3 and the other side we can just copy one of these 3.
(1:22:23) 3 volt flag goes to the other side of the switch so like this before we plug in power to this device we could hold down the switch push button this would pull pin ph3 high and after it's booted up we release the push button and we are in the bootloader mode if we don't push this push button this push button is normally open so there's no connection it's like an open circuit and therefore R1 is pulling pin ph3 low because we'd also like to use this switch as a user button so after boot up assuming we don't go into the boot loader it's
(1:22:51) typically important to also provide some form of debouncing and that's usually very simple just an RC low pass filter in the simplest case so we can copy one of these 100 narad capacitors place that in parallel with R1 or this resistor pull down resist at the moment copy the resistor rotate it and we want to place that in series example like so and we'll determine the values at a slightly later stage and the reason for determining the values later we will see in just a bit as well in this way we have now a very
(1:23:18) very crude debouncing circuit essentially a low pass filter formed by r 2 R1 and C12 and c17 feeding into ph3 let's not forget our net labels so I'll just copy a net label and then change the name and I'll just call this example boot zero so we've come quite far already this is the main external circuitry we need to get this device up and running however of course there's some things missing we don't have a power source we would like to maybe add some peripherals because as it is we don't really have anything interesting
(1:23:48) except maybe a button and a Bluetooth connection so of course you want to add some peripherals and that depends on the scenario you're in so if you're maybe creating your own Smartwatch or whatever device you're creating you will need to choose different peripherals and this is where again these pins these General functions so to speak pins for example Bank PA and Bank PB and these pins come in but now we have essentially the essential circuitry in place that forms the basis of what you need as a minimum supporting circuitry for this particular
(1:24:16) MCU for the sake of Simplicity and time in this video I will be just showing you how to select peripher and how to rout them out for example to connectors we'll be using Cube ID to do this but of course you could go the data sheet route as well so QBE IDE we can on the left hand side see what peripherals are available to us quite quickly for example we have an SPI available uart USB I squ C's and so on and this is for example where I could select whatever interface I want for example uart I can selection a synchronous art and this
(1:24:48) automatically then Maps pins that are suitable and don't interfere with the other selections we've made previously so here pa9 and Pa 10 Again control click to map pins to other locations in case these don't suit you to start off with what I'd like to do is add a USB connection in so on the left hand side under connectivity USB we had device selected and this maps to pins PA 11 as the differential pair negative side and pa2 differential pair positive side and again control clicking we can't move these pins so these are in a fixed
(1:25:22) location we can use the USB to for example stream data it could be an audio device class and of course we can use it to program the device as well and you can find pre-written drivers so to speak under middleware and software packs and then USB device and there's many different classes that St provides already which you can use pretty much straight away for us now just doing the hardware design what's important is that we have p 11 and pa12 selected so we have PA 11 was D minus pa2 was D+ so just to indicate we will draw some wires
(1:25:54) out and we can already give these net labels so I'll give usbcore D minus for PA 11 and I'll give a net label usbcore D+ it's important that we end in minus and plus and that otherwise the net name is the same so usbcore D then we have a minus and usbcore d and then we have a plus this is important because this signifies to key CAD our software that this or these two parts these two Nets form a differential pair and we'll see that later what that is when it comes to PCB rooting that these traces then on the PCB are rooted differentially so
(1:26:30) they're rooted as a differential pair they're rooted together but more on that later but it's important that we give them the correct net names then for this we of course want to connect this to a USB connector now there are many different types of USB connector of course what's typical these days are USB type-c connectors which I'm sure you're familiar with we can plug this in in two orientations rotated by 180° and they're very user friendly and pretty good connector so that's what we'd like to use in our design the way we can add
(1:26:56) connectors is as usual we press a let's type in USB and then we can see under the connector list that we have usba a b b micro mini and so on but of course USBC as well now USBC as well comes in many different flavors we have USBC that is for example super speed capable USB that might just have power only but then what we actually want for this design is a USBC receptacle that has power and ground as well as some other configurations pens but also we only need USB 2.
(1:27:27) 0 for our USB full speed SCM 32 so this is the receptacle we'll select I place it on the schematic the USBC receptacle in this case keep in mind the pins are mirrored there are duplicates of these pins on the actual connector itself and we'll see that in the PCB design so we actually have two vbus pins we have two ground pins and here we have sideband use one and two duplicated differential pairs duplicated Communication channel pins although the stm32 contains a bit of ESC protection on most of its IO and you can read that up on the data sheet of course it pays
(1:27:59) off especially in connectors that you used a lot of the time or pretty much any connector that's exposed so to speak to the real world to add in ESD protection that sits then close to the connector so other than just this USBC receptacle I'd like to add in some ESD protection the one we're using is very common and it's also by St microelectronics and this is a kind of Do-it all package the six pin pack package called USB LCC 6- tc6 in an easy to solder s 23 package it has protection for vbus as well as the differential
(1:28:31) data lines and also has a fairly low capacitance so this part could also be used for example for highspeed USB highspeed this symbol is in fact available in the key CAD libraries but if you see on the right hand side the arrangement of the key CAD Library pinout pins ones and six are tied together as they should be three and four are internally tied together but actually placing this on the schematic and then rooting this out is going to create a mess with the schematic so I copied the symbol and rearranged the pin
(1:28:57) out to make this much easier to connect up so this is what we'll use it's an identical copy except I've just moved some pins around so I'll select that from the library and place this on the schematic unfortunately also the key Cat symbol for this connector isn't great I'm not sure why the CC pins up here they'd be much better suited below the differential data paer because we have to put some pull down resistors on this connector in any case we can wire up the differential pair connections like so we root out the differential pair minus
(1:29:27) from the connector and the differential pair plus from the connector right into the pins 1 and three of the ESD protection device given that the USBC connector and receptical they're reversible so 180° we can plug in in our cable that's why we have pair ofd minuses and pair of D pluses for high speed systems you shouldn't do this but since we're only running USB full speed so comparity very very slow and a low data itate we can just simply connect up D minus and D+ right at the connector then on the other side we have pin six
(1:29:59) is D minus pin 6 D minus root into PA 11 of the MCU and pin 4 of the ESD protection device root into USB D+ which is pa2 as we saw from Cube IDE the ground connection pin two of the ESD protection device of course needs to hook up to ground and power not to 3.3 Vols which is pin 5 but rather to vbus which is the power coming from the USB type-c connector we will actually then of course be using vbus to power the rest of the device and for which we have to add in a regulator but we'll do that in just a bit we also have these
(1:30:34) sideband use S spu and CC Communication channel pins that we need to hook up somehow it turns out actually that we don't need to hook up the spu pins anywhere and for that just to indicate that we've looked at them and that we don't get an electrical rules check error later on on the right hand side or by pressing Q we can add a no connect ction flag and place those on the sideband use pins and then press escape to cancel and then these won't appear as errors because they're left floating we do however have to hook up the CC1 and
(1:31:03) cc2 Communication channel pins if this is hooked up to for example a USB C port on a host then having the CC pins floating will not indicate to the host that a power syncing device is connected we can indicate to a host that a power syncing device is connected by using 5.1 k own pull down resistors per CC line so I'll take the resistor we had over here Place one like so and one like so and then a rout to the CC1 as well as to the cc2 pins the other side of these resistors then needs to be connected to ground like so and the value of these
(1:31:41) resistances is 5.1 kohms per piece let's not forget the shield and ground pins and according to the type C USB specification we need to tie both shield and ground to our system ground so for example connected like so let's not forget to add net labels so these CC pull down resistors have to be 5.1 KMS with a 1% tolerance therefore we will use the same 5.
(1:32:08) 1 kohms also for this pull down resistor at the boot zero pin this is known as Bill materials or bomb consolidation making sure we don't have very many different unique parts or unique entries on the build materials so we could of course use a 10 km resistor here but why should we boot zero doesn't require specific resistor value only in the order of a couple of kiloohms so we just reuse parts we already have in the design for example from the USB type-c connector for this series resistor which is part of this debouncing network a couple
(1:32:36) hundred ohms or less is usually sufficient keep in mind R2 and R1 form a voltage divider so if we chose for example R2 to be 5.1 KMS R 3.3 Vols when this button is pressed will be divided by two so we want to keep this resistance quite a lot smaller than this pull down resistance so let's just start off with 100 ohms and of course when you have the PCB in your hand you can change the value depending on circuit performance before we choose some peripherals to end up on these PA and PB pins let's just complete the USBC
(1:33:07) section which is also our power source with a power regulator that generates our 3.3 volts now for this USBC with these pull down resistors of 5.1 khms we can expect vbus to be in the range of 4.5 to 5.5 volts with a nominal voltage of 5 volts and in certain cases this will be able to supply up to 1 and2 amps Which is far far more than we need for this design we need significantly lower current this 5 volts which will be imp parent normally at vbus need to be stepped down somehow so converted to a 3.3 volt voltage that we can then use
(1:33:43) for the microcontroller and peripherals there's usually two different options of doing this one would be for example a step down and a switching converter which requires quite a number of different parts we need to calculate various values but they are rather efficient if you choose the parts correctly a far easier version and something that's more suitable for this type of video tries to show whole design in one video is to go with a linear load Dropout regulator low Dropout Regulators or ldo voltage Regulators are very very
(1:34:11) common they're typically fairly inexpensive you can get them with lower noise they're used also in analog circuits if you're sensitive to power supply noise but in our case we don't require much Cent and we have a 5vt input and a 3.3 volt output so the input output voltage differential isn't too large therefore the power wasted in one of these linear Regulators isn't too large for example the power waste would only waste let's say about2 watts of power which is okay in this application and it allows us to use a much simpler
(1:34:40) simpler part to find a suitable voltage regulator we need to know what currents we might expect and this is where Q by can help us again if we go to tools on the top right hand side on the left side side we select PCC we can let Cube IDE calculate the current requirements based on what peripherals we've selected so if I double click on one of these run steps we can choose the power mode power range what our supply voltage rail is what CPU frequency we're running at various other configurations and also what pinout we
(1:35:09) would want we can calculate a worst case by just clicking and enable all IPS and we already see our step current consumption is about 16 to 17 milliamps and this is of course just for the microcontroller we could of course also just go the data sheet route we also of course have to add in the peripherals we use so if we're using various sensors or if we're toggling relays and so on that would of course add into the equation but you can already see as we'll probably just be adding some connectors for example to ur to iqu C on this very
(1:35:37) simple demonstration board our current consumption requirements are very very low indeed and that's again why one of these ldo Regulators does make sense so if you go to your preferred component distributor look for ldo voltage Regulators select in stock we we want SMD type we want one output which is positive and an output current something around 150 milliamps is probably okay remember we want to keep in some margin as well we can click apply filters we have more filters here we want to of course allow an input voltage that is
(1:36:07) higher than our maximum expected in input voltage and for our USBC receptacle that's maximum 5.5 volts so let's say we can choose other options here such as package types Qui and currents input voltages minimums and so on what I'd like to choose is a fixed output type so one that doesn't require external feedback Network to set the output voltage and I want the output voltage to be fixed at 3.
(1:36:32) 3 volts and click apply then we can sort by price because this is a fairly lowcost board we don't have very particular requirement and we see a list of regulators that could be suitable so there's many different package types for example this one here looks like might be harder solder one of these exposed lead package types might be easier and so on the part I ended up finding which is fairly suitable is this mic 5365 by microchip it's readily available at the time making this video pretty inexpensive comes in an easy to solder s
(1:37:01) 23 package output voltage is fixed at 3.3 volts so we don't need an output feedback Network output current sufficiently sized at 150 milliamps fairly low Qui and current and input voltage range 5.5 volts is the upper limit of what we expect and that is pretty much fine in key CAD then another reason for choosing this part was that this symbol is actually already available so if I look for mic 5365 we want the -3.
(1:37:27) 3 yd version which is in the sod 23-5 package click okay and add this to the design going back looking at the data sheet another reason for choosing this device is that in the data sheet it says it's stable with 1 microfarad ceramic output capacitors typically ldo Regulators will require an input and an output capacitor and sometimes especially older Regulators will require for example higher ESR output capacitors such as tantum or even an aluminium electrolytic to preserve stability of the regulator therefore these more modern ldos are nice because they only
(1:37:59) need fairly small ceramic capacitors for stability this is great in our design because we already have capacitors for example this 4.7 microfarad capacitor that we could then use as input and output capacitors so the way we then just need to hook this up is take our output from vbus so after the ESD protection so to speak root that to the input of our regulator and the the regulator needs a capacitor so I can move this to the side which we hook up to the in and the output of this regulator needs a capacitor which we
(1:38:30) hook up to the V out pin then of course you have the ground pin so we just copy a ground symbol and we hook up the grounds also to our capacitors for example like so the aid voltage because this is a fixed voltage regulator is simply 3.3 Vols and then we can just place our 3.3 Vols at the output here the enable signal I'm going to see in the data sheet what we need to do with that so if I just look for enable we see enable input it's active high high is on low is off and do not leave floating which is also very important then we
(1:39:01) also need to look at the suggested operating ratings so enable voltage is anywhere from0 volts to the input voltage this means to turn this regulator on WE simply tie the enable voltage to the input voltage like so and there we go that's how easy it is to then Supply Power from 5 volts from my vbus of the USB type-c receptacle through the ldr regulator to 3.
(1:39:23) 3 Vols now we have a suitable power source for the rest of the circuitry on this board we're nearing completion of the schematic now there's of course a couple things we still should clean up and maybe create just as a demonstration a connector or two where we assign some of the PA or PB pins to peripherals you might use in your own designs we're still missing a power flag for example on the vbus line right here which is normally at 5 Vols so on the right hand side or by pressing P we can look for Plus vbus we can choose for example the
(1:39:53) plus 5V flag and put that at the USB connector just so we're clear what the nominal voltage is on that vbus line other than that we could of course add some status or indicator LEDs this could be an LED for example on the 3.3 volt rail to indicate that power is on or just an LED which we can then toggle via the microcontroller which is usually my preferred option because you have more control over that of course to select peripherals we go to IDE again and again this is very very generic it depends on what you're connecting to so if you're
(1:40:27) connecting to an SBI sensor or maybe an i squ c display or you need timer channels this is the area where you would do this so we already have some fixed pins which in this case can't change but all of these grayish pins all of these light gray pins we can select what peripherals we would like so on the left hand side if we want an i squ c again it's just enable i squ c control click to move that wherever you want it to so looks like pa9 could be a choice and iquid C SDA or I squid C3 might give you different options and so on for now
(1:41:00) I'm just going to enable one uart again this is just as a demonstration you can choose whatever peripherals you want I chose art one and it's placed it in an area where there aren't too many other pins and for us this is good because we don't have crammed rooting so I wouldn't want to have these pins for example pv5 and pv4 because we have a few other connections coming out there as well so let's just stick with pa2 pa3 for now again just a demonstration so pa2 is U1 TX so we can root out a tiny segment and
(1:41:30) pa3 was our other pin and again just adding net labels like so just to immediately be clear what these pins do and what these pins are then we would like to hook this up to some form of connector so again we can press a and look at the connector section these could be generic connectors or if you have a specific connector already in mind you can choose that here of course as well or course create your own schematic symbols I'm just going to go with a very generic 1x4 header place it some on the schematic like so and we'll
(1:41:59) choose what exact connector this will be later on when we come to the footprints typically we would like to supply for example power and ground as well so I'm going to take a 3.3 Vols and a ground now of course we could just root up U TX U RX like so to the connector but typically it's good practice to also add ESD protection as well as I also add in some current limiting resistors so I'll just copy the 100 ohm resistor we have here and place it both on the U TX and U RX line this also can help with the ESD
(1:42:28) susceptibility of your device so just these two series resistors like so and we won't add estd protection for the sake of time and typically I would also add for example a small byass or decoupling capacitor between 3.3 Vols at Ground at any connector Power Pin but for now we'll just leave it as simple as this and of course don't forget your netnames I will just call them txc so TX connector an RX connector of course you could flip those names because this is effectively the the RX of the connector and pin 3 is the TX of the connector
(1:42:58) depends on what your naming conventions usually are but for the sake of Simplicity we'll leave it at this for now other than of course for example a uard connection let's just add an LED and typically I like to add my LEDs on timer channels because via timer channels in the s32 microcontroller I can set a pwm wave as the output with a certain duty cycle and thus I can vary the brightness of my LED there are various different timer channels available in this particular microcontroller let's just click on a random PIN so pa7 looks like we have
(1:43:28) timer 17 Channel 1 so if I select that on the left hand side timers activate it and set channel one to pwm generation Channel 1 and this of course now might not matter very much because we're not doing the firmware but it matters because we need to check that the timers are suitable for example for generating pwm there might be some timers that are capable and some that aren't of course in most cases pwm shouldn't be too difficult to configure even if it's just a GPO but this point persists across any interface you might use is check
(1:43:58) compatibility but pa7 looks like it could be okay so we can add an LED to pin pa7 which is pin 16 press a type in LED and we get a generic LED symbol again with a wire tool hook up to pa7 but we do need a current limiting resistor depending on the color of this particular LED and other characteristics a typical voltage or forward voltage of this led might be somewhere from 1.
(1:44:22) 8 volts or higher and typically you want to run currents just about 1 to 10 milliamps 10 milliamps already being very bright typically these types of LEDs are only run at about 1 to 2 milliamps so knowing the forward voltage knowing the current R through it we can calculate current limiting resistor assuming of course full duty cycle 100 ohms we would like to reuse we don't want to add another different resistor to our design the problem is 100 ohms is a bit too low but what we could do is change all of the 100 ohms to 200 12
(1:44:51) ohms and then we're pretty much in range with the current requirements in the forward voltage drop of this diode so let's do that the way I can do that is in the top in key card click on bulk edit fields and then we can scroll to 100 ohms and I'll change that to 220 ohms like so click okay and then we just copy one of these resistors down and connect up the LED and connect up ground to the other side of course have to make sure that the pin you connect the LED to can drive the LED even though it's a very low current there are some
(1:45:21) microcontrollers and some pins on microcontrollers that can't drive that much current so not much more than maybe a couple of milliamps so that's something you should double check as well then as usual I always like to add n labels so I did ledore a for anode and ledore K for the cathode or C if you prefer but that pretty much sums up our schematic for this s32 WB 55 microcontroller we have all of our bypass and decoupling capacitors we have our power and ground hooked up our highspeed external and low speed
(1:45:51) external Crystal oscillator the switch mode power supply the RF matching Network the filter and UFL connector our boot zero the tag connect Sero wire debug header USBC with ESD protection our simple ldo regulator and some peripherals we now know how to map out from Cube IDE with this we're pretty much done with a schematic but I would like to show you some tips of how you could maybe clean this up just a tiny bit it's fairly okay as it looks right now as a first pass but there are some things I would like to add as we did
(1:46:22) with for example this sideband use these pins we did these no ERC Flags or do or not connected so on the right hand side again add a no connection flag or press q and place that on the unused pins this is also a sanity check for us to see okay we've looked at these pins we must have done some manual intervention to place these no connect flags on them and this is what I do normally when I've gone through the M schematic when I've checked it if my schematic is more segmented and across multiple pages is I also like to draw for example bounding
(1:46:52) boxes around certain sections this could be for example using the tool on the bottom right or pressing I which is this add connected graphic lines tool and then for example I could draw bounding boxes around certain parts of the design like so add text or press T and I could call this the 5V to 3.
(1:47:13) 3 Vol regulator for example just so it's more clear for example to someone who reviews this schematic if it isn't already clear enough and just highlight certain aspects of the design or for example why do we choose this 220 ohm resistor what you could do is simply place a text field and then write down the calculation that we have 3.3 voltus 1.
(1:47:31) 8 volts forward voltage divided by 220 is about 7 milliamps so we can place for example calculations and this is something you I would strongly suggest you do placing calculations so you don't have to recheck recheck recheck jump back to data sheets and so on and that that verifies just your thought process when you're creating the schematic of course these are very very basic examples but it's something I would typically do so as a very simple example you could give your schematic page a title here with a simple single page
(1:47:59) schematic and every section I just quickly give a description of what it is and where we can quickly pick something out so if you're discussing this with an engineer or colleague you can say oh the boot zero switch and okay we can immediately jump to where that is I just for myself find this very helpful also when I'm doing PCB design checks and so on you will have also seen in the bottom right we have what's known as a title block and if we double click on this we can change the parameters in the title block so we could for example add in a
(1:48:27) date which is always good a revision depending on your versioning system you could say revision a or 1.0 or whatever the title company and so on so I'd strongly suggest you fill that in as well and that would then add in for example these text fields and this is always good practice keeping track of revision dates who the author was and so on but for now this is pretty much the finished schematic next we'll move on to actually picking Footprints and components that match up so we've only chosen for example values of these
(1:48:56) capacitors here 100 nanofarads but 100 nanofarad capacitors exists in many different packages and types and so on same for the resistors connectors and so forth of course there's far more detail you can add and you should add to the schematic so for example what type of capacitors these are are these multi-layer ceramic capacitors if so what type are they what voltage ratings are they and so on we'll go into a tiny bit of detail in this video but of course that's a topic in its own right we're now ready to choose Footprints and
(1:49:26) the specific components themselves as we saw from the schematic we've only really entered values of course we've chosen some parts specifically such as the microcontroller or such as the ESD protection but for example for Passive components such as capacitors and resistors we've just set a value and just put in a schematic symbol on our schematic we need to create a link with a real component and a real footprint that ends up on the printed circuit board which is is then manufactured by the PCB manufacturer effectively the PCB
(1:49:54) manufacturer sees next to nothing of the schematic but will see what parts we've Chosen and the footprints and the connectivity on the PCB itself now there are many many aspects that come into choosing the correct parts for your design and that's something that takes quite a bit of practice to get right so to speak however there are of course some simple guidelines rules of thumbs to get started I do have quite a lot of other videos on my channel that goes far deeper into Hardware design that I can do with this tutorial for example video
(1:50:23) number 114 looks at capacitor Hardware design Basics how you might choose ceramic capacitors how to size them for DCd rating what types they are how they age temperature dependencies and so on and I do have very many Hardware design focused videos on my channel I'll leave a link to those playlists in the description box below and please do check them out before we continue before we can assign Footprints however we should get The annotation in order because right now we've just taken The annotation which was given to us by key
(1:50:51) CAD every time we added in a component so for example on the left hand side j3 so J is typically a denotation for connector starts at j3 and then we have J2 here and on the right hand side we have J1 for our UFL connector similarly for resistors we have R1 down here because we added it first and then R2 and then the other resistors on this side same thing for capacitors and so on we want to annotate our components in a logical order that is typically from left to right and Depends top to bottom all section by section so therefore
(1:51:22) ideally want USBC receptoral to be J1 this tag connect header to be J2 and then maybe this yard header to bj3 and then the co actual UFL connected to bj4 we can do this at the top in key card by pressing and fill in schematic symbol reference designators clearing The annotation and then we can change the order that these symbols are annotated in so by XY how we do the numbering and so on so if I just go by this so I change this to Y position and click annotate and close we can see certain things have changed but of course it
(1:51:53) depends on the center positions of all these connectors and components so J1 being higher up than j3 gets annotated first then j4 so not entirely what we wanted so let's try that again and sort symbols by XY position clear and annotate this is a bit better we have J1 J2 j3 j4 but then we have odd balls for example at the top we have our ldr regulator we have C1 and then C6 and this is why I typically man ually or annotate my component designators so I'll start with C1 double click on the reference C2 C3 C4 and so on and of
(1:52:29) course this is a bit tedious but it allows me to annotate exactly how I want to because the tools in key CAD for example we only get to really have two options for the order which usually aren't in my eyes sufficient so I will reannotate the schematic as I see fit and I'll see you just in a second after we've completed this schematic annotation we need to perform an electrical rules check if we go to the top left second button on the toolbar edit schematic setup we can see the electrical rules check section and this
(1:52:59) is what this electrical rule Checker or ERC for short checks so if pins are not connected it'll show an error if the input pin is not driven by an output pin it will be error and we can change the severity by clicking on these radio buttons we'll leave them as default for now and simply perform an ERC so that we can do that here at the top right perform electrical rules check and run the ERC and we get three violations and one ignored test we're not using any spice models so we can ignore this test we have three violations if we click on
(1:53:28) one of them we we can highlight what you see is the problem and it's saying that the input Power Pin is not driven by any output power pins well this is a problem also due to this poorly designed symbol from the key CAD Library VX smps is not just a power input it's actually a power output so that's okay secondly this power input pin is not driven by any output power pins and same thing for the ground as well the way we can get rid of these ERC arrows is by adding power Flags so go add power symbol or press p
(1:54:00) and scroll down to power on a scroll flag and we will add this to the 5vt net as well as to the ground net just with a wire connection like so and we'll just get rid of the visibility run the ERC again and there we go we now only have input Power Pin not driven by any output power pins which was this V x s smps pin pin 33 but we know that's just got to do with the symbol itself other than that we don't have any errors it looks like nothing's unconnected we are okay to proceed now we are ready to assign Footprints and components to do so we
(1:54:35) can for example go to the Run footprint assignment tool in the top right toolbar and all the yellow marked components don't have a footprint assigned yet we have all these passive capacitors we have inductors resistors and other components as well when we click on for example C1 we're right at the top which is a 4.
(1:54:53) 7 microfarad capacitor key CAD automatically jumps to the relevant part so I can click on something else for example this 220 Ohm resistor and key cats highlights this part for us component selection again is a very involved discipline and something we need to take care of on doing if we for example click on the 100 nanofarad parts and then on the left hand side choose the capacitor SMD library on the right side with a filtered Footprints we can see we have many many different choices available we have very very small packages such as two 1 packages and very
(1:55:21) large packages such as 1210 capacitor packages what do we choose and I'll just leave this here as a rough rule of thumb rough guideline again please refer to video number 114 for more detail but we'll just quickly look at the component Distributors so now looking at Mousa I've looked for 100 nanofarad mlcc multi-layer ceramic capacitors and filtered for in stock we have various different options we have dialectric type we have a tolerance a case code and Imperial case code metric and a few other parameters what's important for us
(1:55:52) mainly to start off with is the voltage rating the voltage rating should be chosen to at least double the expected voltage the DC voltage across the capacitor in our design the maximum voltage these capacitors will realize is 3.3 volts and then we have this one capacitor which will be exposed to 5 volts or 5.
(1:56:12) 5 Vol so 100 nanopar capacitors we choose with a DC voltage rating of at least 6.6 volts so we choose nearest Value so that's at least 10 Vols DC usually the higher the better but of course there's a cost performance compromise so higher voltage rated capacitors will typically cost more unless the capacitance is very small then tolerance for these capacitors we want a rough value 100 narad is okay 80 nanofarads is okay 120 narad is okay so any tolerance is okay so I won't set any filter here however keep in mind that a 1% capacitor will be much more expensive
(1:56:45) than 20% rated capaca dialectric we want x7r or X5 R in this case this is to do with temperature dependence in terms of case code I typically go with Imperial case codes 402 is typically suitable for a design like this but you could even get away with using a larger 0603 to make things easy for us we're going to go with 0402 in this case and then just click apply and then we can sort by price and then we have many many different parts in stock they start at about 9 cents and quickly decrease in price so something like a 25 volt rated
(1:57:18) 100 nanar capacitor x79 42 10% tolerance this part for example would be absolutely fine but pretty much any other part we see here is fine as well but let's just go with the cheapest one so 042 and that's what we then move over to keycard so all 100 narad capacitors would be 042 Imperial so I can just select the footprints for all of those similarly for the resistors here we simply have a voltage rating a power dissipation rating a size a tolerance and so on we already saw that 5k1 resistors should be about a 1% tolerance
(1:57:48) for the USBC SE Lines no resist in this design really needs to dissipate a lot of power therefore for the sake of Simplicity let's just go with a 402 components for the resistors as well so now we have all of our resistors set as R r402 Imperial then we have for example these larger 4.
(1:58:08) 7 microfarad capacitors and again remember we have one which is exposed to 5 volts so we do a similar methodology going to our distributor and choosing a suitable package size for this something like o 805 is typically okay and even 0603 is usually okay for this as well so we'll go with 0603 for these larger capacitance capacitors for these other very small capacitors such as 0.8 picofarads and 0.
(1:58:32) 3 picofarads now these are very very very small values so even the pad capacitances will probably be in the order of magnitudes of what we see here so we will go with 042 capacitors here but keep in mind going back to the application note for the stm32wb hardware design guide we are given component values for these capacitors and these inductors now we can see here looking at them these are in fact not recommended for new designs but we can still get them at the time making this video but of course we can go with alternatives for the sake of
(1:59:01) Simplicity now we'll just go with these and we can see these are 042 and the dialectric is cog so all of these capacitors here we just go with 042 042 and these two capacitors which were still undefined value because we haven't chosen a crystal yet we'll make o42 as well we have an LED here for the sake of keeping the size is similar of course we can go with a larger one depends if you're hand soldering this or not I would probably not hand solder this so I'll just go with the LED so selecting footprint library on the left and then
(1:59:29) selecting LED with 0402 for the inductors such as L1 L2 remembering back to the data sheet section 3.7.1 we actually have recommended component values for L1 as well as for that smaller 10 nano Henry inductor which happens to be this murata part number which in turn happens to be an 042 inductor so in the footprint assignment tool L1 needs to be an inductor SMD and 0402 the 10 microhenry inductor again given in the data sheet should be an ' 0805 type but keep in mind this is end of life so we might have to find an alternative part but we
(2:00:06) can still go with the same footprint as there are many different alternatives for this so 10 Micro Henry 805 the 2.7 nanry inductor for the RF filter network will be 042 as well then we come into the slightly more complicated part of figuring out what connectors we want what push buttons and what crystals USB type-c receptacles I will just go with what key CAD has available so I'll go to connector USB so I can choose one of these connectors on the right hand side so for the sake of Simplicity I'm just going to go with this GCT USB
(2:00:37) 4105 footprint and we can preview the footprint by clicking on The View selected footprint button and we can also view the 3D model by clicking on The View 3D model button and this is the USB connector we will be going with so double click on that then we have our header and for this we can just go with any header of your choice it could be a 2.
(2:00:59) 54 mm pitch header Molex jst whatever you want we can filter by pin count by clicking the bottom that with a hash on it and this then only shows us connectors which have the same amount of pins as our S as our symbol on the schematic I'm quite a fan of these Pico blade connectors so I'll just go with one of these just for the sake of time for our Co actual connector we want to select our UFL connector so I'm going to go to on left hand side connector COA and we'll just go with one of these UFL connectors from hyros for push buttons I'm just going to go with a random push
(2:01:29) button example this one here and then we come finally to selecting our crystals for the crystals the safest bet to know what's compatible we will just go via the reference design again and we have some little descriptions here so for example for the 32 make crystal it's NX 201016 32m and for the 32.768 khz crystal Crystal it's NX 20112 looking for those part numbers we arrive for example at Mousa at this particular Crystal and this has a case size of 2x 1.
(2:02:01) 6 mm and load capacitance of 10 picofarads tolerance of 10 parts per million and a frequency of 32 MHz which is in Spec of what the data sheet wants and for the 32.768 khz crystal it's a 2X 1.2 mm package with a load capacitance of 12.5 picofarads and because we're using the same crystal here and we can approximate the same stray and load capacitances we will go with also 10 picofarads for C15 and c16 which we then map over to our own schematic but before that 32 MHz was 2x 1.
(2:02:34) 6 mm so going to key CAD assign Footprints with 32 megaherz we want an SMD Crystal so under Crystal Crystal SMD 2x 1.6 mm so we select that and for the 32.768 khz crystal we go with a 2X 1.2 mm package so 2x 1.2 to select that apply save schematic and continue and we've assigned all of the components now remembering that these capacitors should be 10 P farads we can change these values to be 10 each and again this is because we're using the same crystal as they are in the reference design and the same IC so now we have all of our components annotated we've checked the
(2:03:09) schematic of course you should do further checks make sure that the pinout is correct make sure the current consumptions are correct and so on but for now we'll assume this is all correct but I'd strongly suggest doing very thorough checks of your schematic before moving on to PCB design what we're going to be doing next is something you could also do after the PCB design stage but we' selected footprints for all of these schematic symbols what I'd like to also add is for example the manufacturer manufacturer part number distributor
(2:03:35) link and this will be useful when we're getting our board assembled and manufactured because we'll need to produce aill materials to do this we go to the top in the schematic editor and click bulk edit fields of all symbols in schematic and we are presented with this table here here we have our reference designators which are grouped by value with a value footprint and quantity we can of course add other fields so I'll add a field and we'll call this manufacturer another field which we'll call manufacturer part number and
(2:04:04) another field called distributor link for all of these parts we then need to find the suitable manufacturer manufacturer part number and distributor link and then later on you can see in the bottom button we can explore this as a CSV so for example for our crystals the 32.7 8 KZ Crystal I would go to Mouser I would copy the manufacturer part number the manufacturer is ndk and the distributor link is this mouse link for example or whatever your preferred distributor is and pop it in like so and this is what we do for all of the
(2:04:34) remaining parts for all the inductors capacitors resistor and everything that's in here again this might be just a quirk of key CAD or how the libraries are designed typically this information so manufacturer manufacturer part number distributor link and so on should be part of of the library and unique to every single component but this is just the way key CAD is organized unfortunately but ideally it should be part of the library to also list distributor link data sheet manufacturer part number and so on so I'll just fill
(2:05:01) this in by myself and we'll see this again later I've now filled in the manufacturer manufacturer part number and distributor link fields for all of the components in the symbol Fields table this is again choosing suitable components so for example for the resistors I have a preferred brand and I know their part numbers quite well and that's why I would just go with them or with the inductors we chose them based on the recommended guidelines the connectors again this is from previous experience I don't expect someone who's
(2:05:27) just started of course to know which parts to pick right away and this takes time takes progress and progress but this could be for example a starting point for parts you might want to use in your own design you will have also seen j3 which is our tag connect header also ends up in the symbol Fields table and that's to be expected because this is not the bill of materials which we'll export later but if we double click on this connector we can actually see the check box is marked for exclude from buet materials and that's exactly what
(2:05:54) we want the tag connect footprint is only for these pads and these through holes so it's not actually a component and that's why it should be excluded from the build materials what I'd like to do before we move over to PCB design is add some net classes that might help us when we come to the PCB design stage the way we can do that is at the top left click on edit edit schematic setup and then project net classes I'll add another net class and we'll call RF another net class for example USB net class power net class ground and net
(2:06:26) class Ser debug s swd for short what we can then do is below in the net class assignments add a pattern and say if the pattern for example is local so slrf and the for SL meaning local RF and star we can see on the right hand side the filter automatically finds all of the Nets that are compatible then we can assign all of those Nets to a net class for example RF we can do the same thing for USB so/ USB star is assigned to USB and so on this becomes quite useful because then we can set up for example Custom Design rules for those net
(2:06:58) classes we can assign custom colors in the PCB editor which makes our PCB design life a tiny bit easier and nicer and like so we've added in all of our nets for example for the power Nets that's why we've started them all with a plus because when we can do the plus star pattern and assign those Nets which are automatically detected AS Plus 3.
(2:07:17) 3 Vols and plus 5 Vols as power so we can save that and click okay and now we have net classes for all of these thank you very much for watching part one of this two-part series of videos we've now finished the main project creation and schematic part of this design and in the next video will be released in exactly one week time and by the time you're probably watching this video it's probably been released a link will be in the description box below as well as in the first pin comment 

(1) KiCad 7 STM32 Bluetooth Hardware Design (2/2 PCB) - Phil's Lab #128 - YouTube
https://www.youtube.com/watch?v=PlXd3lLZ4vc

Transcript:
(00:00) in this video we will go step by step through a complete Hardware design in kecat 7 for a Bluetooth capable stm32 microcontroller from Project creation through to drawing the schematic and figuring out the circuitry required laying out and rooting the PCB and finally ordering the boards at PCB way the board you are seeing here is something very similar to what we are going to create and features an s32 WB 55 microcontroller USB type-c connector for power and data as as well as a tag connect programming header and a chip
(00:32) antenna most of the design we will be creating in this video given the time constraints will be nearly identical however we will be using a generic UFL antenna connector instead of a chip antenna and won't root out all of the microcontrollers interfaces I will put relevant links in the description box below as well as timestamps of all sections of this video I really hope this video helps you design your own stm32 Bluetooth capable all projects and if it does please do leave a like a comment comment and subscribe for more
(01:01) Hardware design content in the future a huge thank you to PCB way for sponsoring this video the pcbs you saw at the beginning of this video were manufactured and assembled by PCB way those were four layer boards and included double-sided assembly and they did a fantastic job I'll show you at the end of this video once we finish the design of our own s32 Bluetooth capable Hardware what the ordering process is like at PCB way what files we need to submit and what the usual durations and costs are so make sure to check out that
(01:31) section near the end of the video make sure to go to pcb.com to check out their services but also make sure to follow them on Instagram to check out a selection of designs that PCB way have manufactured and assembled we can only scratch the surface in one of these fairly short YouTube videos going through the whole design but I do have F length courses available via fedl and I'll leave a link to this in the description below signing up to courses really supports me helps the channel and allows me to make this free content I
(01:59) have a mix signal Hardware design course with key CAD using kead 6 but it's applicable to many different ecad tools as well as an advanced digital Hardware design course where you can learn how to design with BGA packages high-speed systems such as gdr3 memory fpga system on ships and so on again I'll leave a link to this in the description below and thank you so much for your support we're now ready to move over to PCB design before that just a quick few words for example this symbol hid from us if we go to cube IDE these 80 81 pins
(02:31) and these are unused in our case so they also don't appear on the symbol here with that being said let's move over to the PCB design the way we can do that is go to the top toolbar and click on open PCB in board editor that will launch the PCB editor so we want to create a new file so click yes and we have greeted with a blank PCB editor and this is where we'll be doing the layout and routing and we have this new set of commands and controls and toolbars that is different to the schematic editor before we start any PCB design we have
(03:00) to set up our tool so that could be net colors it could be setting up design rules setting up the layers how many layers on the PCB we have and so on the way we do that in key card is in the top left the second button on the toolbar edit board setup we click on that we have many different options that we should adjust before we even start placing components on our PCB the first section here tells us about the layers that are available so for example we have a paste layer this is where the solar paste will be printed on the silk
(03:27) screen which is the typically White ink you will have on your PCB for example for text and so on mask layer which is the solder mask front copper back copper and many other different layers most of them should be enabled but I will turn off the fabrication adhesive layers as well as these user Eco layers because we won't be using them in this design then if we go to the second tab here this physical stackup we could of course try and rout this on a two layer PCB but these days four layer pcbs are very very inexpensive as well and unless you have
(03:59) a good reason to go to two layers it's often time more advantageous and easier quicker to do it on four layers and also has better physical properties than a two layer board in many of these digital cases so we'll go with four layers for this one so when we add in the four layers we can see we get this new stack up here so we have four copper layers front copper inner one copper inner two and back copper in between we have dialectric materials top and bottom we have sld masks past layers and silk screen layers what we'll need for this
(04:27) design is an impedance controlled board cuz we're rooting RF traces so we'll click on impedance controlled now in reality for the for this part of your to it doesn't matter too much if you click this or not but what we should adjust are the thicknesses of our individual layers and the types of these layers as well as the dric constants and this is something you would then communicate with your fabricator as well where we get this information from is from your PCB manufacturer of choice in my case I went with PCB way and any manufacturer
(04:57) will have this they will have a for example capability section but they will also have for example layer buildup or layer Stack Up section so that's what I've opened up here and these are stackups if we scroll down for example for four layers or for six layers and more these are standard stackups that they are okay with producing that they find easily producible and will be the most cost effective a typical four layer PCB is 1.
(05:23) 6 mm thick normally and PCB way has 1 oz outer and 1 oz inner copper files and this is where we read off the stackup so layer one which will be our front or top copper layer will be copper 18 microm plated to 35 then we have a preag material of a certain thickness so 0.11 mm we have this 2116 dialectric with a certain constant then we have the first inner copper layer or inner copper foil and then we have this core with a certain thickness and so on so this information layers 1 to four as well as the prepregs and core materials we move over to key CAD so for example for the
(05:56) dialectric one I'll would click on the three dots I'll type in 2116 that was the dialectric and our Epsilon R which is our dialectric constant was 4.29 same thing for dialectric 3 and the core was the center material this is F4 and that was 1.2 mm and typically that has a dilc constant of about 4.
(06:16) 6 the copper thicknesses are okay so that's 35 microns on each layer and then we have the masks we can choose a specific material it's not really too important in this case the prei thickness was of course 0.11 and now we get a final Bard thickness of about 1.6 so just under 1.6 mm of course this is not taking into account any tolerances it's always good to import what your board Stack Up is into your ECB design tool and this is something you should later then also communicate with your manufacturer and we'll see how to do that when we come to
(06:44) the board ordering process the next tab we could select for example the copper finish we might go with hot air surface leveling lead free we can change sold Mass expansions sold Mass minum webs and so on in kyat they leave the sold Mass expansion to be 0 millim you can leave this at 0 mm and let the fabricator adjust the solder masks but typically I would set it myself typical solder mask expansion values might be 2 to 3 mil and that's an imperial unit and 3 mil is about 0.08 mm so we might type in 0.
(07:15) 08 mm here solder mask minimum web width we can find by going to the PCB manufacturer so looking for PCB way and then looking at the solder mask and scrolling down this depends on the color of solder mask you choose so if we choose for example red black blue or white this might have a different solder mask might have different solder mask parameters than if we go with green for example and on the PCB website that is what we see as well so for green the solder mask has certain parameters for example a minimum Bridge of 100 microm
(07:44) but for other colors such as red blue white and black this bridge increases so you need to know this ahead of time we'll just go with green so that's why we can go with a bridge of about 100 micrometers but they do recommend 125 micrometers or microns instead so I'll type in 0.125 then going to text and graphics and we'll just leave this as default for now formatting text variables we can all leave as as they are what's the most important is setting up your design rules however and in particular these constraints predefine
(08:12) sizes and we set up the net classes as well constraints and design rules are what rules we have to adhere to to make sure that our PCB is manufacturable so for example if we're rooting two traces these traces can't be too close to each other otherwise we can't etch the Gap in between those traces Al the spes can't be too narrow themselves they have to have a certain width and so on for example drill holes can also not be too small or too large and this is the information we fill in on this section in the board setup capabilities depend
(08:42) on your manufacturer choice for this of course I'm going with PCB way and they have their own capabilities section so going to the PCB website SLC capabilities we can find the capabilities here and this information we need to transfer over to our ecad tool so for example they can do minimum drill sizes point2 up to 6.
(09:01) 3 mm the widths of anular rings the whole size tolerances and so on are all listed here that being said these are the minimum possible manufacturing capabilities and you should aim to stay away from them there's no talk about what these things cost on this page if you go below these Minima to see how this all affects price let's go over to the actual online quoting system and this is quite interesting to play with so for example for 100x 100 mm PCB let's go with 10 pcbs selecting four layers and leaving everything else as default the base cost
(09:32) is about $ 51 is do for 10 pcbs now this is assuming a minimum track size and a minimum track spacing or feature spacing of 6 mil 6 mil is about .15 mm so if we go down to 5 mil so that's about .13 mm the price hasn't changed but if we go down to 4 mil so that's about .1 mm we see the price has increased so without a cost Adder we can go down to 5 mil traces and again 5 mil is about .
(10:01) 13 mm same for the whole size so automatically it's selected. 3 mm .25 mm doesn't add a cost but if we go down to 2 mm we can see the cost jumps dramatically so therefore we want to keep our whole sizes to .25 mm or preferably to3 mm or above solder mask choice of solder mask color also impacts the price so if we go to green to matte black we see the price jumps up so for Prototype we might as well just go with green silk TR also affects price in any of these other options so for example the surface finish will affect price as well and so
(10:35) on all that being said is that we need to take these capabilities with a slight grain of salt we want to stay above these capabilities and also that they don't add cost unnecessarily if we don't need these capabilities so going back to key CAD our minimum clearance let's stay away from the minimum we saw that was about 6 mil 5 mil so let's go with15 mm and same for the track width this will not add any cost and is perfectly okay for for a four layer boolt minimum connection width is the minimum feature size so if we're doing a copper pole for
(11:04) example or polygon that would be 0.15 as well minimum anular width and minimum via diameter is the next section when it comes to anular ring this is to do with flated tri holes and vs for example typically we have a v we have have a drill and we have a finished hole diameter so we can see the image on the top here the finished hole is after plating so after it's been drilled and then plated we get the finished whole diameter which is what we typically specify in our PCP design tool then the diameter of the pad we have as well an
(11:33) effect the difference between the diameter of the pad minus the diameter of the finished hole divided by two is the anular ring so o outer anular ring in this example we of course have the same thing for inner layers as well the calculation typically that finished hole is1 mm smaller than the drill hole and this is what we see here so we're actually using a drill hole that's .
(11:55) 1 mm larger than the actual drill diameter we want so if you want A3 mm hole we drill 4 mm and we play Down to3 mm therefore our anular in calculation is actually like so it's pad minus drill +1 mm all divid by 2 and this gives us the anular ring typically an anular ring of15 mm won't be a cost Adder minimum V diameter I'll go with 65 and we'll see why in just a second copper to whole clearance we typically want.
(12:25) 25 or larger so we'll go with 26 just for this case and copper to Edge clearance will go with3 mm as that's a sensible proper to Edge clearance again this is taken from experience and taken from PCB capabilities from your chosen manufacturer minimum thr diameter we saw that .25 mm does not add cost so we'll go with that hold tole clearance will go a bit larger at 26 so now we filled in all of our constraints at least the ones that keycard allows and then we go to predefined sizes in key CAD we have to Define our track widths v's and
(12:57) differential pair sizes before we can begin rooting in terms of tracks we might go with a 0.15 MM track as our smallest and we might have traces that go for example 2.3.5 and 1 mm this is just a selection just a basic to start off with and these are the track widths we can then choose and rout out in when we come to PCP rooting with vs typically I will go with a 7 mm diameter V and a 3 mm hole doing our calculation so it's 0.7 - 0.3 + 0.
(13:28) 1 all divid by 2 gives us a minimum annular ring of 0.15 So within spec and that's why I choose these via properties it could be that we might need a smaller V hole so 025 mm remember this was the smallest we can do without a cost adder and that allows us to reduce the pad down to 65 and still have our minimum anal ring of 0.
(13:48) 15 and finally we'll just add a larger VR just in case at4 mm finished hole and .9 mm diameter what we haven't talked about yet is impedance control I won't be going to detail on what imped control traces are in this video but we do need to use them in this video i' please refer you to my video number three on my channel which goes over what impedance control traces are when you need them and how to set them up in kecat effectively impedance control traces are needed high-speed signals RF and digital that we match impedances to drivers and receivers
(14:19) we'll need this for the USB differential pairs as well as for RF sections we'll need to use impedance control traces and this depends on the stackup and remember the stackup was what we set up earlier in our keycard tool to get the trace widths we need for the RF sections and for the differential pairs we need to use an impedance tool or impedance calculator and there's many different variants out there best thing is to talk to your manufacturer so I would send pcbaa a message for example and say I need a 50 ohm track with this particular
(14:47) Stack Up what Trace width do I need this is definitely something you should do but you can also get a ballpark figure by going with impedance calculation tool in this case this is from PCB way we will be using outer layer traces in this example Le so we're using surface micr strip there are also other different forms of impedance control traces what we need are 50 ohm traces for the RF lines and we need to figure out what width we need given our board stack up so remember we're rooting on an outer layer or bottom layer we have a pree
(15:16) that's .11 mm and a dialectric constant of 4.29 so we'll type that in 4.29 dialectric constant thickness of the copper was 35 microns and the height so the height or the the thickness of the dialectric was0 .11 mm therefore if we just try out some Trace widths for example 0.2 we can see that already gets us pretty close to our Target impedance of 50 ohms so to get the impedance higher we need to reduce our Trace width so let's try 0.18 0.
(15:45) 18 and that overshoots a bit so maybe something in the middle 0.19 and there we go we hit 50 ohms directly so we need a 0.19 MM Trace width to give us a 50 ohm controlled impedance trace for this particular stackup again talk to manufacturer it's the best and easiest way to do it and most accurate so in key CAD let's add a 0.
(16:05) 19 MM single lender trace on the left hand side but we also do need to set up differential Pairs and for differential pairs we have again this USB differential pair should have a 90 ohm differential characteristic impedance for this we will use the edge coupled surface micr strip model so one below the surface micr strip and we have the same board parameters as before copper thickness of 35 microns we have a dialectric thick of .
(16:31) 11 and an Epsilon R of 4.29 our dialectric constant now we have two parameters to play with with this differential pair we have the trace width itself of the individual positive and negative parts of the differential pair but we also have the trace spacing so how far apart they are or how close typically for USB we would also want a 50 ohm single-ended impedance so we'll use the same Trace width as we had with a surface micr ship to start with 0.
(16:54) 19 mm and then we can see the single-ended impedance so Zed is about 50 ohms which is what we pretty much had before in the single-ended case however we still have the spacing to play with so this s parameter and that will influence to an certain extent the differential pair impedance which at a spacing of 0.
(17:13) 15 mm gives us a differential pair impedance of 100 ohms which is just over 10% higher than what we wanted to be so if we reduce the spacing so for to 0.12 we actually bring down the differential impedance the problem is we've now reduced our spacing below the minimum clearance we had which was .15 mm so the lowest you want to go with the spacing is15 mm however that means we don't hit our differential pair impedance Target which means we need to adjust the trace width so if we change that to 0.
(17:44) 22 we can see that of course the single end impedance drops because we've increased the trace width but our differential pair impedance now gets closer to 90 ohms now keep in mind we are using USB 2.0 full speed which is these days a very very slow interface and we are probably going to create a very small board so we don't actually need to control impedance but it's a worthwhile exercise doing to get an approximate value for impedance so let's say we go with a 22 mm trace and a15 mm Trace spacing so moving that over to keycard
(18:14) we add a differential pair with a plus at the bottom so Trace width was. 2 and a .15 mm Gap and then we also have the V Gap so when we place differential vs we want them spaced a certain amount and we'll just space them .5 mm to start with let's see if we even need vs now we have all of our tracks predefined we have our base tracks as well as the controlled impedance traces we have the vs and a set of differential pairs for USB 90 ohms then we have net classes and these net classes are actually taken over from the schematic remember we set
(18:46) up the net classes with these patterns but we haven't imported anything from the schematic yet so we don't have any Nets matching we can also add in custom rules if you want and violation severities just like we had with the ERC but for now we can press okay and press save and now we've set up the basics of our board on the right hand side we can now see that we have less layers than what we started with we only have front copper inner copper the top inner copper bottom bottom copper the paste silk screen masks and some other layers so
(19:13) now we're ready to import the components onto our PCB now that we have our PCB set up and our PCB designer all set up we have just the layers we need on the right hand side in the appearance panel as we saw earlier we can also go through other tabs looking for example objects we can change their visibility what we can see what we can't and also go to Nets where we already see we have our net classes imported to now have the component imported what we need to do is either press f8 or go to this top right toolbar update PCB with changes made to
(19:43) schematic we click that button we will get this dialog box and this tells us what will happen to the PCB so we're going to add all our symbols that we have on the schematic use those Footprints to add them to the PCB we hope that there no errors and no warnings and then we can click update PC B close and then without clicking I can move my mouse I can zoom in zoom out with my middle mouse key as usual and I'll just place this set of components by left clicking and I can click away middle Mouse button drag I can move
(20:13) around to the PCB and now I have all of the components that we created on our schematic as symbols and then we then linked with footprints on our basic PCB to view this in 3D I can either go to the top left view 3D viewer or I can press Alt three on my keyboard and this will then display a 3D view I can click with my left Mouse button and drag to then rotate this PCB in 3D view again middle Mouse wheel to zoom in and zoom out and you can see key CAD has now defaulted to a default board outline and you can see board outline is missing or
(20:46) malformed in the top left because we haven't defined our board outline yet and that's something we'll get to later on as well but here we can see all the components USB connector our s inf2 microcontroller various passives and so on but we can immediately see a couple of problems and this is something that bugs me with keycard quite a bit is that the library links are very often messed up for example the connector this merlex Pico blade which we can see here with these four three holes or X2 which was our high-speed external Crystal or X1
(21:15) which was our low speed external Crystal they're missing 3D models although they should be included with the key CAD libraries so we have to fix those links first of all I always think it's very important to have all 3D models in place of course for the tag connect header or or the pins rather we can see we don't have a 3D model because they're just pads and through holes so let's go and fix the 3D models first of all we can close this 3D viewer top right for example clicking on our Molex P blade or double clicking rather this will open up
(21:42) this footprint properties panel and we can see have various tabs which you might explore later as well but for example the third tab 3D model we can see that it's linking to for some reason kead 6 which I don't have installed on my computer or maybe I deleted it so maybe that's the issue you we see have an X of file not found so if I so if I click the little folder icon next to it it jumps to where it's trying to find the model so under program files key CAD 7 and so on 3D models and these are the key CAD default 3D installed models so
(22:13) we're looking for 5348 0410 for some reason in key 7 maybe this doesn't exist anymore but it still exists in the symbol and footprint Library so this I always find very frustrating so the way I would then find the missing 3D models if they're not in the key CAD live lies I would simply type in the part name for example for this Molex PE blade it was this number go to the Molex website which happens to be the third result scroll down and we can find the 3D model as a step file which is zipped in this case so I'll download that then you have
(22:43) this ZIP archive with the step file in it so now either you can put that in the path that for example key card effectively sent us to so this 3D shapes folder and then copy this name change that to step so that's one option but for the sake of Simplicity I'm just going to copy it into the project so we can make a new folder with step files for example so we have it locally or you can do it globally however you want to for the sake of Simplicity I'm just going to copy it in here into my local project folder then back in key CAD on
(23:09) footprint properties I'm going to click this folder icon again on the right and navigate to where I saved it and then select my step V double click and you can see it's not centered properly so I can play with the offset controls rotation controls on so on to try and get this aligned now this is unfortunately very manual I might be wrong but I don't think there's another wave actually aligning this for example I could align in other programs the axes from the PIN to the through hole and so on but it looks like we have to do this
(23:36) manually so now I've roughly aligned this 3D model with the footprint with the through holes using the offsets and I can click okay so again pressing alt three to get the 3D viewer now we can see we have the connector model in place as a 3D model as well so I'm going to do that the same procedure for X1 and X2 my crystal oscillators just to make sure we have all the 3D model in place and I think that's very important for example when you would hand a design off to your mechanical team to check positionings clearances and so on so I'll do that in
(24:06) my own time but please make sure to do that on your end depending on what schema you've designed please add in the missing 3D models if you can't find the 3D models via the manufacturer website which is quite often the case I can highly recommend two websites first is 3D content Central and I've managed to find many many fairly accurate step models for the parts I'm looking for here as well as grab cat so those two websites if you can't find them on the manufactur websites as before please go check out those sites and using exactly
(24:34) those methodologies we can see we now have all of the required 3D models in place so for X2 J2 as well as X1 which had the 3D models missing and now we can finally get around to starting with the layout of this PCB but these are the essential steps that I would do first make sure my footprints and models are all there right from the get-go before we get started with layout on the right hand side remember we did add net classes before four and this will help us visually identify where certain Nets are and where connections need to be
(25:03) made you might have already noticed these rather thin air wires which sometimes are crossing over going vertically horizontally many different angles and these are what's known as part of a wrapped nest and these are the connections that need to be made and haven't been made yet and this is again taken from the schematic so for example usbd minus has this air wire going to the top right because we have to go to our ESD protection and our ESD protection has has these air wires parts of the Rat's Nest that need to go to the
(25:31) USB type-c connector and this of course you have to keep in mind for rooting later on but of course also for layout we wouldn't for example want to place our USB connector completely different to where our ESD protection is so the airwise these rats nests can guide us the reason why I'm bringing that up first is is because this is very important for layout but also coming back to net glasses on the right hand side the reason we Define those is then also to make our life easier because we can can assign these net classes
(25:59) different colors so for example on the right hand side on the net classes if I go for example to sah debug you can see this little Checker mark on the left hand side I double click on that I can define a color for that net class now I could have done this in the schematic as well in the PCB we can use this color select tool to then for example assign a color let's say I'm just going to go with blue press okay then on the net display options below I'm going to change my net colors from Rat's Nest to all colors with that option enabled we
(26:29) can now see that all the serir debug nets for example for this tag connect header so dat iio clock trace and their in reset line are all in the color we just selected as well as The Rat's Nest so these air wires are also the same color but of course also the Nets that originate or end on the mic controller are colored in blue whereas all the other Nets are stallen in other colors and this is incredibly useful tool when doing PCB layout and routing to quickly visualize where connections need to go so for example we now see this tag
(26:59) connect header probably needs to be aligned somewhat vertically Above This microcontroller or depending on how we rotate it later on same thing if we change for example the RF Nets on the right hand side double click on the Checker Mark and we might change this let's say to Yellow all the Nets that are yellow are RF Nets and typically I give these more critical Nets such as RF for high speed brighter colors to really jump out and say okay these are critical Nets they need more spacing they need to be rooted a certain way and so on so
(27:28) other than the design rules you can set up I find colors to be a very very important tool and we can set that for everything else we have in this design so USB we could for example give this a color green power typically we might want to give this a red and of course you could distinguish between different types of power if you have for example a 1.8 volt rail a 3.
(27:49) 3 volt and so on you can give these nets different colors ground is also a very important one to change on its own and ground because it starts with G we could say it's maybe gray or green I will typically always give my ground a somewhat grayish color so I'm tiny bit color blind so I'm not entirely sure if this is gray or more green but let's say it's gray and this immediately identifies to me where ground is I can see okay here's ground or this pad is ground that pad is ground and so on just by colors rather than having to read Nets so immediately I've
(28:19) gained valuable information just by designating net colors we can do this for any other signal we want for example the switch mode power supply we don't have a net class and that might a good thing to do as well if you want to retroactively do that we can go back to the schematic so as we've named our net somewhat sensibly with the same starting characters we can then go to the top left edit schematic setup again and this is where we edited our net classes previously so you want to add a new net class press Plus at the top and then
(28:47) we'll call this snps or switch mode power supply and then we also need to assign the net class at the bottom so the plus of the bottom for slash for local snps star and that now selects all of of our snps Nets we just assign this to a net class and we'll assign this to snps press okay save the schematic go back to the PCB top right and now on the right hand side in net classes we can see it's snps net has been added so we can double click on the color and let's change this for example I know to some pink for example something that's
(29:16) different and here we go we immediately see where the switch mode power supply Nets are so 33 31 on this new color we can see that the junction between the inductors is the same and that output is a different color and the output capacitor c14 also now has a new color and I find this an incredibly intuitive visual wave of identifying where relevant Nets are and where groupings of Nets are you can of course change the visibility so it's just for The Rat's Nest those colors which I find a bit hard to see and that's why typically
(29:44) always leave it on all and we can of course hide The Rat's Nest or show it and I would prefer to show it for the most case you can of course hide rats nests for specific net classes and so on but for now we'll just leave everything on so I'd recommend you do that for your own designs and split them up into logical colors at least to you logical but for me I really like to keep power in the kind of Reds ground either gray or green I prefer gray in any case now we've hopefully got a bit of a better visualization of what's going on and
(30:12) what parts on the PCB need to be connected to what other parts on the PCB before we even start with rooting we need to have our layout sorted and then we Define our V outline maybe add some mounting holes and so on but we don't really touch routing unless we've done at least some of rough layout occasionally as we'll see we might root out certain bits of track for example to see if we can get past some components but for now we just want to use these colors and these rats nest to guide our decision of where to place components
(30:41) given that this is a fairly simple board this might not take very long this is an iterative process so I'll Place one component Place Another I'll see that there's constraints because one might not fit and I have to move things around so your first solution might not be the optimal and might not be the solution you go with always keep that in mind mind in any case for this design we somehow or somewhat have a centerpiece and that's you to on micr controller so we'll start with this as our foundation maybe let's say our origin and we'll
(31:09) build around that so by clicking on it I can select the part I can then press M to move I can press cancel to reset it back to its original position because initially for initial layout I want to change my grid the grid where you can see the top I can press this drop down and we can see have many different ones available we have these Imperial grids so in inches or thousands of inches and we have this millimeter grid I typically will use millimeters and of course if you're on the US or some other country that uses Imperial then you would go
(31:37) with Imperial but I would suggest going with millimeters and using a fairly coarse grid and coar in this case meaning maybe 1 millimeter or half a millim to start doing your layout so I can select the grid of 1 mm and it's always important that you line all components to a grid I wouldn't suggest going with grids for example as small as for example 0.
(31:56) 01 or something like that even when you're find chuning the layout so the smallest grid I might go with is 0.1 mm but to start with we'll go with a 1 mm grid click on U2 press M to move and we'll just move that in its own little section for example like here and you can see if we double click on this component I've moved it to position that is currently on the grid and we can change the origins and so on but I just like to start off with somewhat sayane let's call them numbers so round numbers 70 70 something like that is fine then we build around this part what I'd
(32:24) suggest you do and I typically work with two monitors but for the sake recording this is all on one monitor you should have your schematic next to your PCB layout tool so for example I know this is a tiny bit cramp this is just to show you on the left hand side on the right hand side wherever you would have your schematic on the other side you would have your PCB and anytime I click on a component on the schematic so for example C10 the PCB editor and key CAD jumps automatically and this is really useful if I'm rooting out sections so if
(32:50) I want to for example connect my microcontroller to the uard connector I would just click on the connector and I can then move that over to where it needs to to B the same thing works the other way around so if I'm on the PCB editor and if I click on J1 the schematic will jump to J1 this is a very useful tool and it always pays off to also have the schematic open while you're doing PCB layout and also PCB rooting later on just to make sure because we've designed our schematic to have hopefully somewhat of a logical
(33:16) flow that we go for example from J1 AR to connector through to the ESD protection through to the micro controller so typically your PCB layout might also follow that logic of course depends on space constraints and so on also with any PCB design there are sections that are more critical and less critical than others and it's important to identify those early on and already Place those more critical sections for example first or root them out first and so let's try and do that here what's of course most critical will probably be
(33:46) this RF section this is sensitive circuitry we have digital circuitry very very close by on this board so it's important that we for example prioritize for the matching Network the filter and antenna connection and aim to keep those short and close to the microcontroller similarly for switch mode power supplies you want to keep Loops short nodes short and compact for example especially these switching nodes for example these LX nodes they need to be nice and compact close to the microcontroller as well very similarly the highspeed external
(34:15) crystals and the low speed external crystals these are sensitive analog traces short connections away from aggressors for example higher speed switching circuitry and so on the USB traces for the USB differential pair although it's only full speed we want to root that with K as well then also the S debug might be less critical but then of course there are even less critical parts for example the boot zero that's basically just a DC signal and we hook that up to a switch so maybe we can prioritize that to be last similarly for
(34:45) the N reset line which goes to the tag connect header that isn't particularly critical either of course it has to be connected but how we root it isn't that important same thing with these TX and RX lines yes they could could have fast Edge rates but compared to for example the RF sections the uart is less critical what is also critical is the placement of the bypass and decoupling capacitors these need to be close to the relevant power pins on the device so this is something you might want to prioritize as well and so PCB design and
(35:12) Hardware design is basically a list of compromises we have to see what sections influence the other what do we need to prioritize what can we lay out and read first and then the whole PCB is a compromise and there's many many different things and there are many different versions of the PCB we could create depending on what we prioritize above something else that being said with the layout we want to First will do a rough layout approximately where are the connectors where's the MCU and so on and then we fine tune our layout and add
(35:40) in smaller smaller components also we might want to do layout section by section that is for example the ldo regulator has C1 and C2 next to it so maybe we can put those together and then lay those out as a section so we move C1 U1 and C2 together as a whole rather than individually when we do allow so there's many different ways of attempting this but let's see how I for example would do it in then in just this first iteration so this particular board I haven't laid out or rooted before so there could be many other ways and
(36:09) equally good ways of doing this this would just be the first thing for example that comes into my mind so zooming out a bit we can see the microcontrol in the center here we still have a grid of 1 mm and let me just rotate this microcontroller so if I click on this microcontroller press R you can see I can rotate and this is just personal preference because I've designed a similar board like this if I rotate it once that my RF pin is to the right and that my serial wire DWI connections are to the right we'll see
(36:36) why that makes sense in just a second this reference designator which is actually on the silk screen layer so the front silk screen layer I can click and press m r to rotate and I can just move that out of the way for example or you can hide this layer by on the right hand side clicking the little I symbol that hides the silk screen layer if you would like to do that what I'd like to then take next we can see on on the left hand side we have the USB differential pair and the Ser debuck so that looks like those connectors should be to the left
(37:04) of our Mark controller so either in the PCB we can find those connectors or on the schematic on the left hand side I can click on the tag connect header which then selected in the PCB editor press M to move zoom out with the mouse wheel click and drag with the middle Mouse wheel and I can place it for example left of the micr controller if I rotate the part we can maybe see already a somewhat optimal location and to me that would be for example like so this rotation to me is optimal well and more optimal than for example 180° because
(37:34) now the main signals such as diio clock and Trace face exactly where they need to be so these rats nests these air wires go pretty much straight into those paths di goes straight to the left left and left to right clock goes left to right Trace goes left to right whereas less critical signals such as C wide reset or the 3.
(37:56) 3 W and ground they can be rooted anyhow the length isn't particularly important especially for this end reset which needs to go to the bottom planning ahead in my head I could root this out later on for example like a little Loop like so this could be an example but we're doing rough layout right now of course it probably makes sense to move this connector so pressing m a bit further away that we have space in case there need to be any decoupling capacitors which it looks like they need to be for pin 40 but this might be an initial guess then for example our USB
(38:24) differential pair looks to be above it so on the schematic again navigating to the left hand side clicking on J1 our USB connector and then the PCB editor press M I can move that rotated with r so that could maybe set at the top right above so in this way we wouldd have a short connection usbd minus D+ that could rout into our USBC connector that of course will be one option of course keep in mind it depends on board outlines and so on or we could place it like so in this way we have everything on our line which could make our board
(38:55) maybe narrow in the vertical iCal Dimension and we could still rout out our USB differential pair above like so past the Ser connector into our USB D minus D plus differential pair so that could be an option as well and it would also leave more space for the pins at the top the switch switch power supply LX pins we know we need some components at the top here so again it depends on preference what you want to prioritize and this could be that our initial rough layout isn't the final layout but it could be a starting point so it's up to
(39:25) you if you want to go this route or if maybe you want to go this route both in my eyes are fairly okay but I'll just go with this for now on this topic of course I'm very very free with how I design this board in this particular tutorial video I don't have any mechanical constraints for example there's no mechanical engineering team telling me I need mounting holes here and the board outline needs to be a certain shape and I have these constrained Dimensions this of course will change your layout considerably
(39:51) let's say I am only allowed to do a small rectangle like so then of course I can only place my USB connector here I wouldn't have space to put it here so it really depends if you're fitting this to an enclosure if you're not if you have any mechanical constraints and so on keep this in this video in mind that this layout is very very free I have pretty much next to no mechanical constraints of course I don't want to make the board arbitrary large so I wouldn't want to put my USB connector here or my MCU over here I want to make
(40:17) it fairly compact because a larger board and course increases cost and there really isn't a reason to to make it excessively large same way we don't want to make this excess Ely small we don't want to move these components so close together that okay it might still be manufactural but we might have to jump to a double layer assembly so there's always this compromise and this comes with experience with doing this over and over again that there are different solutions but they might all be equivalent Solutions or very similar
(40:45) solutions that all work relatively well again keep in mind mechanical constraints can considerably impact the layout and rooting of a design in this case we are very very free so please do keep that in mind in any case this might be an initial guess of where these connectors might be this gives us maybe later on a nice elongated shape as you saw the PCB in the beginning of the video the real life PCB that I had made previously follows this kind of shape as well and also placing the USB connect on this side and the tag connect head on
(41:14) this side means on the right side because we've labeled we've colored our RF net as yellow we can simply root out RF to the right side so far away from the CI debug and far away from the USB differential hair also far away from the switch node nodes which are these pink nodes over here so the next critical section or the next connector we might want to add in is the RF or the antenna so for example our UFL connector j4 if I click on that and M to move again this will have to be somewhat to the right side of the MCU so for example somewhere
(41:46) here now I could place it over here for example right next to U2 but keep in mind we still have the filter we still have the pi matching Network in between that needs to fit in between U2 and j4 so therefore already I'll give myself just some space approximately that I know okay something has to fit in between this RF pin and this UFL connector so something like so as an initial guess again this is rough layout now I could immediately place the filter down so I click on the filter press M to move I could place the filter very
(42:17) roughly where it needs to be and then I could take my matching Network and place it next to it and figure out a rough size immediately straight away that would be one way of doing it completely fine another way is maybe first of all focusing on all other parts making sure everything fits around and then we can Define maybe a board outline again there many paths that lead to room so to speak X2 is another critical component that's our Crystal oscillator for the high speed external so I can click on x2 this is this four pin package press M to move
(42:45) and again following the rats nest you can see the rats nest are very long and we want to minimize our Trace length so it looks like it has to fit somewhere up over here and that's why these rats nests are so useful we have HC in and HSC out so for example HSC out and HSC in look like they have to loop around so I can press M rotate like so and maybe that's a better placement again we will find sh in the layout later on but approximately our highs speeded external Crystal needs to be somewhere close to pins 24 25 and that's derived for
(43:15) example from using the rats nest same thing for the low speed external so X1 press M to move and we can immediately see the rat's nests also lead to these capacitors the load capacitors c17 and C8 but if we move X1 closer to U2 you can see these rats nest jump because we have these multiple connection points so whatever it's closer to the rat's Nets will jump to and these happen to be the bottom pins of U2 so U2 seems to be here and the rat's Nets are crossing so the way we can solve that is press R twice to rotate the component by 180° and it
(43:47) looks like X1 should be somewhere around here the way it's placed right now is good because now we have symmetry between the center line of pins 2 and three and we have symmetrical connections rooting out again this will come to with finer tuning of layout later on but I move this for example very close then I won't be able to rout out maybe pin 4 and pin one so even with this rough layout I still want to give myself some space again always thinking ahead what's also important is of course the switch node so L1 L2 and so on so
(44:18) I'll take L1 First Press M to move again following The Rat's Nest we can see on the left hand side it wants to go to U2 on the right hand side it wants to go to l to but U2 pin 33 if we zoom in we can see pin 33 is that LX pin which is a switch Noe this is a comparatively High current pin it's switching at a very fast rate probably fast Edge rates as well therefore we want to keep this node short so I could either place this inductor maybe something like so but then that blocks maybe other pins such as these 35 pins 34 and the ground pins
(44:48) so by taking this component and pressing R to rotate this allows me some more space Maybe to root out the other pins again thinking ahead not placing Parts too close if I place it too close not might I might even be able to root it out but assembly and testing might be difficult as well so give yourself reasonable amounts of space then L2 this is in a bit of an odd construction because effectively L1 and L2 form so to speak a single inductor but that might sit somewhere like so and then of course we have our a capacitor c14 and these
(45:19) three components form the whole switch node filter and keep in mind again this is a very very rough placement I'll show you how to place them much better in just a second finally we have maybe less critical components such as the ldo or the uard header example if I click on the uart header M to move again following the rat's nests this is a bit difficult because the rat's nests actually go through the txrx resistors so by placing J2 first I don't actually know where to go unless I look at the pins which happen to be 11 and 12 or
(45:50) alternatively I could pick up R3 and R4 and that would tell me a bit more just by looking at The Rat's Nest that we we have to go to the bottom right so many ways of doing it I could look at the pins or look at the rats nest but for example R3 and R4 should sit somewhere down at the bottom and therefore our connector might sit somewhere at the bottom as well just as an example and so as you're seeing we're taking these larger blocks so not always these individual resistors but with these larger blocks such as the
(46:16) microcontroller connectors critical more critical main parts of the circuitry and placing them approximately where we think they need to go based on Rat's Nest prioritizing for example RF is more sensitive than for example the UR connector and so on and in this way we start forming the basics of our layout again for more complicated designs you will have to compromise even more this is fairly straightforward and we don't have you know particular mechanical constraints so the shape of the board or the shape or the placement of components
(46:46) somewhat naturally falls into place but you'll find with many PCB designs this is actually the case from this we of course need to add in the other components as well before we find tun our layout so for example X1 still needs these load capacitors c17 c18 or we still have to put in the matching networks and so on once we place them into part we might have to space components out a bit more and then we fine-tune and fine-tune and fine-tune the layout keep in mind we haven't even popped in the bypass and decoupling
(47:14) capacitors as well so this is another thing to do but let's put in the main components first and then we can add in the bypass decoupling capacitors as well so for example D1 we click on D1 this was the USD protection for the USB that needs to be in line with J1 and U2 so it looks like we have to move j3 a bit to the right to make sure this fits in and of course you want to give it some bit of space as well you can also see this pink layer Courtyard layer tells us about the minimum clearance these components should have to each other and
(47:46) this is part of the footprint itself so putting in components like so is fine these are fairly close together but for example overlapping Courtyards or overlapping pads is a nogo so something like this might be more suitable keep in mind we're rooting in for example from J1 into D1 which is fine but then out of D1 we might have problems getting past these non-plated through holes to get to U2 so we might want to select and drag and move these components out a bit more so that gives us room to breathe again an iterative process making sure you
(48:18) plan your layout ahead of time while you're doing it because a good layout will make your routing so much easier and this will hopefully minimize the number the vs you need to use the transitions between layers the layer counts and so on so it really pays off to do a good job at layout then for example the if section we have C15 L3 c16 and this could be for example a structure like so I'll change the grid to maybe one smaller so lets me align the components a bit better for example something like so I could play C15
(48:50) closer to the device and that might be a good idea because it reduces the trace length of RF traces which which is generally what we want but it makes rooting out pin 20 22 23 much harder also keep in mind we still have to have decoupling capacitors there in just a second so maybe this whole structure will be better off just a bit further away also again this will become with fine tuning we want to try and maintain straight paths and not these angled Paths of our Rat's Nest so we want to move these RF components to be in line
(49:20) that we have either vertical or horizontal rats nest so we can change the grid that it's somewhat horizont Al for example for example if we double click on this pad we can see the X position despite U2 being the center is not quite fitting to any grid we have so this is always a compromise but this at least we could root pretty much straight out and then we can move these components in line for example so later on we can just root out into these components into the filter and for example into our UFL connector then of
(49:49) course the silk screen you can move around just to make things a bit easier to read for example something like this what I'd also highly suggest suggest is alt three to go to the 3D viewer because often times you can spot mistakes or mechanical errors in the 3D viewer for example like so we can see what our board would look like physically in the real world so to speak and I use the 3D viewer a lot of times to do mechanical checks sanity checks and so on so this is maybe what our structures would then look like in real life and we can see we
(50:17) have plenty of room to the right side to then later root out but we could of course move all these components maybe further in as well again this is an iterative process adjust and adjust you'll probably have noticed that I'm keeping things for example the boot zero switch and the ldo regulators and the LED to right at the end because their position really isn't entirely critical in this design so we just want a rough placement and placing all the critical Parts first and then we'll place in for example these DC components such as the
(50:45) boot zero switch and regulator so for example the load capacitor c17 c18 we can already take Guided by The Rat's Nest they should be somewhere next to this Crystal oscillator so c18 that needs to be then to the left side for example and same thing with the placement here we might be jumping into the fine tuning already I could place this capacitor for example like so or rotate it at 180° what might be an option also with these capacitors is to place X1 a bit further down and have these capacitors for example in line
(51:16) like so this means we go straight out from pins 2 and 3 into the capacitors into the Crystal and that might be slightly more optimal than the configuration like so but then again for this it doesn't particularly matter but here you can see we roote into the Crystal and then out again of the crystal into the load caps whereas this we have pretty much just one connection so to speak again this will be fine tuning when we come to fine tuning layout and when rooting as well also going back to the switch power supply
(51:42) we've done our rough placement here just approximately where it needs to be but again if we move the L1 inductor bit to the left we have a straight vertical connection ler on with routing and we don't have to do funny angles with our traces same thing with the other inductor to the top here maybe we can move that a bit closer that we have a very short connection for the switch nodes and then the 8bit node of the inductor to the right we could leave c14 like so but c14 we later have to root from Pad 2 to pad 1 into pad 31 here so
(52:11) maybe we could move the capacitor wall in like so and we have a shorter connection or we could rotate this connection that we have closer points between these ground pads so there's many many different options available maybe something like so would work again alt 3 to check this in 3D just see how our placement would be now it doesn't look particularly pretty at the moment but again iterative process I can't say it enough so something like this as a first guess I've cleaned up the silk screen maybe just a tiny bit so we don't
(52:40) have overlapping silk screen again you can just click on these texts and just drag them around with your mouse or press M to move on your keyboard so for now we've placed the main or critical components somewhat where they need to be for example we could of course move this Crystal oscillator Maybe down just a tiny bit again minimizing the traces but what's really important as well is that we also fit in all of these bypass and decoupling capacitors so for example for the micr controller we have the small decoupling capacitors so C4 to C9
(53:09) C11 C12 and so on and these need to fit in right next to the 3.3 volt pins so it could of course be that we have to move some components we've previously placed what I like to start with is C12 because it's the vdd RF decoupling again one of the more critical decoupling capacitors for example vdd RF is more critical in my eyes than vbat decoupling so I'll take C12 and this is a bit deceiving because if we look at C12 we have one pad that's 3.
(53:38) 3 volts the other pad is pad two ground and we've got so many 3.3 volt pads everywhere so why not just take this capacitor place it somewhere next to this 3.3v pad and we're done well the reason we place it in the schematic on the left hand side like so is that we distinctly separated these capacitors to know where they are placed for example c112 even though it connects just to 3.
(54:01) 3 Vol on ground has this wire getting into pad 23 so pad or pin 23 is where we want to place this capacitor so follow what we've done in the schematic because we've delivered design intent in the schematic we want to move that over to the PCB design later on if we might need to debug this device or test it if you want to find C12 and it suddenly happens to be next to pin 40 well that's not particularly great we put it in the schematic there for a reason so C12 12 needs to be next to pin 23 and that should be somewhere over here as you guessed next to the RF section so the RF
(54:32) section is here and placement of decoupling capacitors is also very important we don't want to place our decoupling capacitor like so because then we need a long Trace into pad 3 our ground connection is also far away from the IC itself what's important for decoupling capacitors because again they act as high frequency local energy storage they need to be close to the relevant power and ground pins so an optimal position might be something like so that we have symmetry between power 23 and p 22 we can simply root out power
(55:02) and ground and then we can use power traces or planes to connect it to power and ground from a power source the problem with this connection is that now our RF Trace if we try to root this out we have to go at a funny angle maybe around like so into the RF trace and again this is where compromises come in so we could leave it like so but keep in mind pad 20 is also a decoupling Capac and this happens to be C8 so if I now also take C8 remember C8 because it's the penultimate and that penultimate pin is pin 20 so if I take C8 and then place
(55:35) it like we did so okay great we've got great decoupling capacitor placement but what do we do with our F pin it has to squeeze between these two and that's not really an option so what we can do is we either move for example this C12 up a bit and this is maybe already pretty decent because 23 can maybe wiggle its way away with a trace to pad 1 here of C12 and Pad 20 can go straight to its decoupling capacitor and pin 21 RF pin is pretty much unhindered to go to this matching Network so this might already be a good solution let's go to 3D viewer
(56:10) and also for assembly again this is from experience just judging by ey this is plenty of space for assembly between for example our bypassing capacitors and U2 so we could move our bypass capacitors further in for example like so but then you can see we're crossing the courtyard which might still be okay for assembly but for assembly testing purposes we want to stay that these Courtyards don't cross so something like this might be okay what's also peculiar about our situation is that pins 19 18 17 which you can see in the schematic are
(56:43) actually gpios though so they could be used for alternate functions we're not actually rooting them out and this gives us another luxury that we can place for example C8 like so if we had to root out c19 C8 18 17 there is no way we could place C8 like so instead we would have to place maybe C8 something like this maybe further away that we can root out all of these pins past this decoupling capacitor so again it's a compromise it depends on how many pins you're rooting out and so on but for us luckily as we're not rooting at many parts maybe
(57:15) something like this would be okay I still see a bit of a problem between pins 23 and pin1 later on when rooting this out that this isn't a particularly pretty connection so maybe we move it down a bit but for now let's just keep these capacitors like so and this procedure we would just continue for all of the Power and ground pins of this device so we can either go from the schematic route so for example C4 would be for pin 40 because this is our first pin on U2 so C4 M to move 40 is somewhere here and again we have that
(57:47) same dilemma we could place it like so because you want to keep short wide traces to the relevant power pins we want to keep our Loop areas small our Loop is effectiv from power to power and from ground to ground and ground happens to be this large thermal pad underneath the IC therefore if we rotate the capacitor like so yes okay we still have pad 1 close to pad 40 which is a short connection but our ground Loop so to speak and this is just a visualization is larger than if we place it like so for example however if we have the
(58:20) capacitor like so how do we root out 39 and 41 well that's going to be rather difficult so a compromise is that we do have our capacitor like so but this is still absolutely fine you could even place the capacitors on the bottom side with vs and you would still decouple and bypass this chip just fine again it depends on the situation but for example like so it means we can rout out s wi Dio and S wi clock however with this placement with the capacitor we can now see that our tag connect header needs to move because
(58:49) the courtyards are touching it might be more difficult to rout out Dio clock and so on so we just move that maybe just a bit to the left and that might mean we have to move these two a bit to the left and hopefully this illustrates how iterative of a process this is but anyway let's continue with our decoupling capacitors so now we have pin 34 which happens to be vdd S smps and here this is maybe a bit of a special case because we have two Bypass or decoupling capacitors one is C10 and one is C11 now let's compare the sizes of C1
(59:21) and C10 C10 is considerably larger than C11 package size and how you attach the package or the footprint via copper to for example vs and traces into your components is the prime influence on inductance so we can already suspect that C11 will have a lower loop inductance when tied to the power and Grand pins correctly compared to C10 so we want to place C11 closer to the relevant power and ground pins and then C10 we can place further away C10 we could also called for example a bulk decoupling capacitor so pin 34 needs two
(59:53) capacitors C11 and C10 so let's take C11 the closer one first and that has to be somewhere close to pin 34 which happens to be up here pin 34 is our vdd smps so that's our input to our switching regulator so The Logical way of rotating the would be like so so that pad one is close to this power now we do have path 32 here as a ground but we'll be using vs and ground planes anyway to hook up our ground so something I this might be a good first guess then we take C10 M to move and that might be best place something like so but that would then
(1:00:28) mean we have to move our inductors of the switch node so maybe we can move it a bit further away something like this as a first guess if you look at that in the 3D view so we have C11 Which is closest to this Power Pin and then C10 which is a larger bypass capacitor further away so maybe a structure like this just as an initial guess and this might change during layout and routing if we can optimize the things a bit more what you probably will have noticed is that we also have another pad 35 a 3.
(1:00:55) 3 volt pad next to it and that happens to be a vdd pin pad 35 which we need capacitor C7 for so if we take C7 where do we place that now well this is a bit difficult because we already placed C11 very close and C10 right there and we have these two PS that need to have their own decoupling capacitors well need is a strong word we can probably get away which is having one close local decoupling capacitor such as the 100 nanofarad capacitor here and we root out short wide tra es both through 35 and 34 that share these decoupling capacitors
(1:01:29) so that would be completely fine and that's what I've also done in the previous design however what you could do is either place maybe this other decoupling capacit like so and therefore sacrifice a slightly longer trace or simply move C10 further away and just place these two decoupling capacitors in parallel and then have this larger bolt decoupling capacitor further away and in this way because you've paralleled capacitors you do actually reduce your inductance if you tie them to to ground and power correctly and then we can have
(1:01:57) the larger Bol decoupling capacitor further away so this might be an option or we can also just simply get rid of one of these capacitors and then just live as we did before but we share power between 35 and 34 and one deing capacitor here but for the sake of Simplicity and because we have it on the schematic already let's just keep these capacitors in parel like so again this isn't too critical but of course some thought should go into this so in your own time I would like you to continue this if you're following along of course
(1:02:27) and the remaining decoupling capacitors we still have quite a few power pins left to place them around the device I'll do this now and I'll get back to you once I'm done with this now I've placed all of these decoupling capacitors in their approximate positions where they should be and there are a few compromises again that we had to do if you've done this on your own I'd like to just share how I might have done this so for example you already had placed X1 which was our low speed external Crystal with its relevant load
(1:02:54) caps again in this configuration or we could place them like so and then move everything down that is up to you the difference is not too big however we do have this n reset signal that we have to rout out on the bottom pin seven past this as well as we have pin 8 that needs to be decoupled and of course 11 and 12 are our Ur TX and RX signals the way I did this is so we could either take these three components move them a bit to the left and that gives us more space to rout at and reset and then we could have example pin 8 directly down going
(1:03:25) into our decoupling pasta plac like so or move your TX and RX through resistors bit further to the right and then rotate our bypass de coupling PA like so which would optimize the loop a tiny bit that we have pin one and8 like so and the ground closer to the central ground pad again this is some sort of air wi visualization so this might be more optimal than for example this placement and this was also allowing more space to root out pin 7 the placement of the txrx resistor isn't too critical typically if you're using for example series
(1:03:58) resistors for termination you would want to place at the output so in this case with this would be pin 11 you want to place your series resistor closer to the output than to the receiver or the input so for example RX as an input we could place for example R4 further away but because you want to maintain Symmetry and make things look somewhat visually appealing maybe a layout like this would be okay and again we could maybe move things around this is just fine tuning but the components are still in their approximate locations we have to
(1:04:27) compromise between placements of these different components similarly for Pins 1 and three we see we have two power pins quite close to each other so pin one if we go to the schematic happens to be bat and that isn't a particularly critical Power Pin this should be tied to vdd which is our 3.
(1:04:45) 3 volts in this case if we're not using for example a battery to keep the real-time clock alive and so on if power is disconnected we're just simply hooking that up to vdd so comparing ing pin 1 to pin 48 pin 48 is so to speak an actual vdd pin which is more critical therefore it also makes sense maybe to put these bypass and decoupling capacitors closer to pin 48 rather than the pin one and this actually turns out to be quite helpful because we don't really have much space under pin one because we have the lsse the low speed external Crystal there so
(1:05:16) therefore it can make sense just to either put capacitor C6 and C9 which are the decoupling capacitors for Pins 48 and 1 like so and this means we could have a large interconnect between 481 and these two capacitors or we could also just simply move up these two capacitors that they are in line with pin 48 either way is pretty much fine there's no particular difference however if we do have them like so it might make pin 43 our serial wire debug Trace easier to root out past these components compared to if these components are like
(1:05:49) so it gives us less space in this kind of diagonal to rout past with our Trace connection so let's keep them like this for now and in that way we have most of the critical components placed down and of course zooming out middle Mouse wheel we still have a number of components to place here but these are so to speak far less critical than the components we just placed and we kind of fine-tuned the layout a bit already another thing to note is that for example this switch node here there anything with LX in the
(1:06:19) net name these are pretty critical nodes that should be kept short and also far away from phys example sensitive nodes such as the high-s speeded external Crystal so we could move the highs speed external Crystal maybe in a bit more but that moves it closer to these inductors now while this probably still is fine my preference is just to move this high-speed external Crystal a tiny bit further away which yes does increase the trace length of the HSC in and HSC out later when rooting but it does place it away further from critical Parts I also
(1:06:49) don't want to place this HC Crystal for example like down here which might be a similar distance because that's close to the if traces and we really don't want that we want things to be segmented we want space because that minimizes cross talk noise cross coupling and so on and that's why a good layout leads to good rooting which leads to good performance of the design later on as well of course when we come to rooting we will probably fine-tune the layout even more but for the critical components this is somewhat
(1:07:15) of a good starting point in my eyes of course there's things to clean up such as silk screen placements maybe aligning things on grid but if you go to view 3D viewer or press alt three we can see that this is a fairly compact somewhat neat layout and routing of course the board shape or the board outline isn't defined yet and that's why key card just extends it to where the components are but from this we could have maybe already see an approximate board outline might be something like so what pains me a tiny bit at the moment is this J2
(1:07:46) connector because without this J2 connector we could have a much Slimmer board outline so maybe we could move it next to J1 or just keep it there because this is just in fact demo board and this is okay with that being said we still have all these components down here so we have for example the usbcc so the communication Channel pull downs we have everything to do with boot zero we have all the LED stuff as well as of course the regulator so these are the components I would like to place next what's most critical out of all these
(1:08:15) components to me the next thing I would probably want to place is everything to do with the regulator so that's U1 it's C1 which is the input bypass capacitor and C2 the output bypass capacitor we do also have C3 which you probably will have noticed which is also part of the bypass and decoupling Network for the microcontroller and again this is what's known as a bulk Bypass or bulk decoupling capacitor it's considerably larger than the smaller capacitor so 100 narad and so on and it doesn't have a specific pin it needs to go next to
(1:08:45) we've covered all of the pins with these direct connections to C4 C5 C6 all of these 100 nanofarad capacitors and this larger 4.7 micro F capacitor we can take again press M and this needs to be placed somewhere close to the package so we don't want to place it somewhere somewhere from the distance but we want to place it somewhere close somewhere where it makes sense and somewhere where we still have free space so this could for example be over here but then again we don't really have any 3.
(1:09:13) 3 volt pins on this side of the package it could be here but that means we need to space out our components more this might be an okay solution but it just needs to be somewhere close to the package so maybe somewhere like here is okay this is close to these power pins and we could make maybe a polygon pull later on it needs to be somewhere close to the package and that's all so there's it's fairly loose constraint of where this bypass capaca needs to be okay with that capaca place let's go back to the ldo so that was U1 we can take this part press
(1:09:42) M again to move and now as a guess of where this might want to be of course next to where our power entry is and our power entry is the USB connector on the left hand side we have the 5V pin so that's pin one is our main five Vol input and that should be close to the USB connector ESD protection ideally thinking again ahead to the rooting we want to rout from our power and ground or at least from our A4 and A9 pins plus 5 Vols first of all into the ESD protection which is pin five of D1 if you look at the symbol for D1 we can see
(1:10:13) there's actually a TVs diode between ground and 5 Vols so an ESD protection part which can absorb the brunt of EST energy before it gets ped so to speak Downstream so thinking ahead to rooting we want to rout A4 and A9 from the USB connector to pad 5 of D1 and only afterwards we want to take the power and that's kind of what we indicated on the schematic as well we root out from A4 A9 to our estd protection D1 and then we go into C1 and into U1 our ldo so for example our placement might be something in line with D1 and we want the bypass
(1:10:48) capacitors next to it so C1 I'll take over press M to move let's just place it close to U1 first of all and C2 will move over which is our output capacitor between 3.3 Vol and ground so if we keep the U1 orientation like so take C1 R to rotate we could place it like so but then you can see the components overlap and I quite like symmetry so we could move of course U1 over move the Cass like so but then U1 and D1 have an offset and that I'm not a fan of that so let's move it back but we could of course rotate U1 so we could rotate it
(1:11:20) like so or 180° like so but PR option is like so because my 5V pins now face the D1 5 volts and we can simply move this part up a tiny bit and then place for example our input capacitor C1 next to the power and ground pins 1 and two now it's important here that pin 3 is also called 5fs here however pin 3 is not a power carrying Trace it's not a current carrying Trace it's simply the enable signal but it can be deceiving if you're just looking at the PCB design on its own okay it looks like one and three are
(1:11:53) power well that's why we have the schematic open because pin 3 is actually an able signal and we should place our capacitor C1 like so and not like so so therefore again close powers and close grounds anytime you're dealing with something like this on the opposite side we have our C2 which should be close to pin five so we can either place it like so which would be pretty much symmetrical or if you wish you could also place it like so again the distance between 1 and 5 is predominantly in what counts because later on we'll see we're
(1:12:23) going to be using ground plane for rooting just for the sake of symmetry I'll probably put it something like so maybe move these capacitors in a bit more and clean up the silk screen just a tiny bit for example like so now if I go to view 3D viewer or alt three you can see this placement is somewhat okay we could probably move in the capacitors a tiny bit more but it isn't great because C2 now means we extend our board outline further than we really need to given all of the other components so maybe it would make sense to move this whole
(1:12:51) stack of components below D1 because we have J2 the bottom which extends our board outline anyway so if we close that click and drag M to move we could probably just move everything below like so and then of course rotate because we want 5 volts still facing up it also makes sense to have for example the input capacitor C1 close to the power pins of our USB power source in this case it's the USB type-c connector we haven't actually added in any filtering on our 5V rail which is typically a very good idea and typically you would use a
(1:13:24) pi filter so capacitor series element such as an inductor or fad bead and then a capacitor afterwards we've taken pretty much our 5 volt straight away and rooted that to be our 5V net for C1 going into U1 so it often makes sense to at least put Provisions in for a piie filter but we haven't done this in this video for the sake of Simplicity but in any case we have C1 close to the power pins because this does provide a tiny bit of ESD protection and filtering despite us not having a dedicated filter there so something like this position is
(1:13:55) somewhat suitable for this very very simple design the other components we have are for example R1 and R2 looking at the schematic these are the pull Downs the CC1 cc2 so I can select and drag drag and move those over or press M and we can Again by The Rat's Nest tell where they need to be so we have CC1 at the top cc2 at the bottom and these aren't particularly critical signals they effectively just pull down so we could either place them like so but we want to root out our 5 Vols to the right hand side so what I typically do with
(1:14:24) these USBC connectors I'm using this type of construct is place my CC resistors for example parallel to the part top and bottom for example something like this and of course you can also rotate depending on how we want to root these out later on something like this is fine these connections aren't critical of course they have to be there but how we root them isn't entirely relevant in this case having the CC resistance in place we pretty much just have a few of these components left over so let me move them in just a
(1:14:51) tiny bit more to make the board a bit smaller so we have our LED so that's R5 and D2 I can move those together we have all of this boot circuitry with the switch and these capacitors and resistors then we have this end reset filtering capacitor C13 and again judging by the rats nness we can see where this needs to go end reset originates at Pin 7 the microl the bottom it'll have to rout down somewhere like so over and into j3 so we could place it here but that interferes with D minus D+ maybe we could place it
(1:15:21) somewhere here to start with or next to these capacitors because that's to root through anyway maybe something like so there's many different options of doing this so let's maybe put it somewhere here just so we have a group thinking ahead of routing we come down into the capacitor out of the capacitor into the end reset so what's left to do is of course the LED with the current limiting resistor and then the boot zero P down along with the very simple debouncing circuit and the switch now I'm not particularly happy about the switch it
(1:15:49) is rather large in comparison to all the components so we could exchange that by going to the schematic double clicking on the part going to footprint and then clicking that little Library button and we could change to for example a smaller footprint and feel very free to do that of course I'm just going to leave it in for the sake of Simplicity but just keep in mind it doesn't look particularly great in any case let's just place the diode first this led so take D2 and let's see where this needs to go and again from The Rat's Nest we see it's
(1:16:15) somewhere up here now it could be up here it doesn't really matter we could also place it for example next to the USB connector but keep in mind then we'd have to Route it along tra or on a different layer to get to that part so it probably does make sense to keep it somewhere in the vicinity depends of course again if you have mechanical constraints if you have for example light pipes or some sort of opening for an LED in your enclosure you would of course want to place your LED sensibly for us it's not too critical so I'm just
(1:16:41) going to place it kind of let's say in parallel mechanically speaking somewhere here I don't want to place it too close to the RF section because remember this pin pin 16 to drive the LED we set up as a timer and that'll be switching and we want to keep that away from the RF circuitry as well along with that we need the current limiting resistor r five so M to move that and we'll move it somewhere next to it now we could of course place the resistor like so in another 3D viewer let's have a look at that which still is a fair enough
(1:17:10) distance but let's say you want to manually assemble this board we have the space and there's no real need to place these close to each other so we could for example place them like so or even further apart don't cramp Parts like so unless you really really need to that's why we space them out a bit give them room to breathe makes it easier to assemble troubleshoot test and so on okay so the last thing we have to do is of course our boot switch and our boot pull down so our boot pull down resistor is R6 this 5.1k resistor and let's see
(1:17:38) where that needs to live so again The Rat's Nest will snap to where it needs to be closest to and it looks like it's this boot zero pin so this boot zero pin let's think about how we can maybe root that out we have the LSC in LSC out which have to go directly down so we can't root the boot zero to the left they have to come to the right out like so but we do also have our swd reset and this bypass capacitor so it looks like our bypass capacitor might have to go one grid setting to the right so we can get end reset and boot zero out like so
(1:18:06) which means we have to move our resistors a tiny bit as you can see this might not be the final solution it's an iterative process once again so boot zero resistor it really doesn't matter where this is of course it should be somewhere of the vicinity where it should be so we could place it for example somewh like here but keep in mind we have to make our ground and power connections that's probably not a good idea what we could maybe do instead rather than placing that resistor first is choosing our switch which maybe
(1:18:32) should somewhat be in line with our J2 connector so if we go to 3D view we can see we have our user interfaces we have the USB connector we have j4 which is our F connector and our switch all probably along the board boundary ideally all of your connectors should pretty much just be on one side of the board we're violating that quite a bit at the moment so we have one USB connector on one side one antenna connect on one side and this J2 Ur connect on one side so we could to make this rur a tiny bit better place for
(1:19:00) example our J2 connector over here and that means we only have connectors on two sides given that this is a demo board might not matter too much but in practice it's best if you can to keep connectors just on one side of the board but often times and in many many products you simply cannot do this so I'll leave it up to you of where you want to place for example these connectors or whatever interfaces you're using we could for example swap position is that we have our boot switch right next to the microcontroller and that
(1:19:27) puts the boot circuitry then in that place as well and we have the UR connector for example like so over here this would be an option but then of course you have to rout out our uart connections pass the switch into this connector whereas this option might be a bit more compact but then again we have connectors on three sides let's just for the sake of It Go for this option instead then we have R6 which is our boot zero pull down c19 and R7 so R7 and c19 very simply speaking for a group so we can place that again following The
(1:19:57) Rat's Nest next to our boot zero switch and then we take c19 afterward which is boot zero again not placing too close so we come from the switch into boot switch through the capacitor resistor and then through for example our boot zero pull down and then we can route very easily with short traces and then one long Trace going into the boot zero pin at the bottom of the microcontroller for example keep in mind there are pretty much infinite amount Solutions we could do this with we could move the capacitors and resistors like so in line
(1:20:29) for example something like this either option is pretty much fine this is a not particularly critical Trace not particularly critical signal so something like this might be completely fine and just like that going to 3D view we still haven't defined a board outline yet but this could be a very simple approximation of how you might go about layout we find tune and fight tune keep in mind this might not be the prettiest layout at the moment we also have have quite a lot of messy silk screen and so on but this might be a starting point
(1:20:57) where we've prioritized electrical connectivity over for example mechanical because we don't have really any mechanical constraints so you can of course take your time this is done very very quickly for the sake of this video you can rearrange these components maybe space them out a bit more and we'll probably have to rearrange some things when we come to the rooting part very shortly what I'd like to do now however is first of all Define a board outline you can see in the 3D viewer keycard is still telling us that we don't have a
(1:21:23) board outline which is very right and that's what's something we should Define in a second on a separate layer we might want to move around the silk screen or get rid of it completely and I would like to add mounting holes as well as fiducial markers so let's start off with the board outline I've now closed the schematic editor because we've used most of the information in the schematic to do our layout and then our routing actually becomes quite straightforward because we've hopefully done somewhat of a good job with layout so the routing
(1:21:51) should just be connecting up short segments of track or tracks where they need to go again it pays off to do your layout rather well to do the board outline first of all we have to go on the right hand side and to layers and then select the edge Cuts layer The Edge Cuts layer is the outline or the board outline layer then we can use the tools on the toolbar on the right for example draw a line draw an arc to draw a board outline now again you probably will have mechanical constraints if you're designing for your own project in our
(1:22:18) case we don't really have anything so I'm just going to draw an outline that somewhat fits the components we've now placed very roughly so I can press draw a line on the right hand side I would like to increase my grid so I can click on this and maybe change to 1 mm grid I would urge you not to use example odd grids such as 0. 25.
(1:22:37) 5 but rather stick whole integer numbers so for example like so now we can see we have the line already started I don't want to draw my outline too close to components this is because your pcbs will be panelized they'll be broken out they'll be routed out so we need to keep space B from the board Edge and typically.
(1:22:55) 3 mm is a minimum but I would suggest at least half a mm so for example like here I would start my board outline just above this silk screen and that gives me ample space because who knows we might also have to rout past these components again this is pretty free in this case because we don't have a mechanical constraint so I could for example draw a line click click next to the connector this might already be a bit close zoom out with the middle Mouse wheel click again and again please keep in mind this is very very
(1:23:21) rough click click click right click cancel escape to cancel the command and now if I go to view 3D viewer here we go we have a very cruely drawn board outline and for this board outline we can either keep or we can adjust it and then move for example the components to fit example the USB connector we might want to move that it overhangs the board outline a bit or this connector this Mo speaker blade you want to move forward a bit or the boot zero switch we want to move down a bit things like that we can adjust once we have a board outline in
(1:23:52) place now now rectangular board outlines with sharp 90° Corners are completely fine and often times it's might be an easier or cheaper method to break out from a panel because we can use what's known as v-cuts so essentially grooves in the PCB that we can then snap so this outline would be perfectly fine if you want to maybe improve the Aesthetics or if you prefer them we can also add in rounded Corners by drawing an arc on the right hand side that tool and we could draw an arc so click maybe this is just a 1 mm Arc we can draw a 90° Arc just as
(1:24:21) a template click and R to rotate while I'm holding I can press n to reduce the grid and you can see my grid has reduced to.5 mm n again to 0.25 and for example I could just place my arc of the corner and then I can click on the lines I drew previously and just drag them in or out and now my board outline let's go to view 3D viewer you can see now I have a rounded corner at the top here and you can of course change the corner radius and this might be more visually appealing to you or if you have mechanical constraints of course you can
(1:24:51) change the board outline like so there there are of course much more efficient methods of drawing board outlines you might get a dxf file or step file from your mechanical team and there's ways of creating the PCB board outline from a template like that but let me just adjust the board outline a tiny bit just for the sake of this video and I'll see you in just a second for example a board outlines something like this now I've moved some connectors around a bit typically USBC connectors the plugs that go into these connectors typically have
(1:25:17) a tiny bit of overhang so leaving the connector like so or moving it to the left maybe one or two slots is typically fine so often having just flush with a board outline can be okay now there's things that we can clean up towards the end of the video as well for example some of this silk screen is very close to the board outline so I'll typically remove that for example also these component designators the silk screen is very close to the board outline so you can either extend the board outline or move the component
(1:25:42) designators often times you also don't need to even place or in most cases you don't need to place component designators it often helps of course if they're prototypes but in most cases a good assembly drawer dra means you don't need them plus we have Computers and eard Tools anyway to look these parts up in any case feel free to move components around this is a very very rough layout I know it isn't the prettiest but it's just to get the point across that it's an iterative process and it takes time and time and you can make this much
(1:26:08) neater of course if you wanted to we'll add some finishing touches toward the end of the video but we're pretty much ready to start with rooting now we're now ready to start with the rooting of this board and hopefully with our layout which is somewhat decent this will be fairly straightforward as with layout with rooting there are many many different ways of reaching the same goal have done your layout initially will probably guide your rooting there's things we will clean up with the layout along the way and I'll show you just
(1:26:34) some best practices for certain sections of the circuits for example the RF power and ground others traces and so on differential Pairs and whatnot to start off with same as we did with layout we want to start with rooting also the most critical Parts first so that might be the RF sections that might be the switch node power supplies power and ground decoupling capacitors crystals and so on before we move to less critical sections for example the boot switch or the CC resistors and so on and the uarts so what I typically start with before doing
(1:27:04) any traces is I set up my layers and I place V's so you could probably root this board out in two layers which is completely fine we just have rooted power and dedicate the bottom layer to ground but for the sake of ease and because there are many benefits to using four layer boards we could use uninterrupted ground and some times power planes our RF traces are narrower we get better field control because we have closer ground and Signal planes so we have closer return path and more and more there are many many benefits other
(1:27:33) than just rooting Simplicity to using four layer bools and that's what we're using here and that's what we set up here therefore the top layer is where we placed all of our components on the two inner layers we will dedicate to planes and the bottom layer we can use for rooting so the inner two layers should be uninterrupted either ground or power planes now typical stackups you'll see is top is signal the first inner layer is ground then the second inner layer is power for example 3.
(1:27:58) 3 volts in this case and the bottom layer is signal again now our preferred stackup I use is signal ground ground signal and there's many reasons for that and I'll leave some links in the description box below where I've done some videos on explaining that and this is the stack up we be using so we're using signal ground ground signal so the first thing I like to do is draw the ground planes on the inner two layers so inner one and inner two rooted power for most pcbs even for some fpga base or higher speed higher edro digital logic pcbs can be fine and in this case
(1:28:28) of these simple microcontrollers and for RF pretty much all RF power is rooted so we don't need a dedicated power plane so let's go to Inner copper one which is the layer just below the top copper layer and let's draw a polygon this will be our ground plane to do that on the right hand side we can see this add filled Zone button or control shift Zed make sure your grid is suitable so I have 025 mm and we can start drawing a Outline by left click I get this copper Zone properties and I can even choose layer one and Layer Two so I'll choose
(1:28:57) layer one for example and then I'll search for a net I want my ground and then I can just fill in these properties for example electric properties are the clearance to any other features and minimum width clearance I'll change to3 mm and minimum width I'll change to .15 that's our minimum feature width if you remember back to the design rules then pad connections for example to snd pads or through hole pads we will want thermal relieves for example on pads to ease manual assembly and soldering otherwise you're fighting against these
(1:29:26) large power planes so thermal relief spoke width we'll just go with 025 and A4 mm Gap as an example again this is just from experience fill type want a solid fill and we'll leave the rest as blank press okay and then we can start drawing by clicking we can draw vertices of this polygon so I can click and move anywhere click click and I don't have to follow this corner so I could for example just draw the rough rectangular outline of my board like so middle Mouse button hold and drag to move along the board and left click to place the
(1:29:59) polygon outline and then we finish at our first node and there we go now you can see this kind of hatched or these lines indicate that we have a polygon pae here then either go to edit fill all zones or we can use the shortcut B and that will then pour the polygon now you can see if we go to Layer Two which we've currently selected because it's gray this is of course ground which is the net we selected and this is now ground layer or ground polygon directly below our top layer of front copper layer so if you right click on the inner
(1:30:28) copper one hide all layers but active we can examine this inner copper layer which is a ground net and only where there are holes in the PCB for example the drill holes or plated pads or non-plated through holes we can see we have some clearance which we defined in the polygon editor or the fill editor and anytime there's a ground pin for example the USB Shield or this uard connector we can see we have this thermal relias which are these spokes which we to find the width for and the clearance between the pad and this will
(1:30:55) help with solderability so anytime we now place any more through holes such as V's we will get cutouts in our polygon so if we double click on this copper layer and then enable it on in two so inner copper layer 2 as well click okay press B to repour we can now see on inner copper one we have a ground layer or ground plane and on inner copper 2 we also have a ground plane and because we have to find our Edge Cuts layer so our outline we also have our 0.
(1:31:18) 3 mm clearance to the outline automatically and that's why we don't have to follow this Corners we can just draw a rough outline shape and keycard does the rest so very nice now we have two inner ground layers we can actually hide those layers because they're not too critical at the moment and we'll just look at the front and bottom copper layer as well as the outline layer and this just makes our view just a tiny bit easier before we continue I would like to add mounting holes and fedal markers because they'll constrain our rooting as well now
(1:31:45) there's ways of doing it for example in the PCB editor but the way one does it in key CAD is actually add for doal markers and mounting holes in the the schematic so if we go back to the schematic these are actually part of a component so we can press a to add component and if we look for mounting we can see we have different options for mounting hole so we have a mounting hole without a connection or a mounting hole with connection for example we could tie this mounting hole to ground and depends on what your enclosure is your
(1:32:10) electrical requirements you would choose one or either I'll just go with mounting hole with connection so double click on that we'll add it to some section of the schematic that's kind of out of the way click on this escape to cancel and we'll immediately select a footprint so if I double click on this footprint and then we look for mounting hole on the left hand side and we can see we get different default mounting holes so we get M2 we get ISO Norms din norms and so on typically you would go for example with an M2 or M3 again this depends on
(1:32:37) the mechanics so let's just go with an M3 for now so for the M3 mounting holes we need M3 pad because we're connecting this to ground so double click and also select exclude from B materials and press okay and we'll also hide the value by clicking the show check box and that just gets rid of this value I can move this designator copy it crl c contrl v and I would like to add four mounting holes and tie them all to ground so I'll copy a ground symbol and then just use the yre tool as before and there we go now we have four mounting holes in the
(1:33:06) schematic that we can import onto the PCB design what I also want to add are what's known as fidal markers and you probably will have seen them before pretty much every PCB should or will have them it's these high contrast markers so we have effectively an exposed pad which is not tied electrically to anything with some exposed soord Mark around the side and this gives us a nice high contrast marker and typically you will find many of them on a PCB and typically there will be three Global FAL markers so we can see here bottom left top left and
(1:33:36) top right corner and they things such as local FAL markers as well the reason we need those are because they help automated assembly for example SMD assembly we can get the tools with cameras or automatic Optical tools to locate these markers three of them as references and that will help with for example rotations and XY placements and so on to calibrate this to your PCB this is what we should add ourselves to pcbs or to the panel same thing in keycard pressing a on the schematic we type in fiducial and we can get this fiducial
(1:34:07) marker symbol I'll just Place one to start with typically I call them FM so F your marker one double click hide the value again and they will assign a footprint we can look for fidal on the left hand side and there are many different types and this depends on how much space you have on the board but typically what's recommended is a 1 mm pad and a 1 mm opening so that would be quite a large for doal marker something like this if you have to go smaller because of the board size then that's fair enough then you can choose a
(1:34:33) smaller one as well we'll just go with this and see if this fits so I'll just select that again exclude from B materials as an attribute press okay now you'll need these on both sides of the board so three on top three on bottom if you're doing double-sided assembly or you just need three of them on the side of the board wherever you're doing SMD assembly because we're only doing top Siders assembly all we need are three of these markers what we could do then just to indicate on the schematic is on the right hand side go to add a rectangle
(1:35:00) and we can just draw just a little bounding box for the sake of it around these components copy and label and just say these are mounting holes brackets M3 and these are the fiducial markers for example so it could look something like this so we can save the schematic go back to the PCB as usual then in the PCB we can go to the top update PCB with change or press f8 click update PCB close and now we have our four mounting holes which is an M3 mounting hole and three for duure markers we can see already the mounting holes seem rather
(1:35:32) large so might have to go to M2 but that's a quick change as well so I can select the footprint press M to move and we place it where we have free space in this case on the schematic on the PCV and looks like these are too large so we can change them in the schematic editor again go into the schematic bulk edit fields at the top and change the mounting hole pad to an M2 so click the footprint button change to M2 pad or we can change the M2 pad with vaa if you want to get all fancy so let's just go with that M2 pad via press okay Save
(1:36:01) open the PCB then import changes again press f8 update PCB there we go we've got slightly smaller mounting holes now so we can take those mounting holes and they should be aligned sensibly of course again keep in mind mechanical constraints you might have specific positions for your enclosure where they need to be for us we just want to place them somewhat sensibly so aligned vertically and horizontally as far as we can and where we have space for example so let me just align them so now I've aligned quite roughly the mounting holes
(1:36:29) like so again I could increase the board outline and place these maning holes more on the corner this is more of a demonstration boards anyway but you'd of course place these maning holes where they need to be for your enclosure if you're designing a custom enclosure I'd recommend placing these mounting holes integer numbers apart for example 50 mm 75 and so on and making sure they are not too close to the board outline as they are here so you want to still keep clearance from these mouning holes to the board outline make sure they follow
(1:36:55) the design rules I've also gotten rid of the silk screen markers because they don't need any so to do that you can click on a silk screen element double click and change that visible checkbox to off we have our futral markers on the right hand side and they should be placed away as far apart as possible on separate corners of the board so for example one I might place at the top left let's say again this is very crude one I might place next to this mounting hole top right and one next to this Ming hole bottom right just as a very crude
(1:37:24) example the actual position doesn't matter too much as long as they are spaced far enough apart so something like this maybe for example keep in mind this isn't the prettiest board we'll try to clean it up a tiny bit it's mainly about the principles and because this is just a demo board and we don't have very much time with that being said now we have the mounting holes in place the fedal markers and we placed them before we started rooting because as you see they are through holes they are pads so they do take away space which we need to
(1:37:50) be aware of now we can finally get started with rooting or at least before that what I typically do because we have two internal ground planes or anytime you have internal planes or power planes I need to place my vs first vs are effectively through hole connections they're plated through holes which allow us to jump layers so we could start for example on a trace on layer one which is our front cou layer rout into a V and that allows us to do a z axis transition and we can rout along on the inner two layers or on the bottom layer for
(1:38:18) example the reason you want to use vs and place them first is because all of our ground connections we want to tie to these internal ground planes so in one and in2 we've defined our internal ground planes and we somehow need to get from all of these ground pads and as you can see there's quite a few of them to the internal layers we use internal layers because this provides us a nice low impedance connection to all the grounds in the circuit the way we maintain that low impedance or do low impedance connections is have short wide
(1:38:44) traces going to a v which connects to the internal ground planes therefore what i' like to do is Place a v and to select a size we go to the top left the drop down and we use one of the predefined sizes we set up earlier but now we'll try and stay with 7 and3 mm because that's a pretty cheap V to produce and unless you need to go smaller I would stick with that as a default size 7 mm pad and3 mm finished diameter drill hole so I'll select that on the right hand side we can see this little via icon you can press that or
(1:39:15) press control shift V on your keyboard or click on this and you can see a v icon has appeared now any ground pad we want to add at least one ground Vier so we have a ground pad on the left we have a ground pad per capacitor here we have various ground pads all over our PCB but let's take this capacitor as an example this vertical one here we have a ground pad we don't want to place the ground VI directly into the center we don't want to place it a tiny bit into the pad we want to place it outside of the pad and
(1:39:42) far enough outside of the pad that we don't get problems with solder working during assembly these vs if placed too close to the pad and connected with copper for example tracers can can suck culer paste away from the pad into the V Barrel which can lead to real problems so we don't want to place it too close but we also don't want to place it too far for example up here we want to place a happy medium and of course this is somewhat of a rule of thumb but something like this from experience let's just say looks good to me so I can
(1:40:08) left click and place and escape to cancel you can already see that the ground Vier is connected that the Via is grounded that's because kead assumes because we simply have on internal one and internal two ground layers that we want to connect to ground if we had a 3.3 volt plane or polygon in the center then it would ask us which layer do you want to connect to or what net do you want to connect to but quite rightly we want to connect to ground and that's what we have here then we want a short wide connection between the ground VR
(1:40:35) and the ground pad short and wide reduces inductance so we choose our Trace let's say a wide Trace of5 mm on the right hand side we can either press the root tracks button or press X and start on the pad and rout up to the VM and there we go we have a short wide connection from our capacitor pad Trace via into the internal planes in 3D to alt three we can see this is what this connection looks like keep in mind we still have to move all the silk screen and so on but this looks like a great connection let's call it to me and this
(1:41:06) is what I want to do for all of these pads so I can shift click this selection the structure we is true contrl C and click on the center of the pad select pad and then paste it on all similar pads so all these capacitors will have similar structures so I can have this one I can press R to rotate contrl V to paste and I can paste all of these via structures like so so I'd like you to do that on your own design and I'll see you in just a second there we go now I've added this structure we just copied and pasted to all 042 components 042 because
(1:41:37) this structure won't work for example for these larger capacitors we have to redo the structure with maybe slightly wider traces and so on so all these o42 capacitors now have one via and generally the recommendation again is one via per pad in certain instances for example example I haven't placed it just yet or in some instances I've placed it in a certain direction for example this structure here if I just get rid of that I could place the V like so but if I place it like so how are we going to root out the RF Trace if I place it like
(1:42:04) so it interferes with the 3.3 volt pads so I have to place it for example like so which might not be the most optimal case but it allows me to root out here same thing for this Trace if I place it like so this is still okay because I can root out pad 16 seemingly fairly comfortable for for example C4 keep in mind I have to rot out Dio and clock past this capacitor so if I if I select this section and if I would have placed my V like so I can't really route past here so that's why I placed my GE connection like so so simly what I like
(1:42:37) you to add is one via and you'll have to do your own structures for other pads close to the pad not in the pad and have one VR per pad so I'll do that right now and I'll see you in just a second so now I've added pretty much one VR per pad in most cases but I haven't hooked up everything yet and it's just for the sake of placing vs because we'll have to be able to rout around these vs when we draw our traces in just a bit in certain cases it can also help to add for example parallel vs so more than one VR per pad for example I might do that for
(1:43:07) these larger capacitors or for example with the switch mode circuitry you can add two or more grounded vs and then connect these together rather than with traces with a polygon pore very similar how we did the filled zones to the internal layers and parall vs can help with thermal properties for example carrying away heat from hot components it can reduce the inductance and so forth but typically One V per PAD as a minimum sometimes of course you won't be able to do that you'll have to share and so on this is also true for this RF
(1:43:35) connection or for this UFL connector I'll Place multiple ground veers close to these large ground pads because you want to reduce the inductance and we'll just draw polygon poles around these pads later on but the important thing is that we place vs where we think they need to be so we have to in place for when we have to start rooting out so pre-planning our vs we don't necessarily have to draw traces yet but it can help if we have many of the similar structures as we did with these o42 pads that we have them in place already
(1:44:03) another place where we need vas is in fact for this qfn package which is this microcontroller if we go to 3D viewer and press s for example toggle 3D models we can see we have underneath the mic controller package we have a large exposed copper pad and this is both for ground electrical connectivity but also for thermal conductivity effectively you can think of it as somewhat as a heat sink now this is a very small heat sink so the way we can increase the effectiveness and because we have to try electricity to ground anyway is by
(1:44:32) placing vs in this case within the pad and this is okay for these thermal pads within certain constraints vs directly in a pad are best for thermal Effectiveness because they carry the heat away from the component through the solder into the pad into the internal planes and the internal planes are of course much much larger than the pad and can carry away that thermal energy the problem is with placing vs in pads is that solder paste once it's applied before we go through the Reflow process of assembling this component is that
(1:45:02) solder paste can Wick or be sucked through these via drill holes of one way of reducing this effect is by using smaller finished hole diameters of smaller finished drills or by placing the vs in a certain way so typically I would recommend not going larger than a.3 mm finished hole ideally with a 2 5 mm hole which is still within not being a cost Adder typically but we'll stay with 7 and3 mm cuz that's worked fine for me in the past as well I wouldn't recommend placing them directly in the center if you're going to do this but
(1:45:33) rather a number of them around the perimeter for example like so and leaving the center somewhat unpopulated with vs and we can stagger these vs like so in that way we can still have a nice big chunk of Sol p in the center which isn't suck through of course this is a compromise again but we have quite a number of parallel vs around the perimeter not directly in the center so we still get somewhat good thermal properties so this is some pattern for example I would recommend the more vs you have in parallel of course the more
(1:46:01) chances that the Sol Place gets sucked through but you do get better electrical and thermal properties so again it's a compromise but I found this pattern to work quite well for assembly as I've used quite a lot of qfin components throughout my career so something like this would be fine to me what we also have to consider is not just the ground routing but also the 3.
(1:46:20) 3 volts if for example layer 2 or layer one ideally in this case layer 2 would be a 3.3 volt plane we could do something similar where we have these short wide traces and vs for the 3.3 volt pants so what we could do is simply copy the structure again place it on the 3.3 volt and then just change the net to 3.3 volt by double clicking and then could connect to an internal plane and this would be very easy and in this case this would be no problem as well although we're not using an internal 3.
(1:46:50) 3 volt plane in this case it still makes sense to place these vs because we're going to be spending most of the top layer doing our signal routing so if this is for example the USB differential pair Ser wi debug all these other connections we could for example dedicate the bottom layer bottom copper to be 3.
(1:47:06) 3 volts or at least the majority of it because we'll try and stay on the top layer with most of the other signals so it does make sense to still place these 3.3 volt Trace via structures on the pads we see and pre-plan them as well so let's do that so for example something like I've done here I've added some further 3.3 vs around the capacitors and for this where we're having rooted power it's okay to have further spaced ground and power pair vs so the grounds are here for example the 3.
(1:47:35) 3 Vol vs are here and then we root with for example the copper fill polygon pore from the v's through the capacitors and then into the pad so we have the same structure here from the VR large Trace capacitor then pad and so on for example here this V was a compromise because I can't really place it somewhere up here here because of the RF constraints so we can route from the Via y dish Trace into the capacitor pad into our qfn package that's why we have all of these 3.
(1:48:01) 3 Vol vs here via Trace capacitor pad that kind of structure we can then also start adding in other vs where we think we might need them for example this 5vt pad 5 of D1 because of the USB data traces which will have to rout around this we need to see if we need a v or not for these 5 volts but we can add vs already where we think we might need them again via pre-planning of course these vs these capacitors everything still might move but it's an initial guess and again it's an iterative process once we have that in place we're pretty much ready to start
(1:48:30) rooting as we've done with the previous sections as well we want to start our rooting with the most critical traces and to me that is the RF section it's the switch mode power supply at the top and on the left hand side we have the USB differential pair as well as the s d connections and of course are crystals but those connections looks like they'll be fairly short as well so this is somewhat of an order we might want to do this in then afterwards we would rout out to the lower speed signal such as through n reset or the boot zero pins
(1:48:59) and then finally finish off with power again it depends on the board you're doing what's more critical what isn't you kind of have to prioritize because again it's an optimization problem that probably doesn't have a completely optimal solution in any case we want to start with the RF traces and nicely for us we've marked them as yellow so they immediately jump out at us remember when we set up the board and design rules we looked at controlled impedance traces and we set up a trace so track width on the top left that was a controlled
(1:49:26) impedance trace and that was about 1 19 mm and that's the trace width we would like to use again we could go for example to the board setup so go to edit predefined sizes then go to net classes and we could for example set the RF Trace width to be19 so if we set that to be19 and press okay and then select our Trace to be used net class width then either press X or root traces and and click on for example our first RF trace this will be a19 mm Trace as we see in the bottom left under track width so we can route
(1:49:58) in like so rot over like so through this network into the filter out of the filter into the UFL connection and that is how easily we've rooted out ourf section because we've done a proper job of layout our rooting is so much easier we simply have to come horizontal horizontal horizontal horizontal horizontal very very easily make sure you use the correct track width but given that this distance is so short you can probably get away with using other track widths as well but it's a good practice to do so and this is why we
(1:50:27) also see why we placed this Pi filter so C15 L3 and c16 like so I could have for example placed my Pi filter maybe like so or maybe scrunched it up a bit more which would have been fine as well so then I have to root vertically vertically and to the right and I could maybe reduce this length as well but typically some structure like this is very easy because we just have to root horizontally in this case I wouldn't want to do for example some routing like this and keep in mind this is very crude where I go in here and then I go out
(1:50:55) here this is not good because this creates stubs something like this or as we said we can also have a compactor version of this is completely fine we want to stay that these RF tracks don't have to move around much and don't have to rout further than they have to so some structure like this seems very very okay to me keep in mind we'll add in some final touches where we'll create better transitions between these large pads and these thin traces but we'll leave that to the end then for example the crystals again the
(1:51:23) order as long as we do all these critical Parts first the order isn't entirely important again we can choose a trace that's maybe similar to our controlled impedance Trace to19 mm I'll just select that ex to start routing from the pad and directly in HC in pad for the HC out I could go from this pad out to the right and up like so but I typically don't like coming out of these qfn pads at the wide side so to speak so typically I would prefer to come out like so then go up and I can change rooting Direction and for example into
(1:51:57) the pad like so so something like this but keep in mind we still have to root the pad 23 to the capacitor so we might be better off rooting the point twin 24 up vertically but this could be just a very straightforward example what we could also do for the HSC in Trace which might be better so if I delete that segment is come out of the HS in pad on the Crystal but don't go too far left because too far left would means we get close to this switch mode inductor so we could keep some distance so stay further right and only at the end roote into the
(1:52:28) pad and that might be a better idea than having the trace further to the left is it going to make much of a difference in this scenario probably not but it might be a good practice to do so similarly for the lsse traces at the bottom again sensitive Trace you come out of the pad left and into the crystal pad this will be one way of doing it and then from the lsse in pad we still have to go into the capacitor this doesn't look look particularly great so I'd prefer to go into the capacitor first and then into
(1:52:54) the lsse pad now for the lsse if you try to read this out yourself you'll notice that with the design rules we have in place and the trace widths that rooting out the lsse lse out LS in lsse out is fine but then getting the boot zero pin out is a bit tedious so what we could do instead is possibly move down the LC Crystal and then as we had earlier possibly just rotate these capacitors like so that way we can rout directly into the Capac then into the Crystal and we can rout the boot zero past this capacitor as well as the swd and reset
(1:53:26) so let's try that so that structure might look something like so then we would take our trace of 0.19 again I'm choosing this because it's similar width to that of the qfn of this pad and because 0.19 was our controlled impedance 50 ohm trace and we might as well use the 50 ohm controlled impedance Trace also for other signal traces so again press X for the LSC out we just root straighten at the capacitor straighten into the crystal for the lsse in we root out a tiny bit and into the pad and I'd like you also to do the
(1:53:57) connections like so that either come in vertically or horizontally in the pad if need be you can also go at a 45° angle but try to avoid structures like so where you have these sharpish angles the Triangular shapes going into the pad and always aim to go in horizontally vertically horizontally or at 45° then from the capacitor straight into the crystal pad like so and there we go and this means now with the same Trace width the boot zero pin we can pretty much root for example this is just as a demonstration I can press forward slash
(1:54:28) to change rting direction past these capacitors and that should mean we can also get the S swdn reset past of course we'll have to shift some stuff around just as an example this might be a more efficient routing method now we have the RF sections we've got the external Crystal sections done let's look at this switch mode power supply before we move to the left hand side of the board what we want to look at and what we want to prioritize is this LX or anything with LX and this is to signify this is the switching node and switching nodes are
(1:54:58) very sensitive in switch mode power supplies they should be kept as short as possible and as reasonable large enough to be able to sustain the current they need to sustain but no larger given that this is such a low power low current part the actual Trace width for this isn't terribly important even a 2mm Trace can carry quite a considerable amount of current so let's see what Trace we start off with if we double click on pad this LX pad we can see the pad size width is25 mm so let's use that as an initial Trace width let's go to
(1:55:28) edit predefined sizes and add that one in press okay then we'll select that Trace width press X to start rooting we'll root out a tiny section but as soon as we're somewhat free let's change the trace width the way we can do that while we're rooting is press W to increase the trace width we can also change the grid by pressing n and we can press W again or we can press contrl W to reduce the trace width so I'll increase it to for example 0.
(1:55:54) 5 and there we go we've come out the pad a tiny bit and as soon as we can and as soon as we have clearance we expand the trace out of course you can make this a bit neater as well or the full size of the pad but something like this is somewhat okay I can also drag this up a tiny bit again changing the grid with pressing n example something like so so we've done a short connection just to get ourselves free from the clearance constraints then we W then we've widened out our Trace wide Trace reduces the inductance and then we have a wide Trace go to this
(1:56:20) switch node and then we've done our switch nodes very short connections only as wide as they need be and we can use this technique of starting with a trace as wide as the pad and then branching out or widening out as soon as we can then we have the output node of the inductor this undor FB this is both a feedback node and the output bage node and this can be quite large so for this we could do a polygon pore that then goes into the pad for example or we can just do a trace again the current requirements here aren't particularly
(1:56:46) large to do a polygon pole what we could do is go on the right hand side add filled Zone we going to change the grid to something sensible so add filled Zone click above the pad and then we need to select the net and it's already selected snps feedback and we can change the clearance for example do2 mm and Pad connections to be solid we don't need therm leaves for this Reflow and then we can just start drawing around I like to keep my Corners at 45 like so and then we can just draw an outline of a polygon pore that might be suitable for this
(1:57:17) that just then goes into the pad out of the pad like so then we Press B to repour and there we go now we've got our own dedicated polygon P for the switch mode powerly feedback or the output voltage Trace like so and of course we can reduce the pad sizes and so on increase the clearance so if I double click increase clearance to 2.
(1:57:36) 25 Press B to repour we can see now it's nicely arked in to the S&S feedback pin so this would be one way for example hooking up that feedback or that vout node and this is somewhat different to a normal switching regulator where you have feedback separate to the output voltage node but for example something like this would be okay we can also see we have the ground pin here pin 32 which is sandwiched in between s smps LX and our switch mode power supply feedback so either we take one of these vs somehow try to fit that in which means we'd have
(1:58:07) to place the components further apart and rout around this via or what people oftentimes do what's completely fine to do change our Trace width to the size of the pad press X and root the pad directly into our Expos pad and this is what's done also very much in commercial designs and works completely fine and this means we don't need to have a Vera here and we rout directly into the exposed ground pad like so now we have some traces that are somewhat critical on the left hand side for example we have the USB differential pair as well
(1:58:36) as we have all the serial wire debug IO so let's just start off with the debug IO because this is a bit easier we'll just use our control impedance Trace width for example .19 again we could set that in the net class for example going to edit predefined sizes net classes changing to selecting swd and changing the trace width to be19 mm and pressing okay then trace or track use net class width press X to start rooting so the easiest Trace is this zy debug Trace so we'll start with that we can root out watch out for that large through hole
(1:59:11) and we can go into the pad very very crudely like so we'll still clean up the pads and the traces at the end but this would be one way to root this out the clock very similar as as soon as we can get away from the other pads we don't want to rout for example like so very close to the other Trace because that increases cross torque what we want to do is not go too close to the capacitor not close to the trace but break away give ourselves ample bit of space we want to rout through these two through holes we can press n to change the grid
(1:59:39) rot through into the pad keeping ample space between the trace and the clock these two lines and away from the capacitor then the data IO we need to make sure hopefully we can fit past these vs so let's give this a try click on the pad again to start rooting because we still have the root tool active and rout past these vas keeping ample space again we don't want to hug these we want to make sure we break away as we can like so we go past this through hole again always keep ample space there's no reason to hug or use
(2:00:10) the minimal space you have and to change the grid to make sure we can SLI a p through here and into the pad for example something like this and again this is just a rough routing you can always clean up your rooting afterwards and so on one problem I'm already probably seeing here is trying to root out this differential pair giving that we have this V constraint and the Ser debug iio constraint so we'll have to see how we do that we can either move this capacitor further to the left which gives us more space or we simply root
(2:00:37) out our D minus and D+ traces somewhat asymmetrically to start with just to break out and then we can root out properly so if I try to root out you can see key CAD is trying but because of our clearance con Str we're not going to be able to make this unfortunately so again we have several options what probably is easiest and preserves Aesthetics let's call it is to make the Seri wi D clock trace route lower and then move this 3.
(2:01:02) 3 Vol B and Trace essentially mirrored across this component so vertically so let's try that so for example I've now flipped this top Vier and Trace and this means we have more space for the Dio Trace to root out so I can click and drag and move this a tiny bit just giving myself ample space to make sure that we can root out this D minus plus differential pair the S swd clock Trace here making sure it has still enough space from the VR I can drag that and as soon as I can break away from the V and break away from this other C debug Trace
(2:01:30) now before we start rooting out this differential pair now keep in mind that we did Define if we go to board setup in the predefined sizes a differential pair class with a width of 22 mm gap of 0.15 and so on and we do have to assign that to the netclass so we go to netclass USB want to change the DP so differential pair width to.
(2:01:51) 22 and the differential pair Gap to .15 then press okay then we go to root root differential pair or press six while we hover over the pads we can start immediately drawing out this differential pair and because we've quite nicely now moved the vs and the traces away we can go out immediately try to come away from that other trace and don't go too close to that top right via keeping ample space we can now rout out towards our connector so I'll just stop the rooting here for example because we'd like to do this side first similar procedure from the ESD
(2:02:21) protection as well as from the connector so if we try from the ESD protection which then goes to our MCU we could root Out Pass like so and into our traces and that's fine we can clean this Trace up a bit but we really don't actually need that verer I believe because that Veer that we could just rout underneath the component the 5 Vols into this pad and simply have that ground via there so let's just get rid of this 5V via for now again hover over press six and let's start rooting our differential repair rooting up stying to stay away from
(2:02:52) these non-plated through holes and meeting our other connection like so again somewhat crude again this is just a first guess but might be something okay to start with I can click and drag and kind of root these out maybe just a tiny bit neater maybe something like this again you can play around with this just to make sure that our pad exits are horizontal and before they were quite close kind of hugging this pad five so somehow this might be a tiny bit better and of course we can clean up the whole thing just a tiny bit more as well but
(2:03:20) just as an initial guess this route might be okay then we have the other side of the ESD protection which interfaces effectively with the USB type-c connector and remember we have double the amount of pins here we go back to the schematic because this is USB full speed what we can just do is tie all the D minuses together all the D pluses together which do leave tiny STS but for these operating bandwidths it doesn't really matter so what we could do again hover over these pins and try and rout out now if we try and do that
(2:03:49) that you can see keycard is complaining because quite rightly so we have end points here and end points at the connector now if you try and do that from the ESD protection side we might have a tiny bit more luck but it's not looking great either so what you could do you could start a differential pair root like so maybe clean it up a tiny bit again just clicking and dragging this isn't of course entirely differential but it doesn't really matter for very short segments and then the rest we can just do by rooting
(2:04:17) single-ended so just going to the root tracks tool or press X and root out this last tiny segment single- endly and this kind of gets around this problem I know it's a bit of a hack but we want to make a lot bit easy especially if it doesn't really matter what we do have to take care of is that we have the same track width so here we had 22 mm so we have to create a different a new predefined size go to edit predefined sizes and add 22 as single-ended select 22 and simply finish the rout by pressing X and just
(2:04:46) doing a manual rout out to these tra Braes like so and then we can just drag it in make it a tiny bit neater and keep in mind yes this isn't entirely differential but again it doesn't matter for these short distances what we can then do because we still have to connect up A7 and B6 and this is where these small stubs come in again press X so root single-ended so from D minus we can simply come out the back like so and for D+ we can do for example something like this I know this isn't the prettiest but it trust me it really doesn't matter for
(2:05:17) this USB full speed and there we go something this is absolutely fine for these bandwidths and we've rooted out our differential pair somewhat crudely of course but the distances are so short the bandwidth are comparatively very small so this works absolutely no problem you can of course fine tune and fine tune fine tune this is just to show a rough rooting strategy with that being said we've rooted out most of the critical parts so we've done the differential pair we've done the Ser dbar connector the RF of course the
(2:05:43) crystals and now we have predominantly low speeed signals left for example the boot zero pin we have the swe reset of course we have the ouru as well the LED and so on but these in comparison aren't as critical as the signals we've just rooted out and of course we still have power then we have to clean up our board maybe add some polygon paes and we're pretty much done so actually the rooting because we've done somewhat a sensible job for layout is fairly quick at least for this very very simple board so now
(2:06:11) let's rout out the other traces and this should be fairly quick before we get on to doing the final power delivery then cleaning up the board of course make sure we go back to example our one9 mm Trace width this was our controlled impedance 50 ohm trace and this is what I suggest if you have controlled impedance traces on your board anyway you might as well just stick with the 50 ohm standard even if it's something as simple as you let's say we have our boot zero which looks to be a bit cramped so let's try and root that one out so hover
(2:06:38) of boot zero pin four press X and let's try and root this out keep in mind we still have to root S swd and reset out as well so we need to keep space between components and pins there we go let's rout past this pass the Via and just break away as soon as we can pass the Via and we'll just stop this there because we want to see if we can root out swd and reset then swd and reset let's root out now we could just let Key Cat automatically find a path and then just press okay but I don't really like that pad exit over here what we can do
(2:07:10) is just delete that part of the trace draw a tiny bit up from the bottom either by pressing X or just on the trace and into the pad like so and then drag to clear this up just a tiny bit and again you can play around with this quite a bit as well just to maybe improve the Aesthetics and so on but for example something like so is what we might do now that we have the boot zero and then reset lines out a tiny bit as well we also have to be concerned about the UR TX and RX because before they did go to a connector that was down here but
(2:07:38) now we've moved the connector to the left hand side also the end reset signal needs to go through a filtering capacitor into the sir debug tag connect header so we have three traces that I kind of have to go down and then left around this area and we have one boot zero that needs to go to the switch so either we could root for example the boot zero which is this Trace here again pressing X or using the root command tool in like so but that would mean that either the end reset and the uart lines would have to rot underneath the switch
(2:08:07) through the capacitor and so on which doesn't really make much sense so what would be better to do is root out the end reset your TX and RX lines first and have the boot zero jumper on a different layer so for example then reset could root out first so pressing X through into this capacitor and you can see I've actually rotated this capacitor so the ground is now facing top and reset facing bottom so we simply rot through out to the top past this USB differential pair and we'll adjust this in a bit in just a second pass these two
(2:08:38) through holes like so into the pad and then we can hold and drag and I can press control to increase the grid granularity like so and make sure and reset line is far enough away from the USB differential pair keep in mind along short distances it isn't too critical especially for these types of signals we still want to maximize the space between and reset and for example the USB differential pair but also between and reset and these non-plated through holes of the tag connect header so just as a crew drawing something like this might
(2:09:07) be okay then of course we have Ur TX and RX so we can draw those out again using a trace of .19 mm let's do TX first and making sure our pad entries are nice so ver vertical vertical and again we can drag just make these connections a tiny bit nicer again I don't really like coming out like so but if we were to go down out vertically then we'd have to move this whole stack down so for the sake of time I'm just going to come out horizontally like so into the pad and that's completely fine it's just a personal preference thing for these
(2:09:37) types of signals so we're going straight into our series resistors from our series resistors we go out we don't want to hug the other traces we want to give ourselves ample space and towards the connector so again we have a mounting oil here which we need to get past so we might have to rout example something like so again we'll clean this up because this is too close to the mounting hole now we still have the other Trace we don't want to hug these aren't forming a differential pair or anything they are two separate signal
(2:10:03) lines something like so staying clear of any other features so something like this might be okay we might be too close to the boot zero it's not going to make too much a difference but I like to space out my traces sensibly for something or something like this if you can and maximize space between your traces some this is probably okay now we do have this mounting ho here which is going to make this a tiny bit annoying so what we could do to get ourselves more space is move this capacitor via structure to another side of this
(2:10:33) regulator so I'll just take that are to rotate and for example like so we still have our 3.3 volt pads close and our grant close as well so this is fine and this is an option we explored to start with as well so now that allows me to space out my uart lines a bit better so I can delete these segments press X to root out and now it can quite easily root into the connector I still don't like this clearance between mounting hole and these traces so let me just create some more space delete that segment go up a bit more and come down
(2:11:04) only when I need to for example like so and that allows me to delete this segment X give myself some space and when I have when I'm clear again I can then rout past like so so click drag give myself a bit more space make this a tiny bit more even again you can find tune this quite a lot this is still a fairly rough layout but anytime you can you have space give yourself that space again you can f tune as much as you want but it's important to always keep clearance even if they are just DC signals I like to space everything out
(2:11:35) it's just good practice to do so and again you can spend quite a lot of time doing this but something like this might be an okay starting point you can see again an iterative process we move stuff around to make space then of course we still have our boot zero pin in this connection which we left for last and remember this we want to then jumper over by using the bottom layer to get to example to boot zero to this resistor what might be better is actually to rotate this whole structure cuz there's no reason we want to go from this Trace
(2:12:03) all the way to the left we could make it easy just by going for example to the right side so I can take all of this and simply r r rotate so for example just rearranging components it could look something like this again it doesn't really matter in this particular example what does matter is that we use a v to jumper boot zero on the bottom layer then we return or come across somewhere over here again with a via and go into the boot zero and then to the switch as well I could of course also going from this boot zero pin I could want to press
(2:12:34) X of course rout close to the Crystal but that's not what I want to do even though it's a pretty much DC signal this DC signal can be switched and we want to stay away if we can and we can in this case away from sensitive componentry such as this so I'll rooot down a bit press V which lets me place a VR and immediately it'll jump to layer four which is a bottom layer and I can simply come across press V again return on the top layer and then root into boot zero there we go now we've jumped from the top layer to the bottom layer rooted
(2:13:03) across jump to the top and then we go to the top layer components for example again there's many different ways of doing this doesn't really matter too much for low speeed signals but because we're using two inner ground planes so in inner one and inner two on the top layer so front copper or all of these signals at the top effectively reference the bottom layer reference Layer Two and the bottom layer all of the signals reference the third layer so inner two so when we're changing from top to bottom layer we are also changing
(2:13:29) reference layers the question is what happens during that Z axis transition the Via where's the reference so what we do and that's what's called a transfer via we can press control shift V or this button on the right hand side and place a via close to our signal via and this will place a grounded via close to for example boot zero and we place another transfera close to boot zero here and this just ensures we have a continuous return path also during that Z axis that vertical transition throughout the board
(2:13:59) and this matters much much more for higher bandwidth signals but this is just a demonstration so now we just have to finish up this very short segments of rooting I still need to place a 3.3 Vol V here and hook that up and then we also have the CC pins which we can root out so for example just pressing X and rooting those in like so and in like so and again this just demonstrates that once you've done a pretty decent job of layout and even though we did this quite quickly you can see the rooting part is then fairly straightforward the LED here
(2:14:28) as well we need to get past this ground via so let me just try and get past this staying away from that ground via keeping space and into the LED this Trace doesn't have to be particularly wide keep in mind our LED is only carrying you know less than 10 milliamps of current and then we connect the cathode to the current limiting resistor as well for example something like this and there we go now we should have hooked up all of the remaining signal connections let's just see if there's anything missing but it looks like we
(2:14:56) just have 3.3 volt and ground connections and maybe these power 5 volts from the USB connector remaining and as well to the uart connector what we also might have seen is that we did select thermal relases any connections on our planes but for mounting holes we're not already soldering anything to them so it doesn't make sense to have thermal releves so what we can do is click on one of these mounting holes select footprint press e to open options go to clearance overrides and settings then at the bottom connection to Copper
(2:15:24) zones we'll change this to solid press okay and press B and now you can see we have a solid connection to that mounting hole and we'll repeat that for the other mounting holes as well so I've changed that setting for all the mounting holes and here we go now we have Solid Ground connections from the internal planes to these mounting holes now what's left for us to do at least to start with is hook up all the grounds and powers and for that we want to use wide Trace Tres ideally as wide as the pad this is not
(2:15:50) just for DC current carrying capabilities but also to reduce inductance so thin traces thinner traces have high inductance whereas if we use for example half a millimet trace compared to a 0.15 MM Trace then root the trace this has a low inductance comparatively so I can root out for example from the USB 5 volts I can rout in for example directly into my capacitor of my ldo I know we said we would rout to the TVs diode first and then to the capacitor but for the sake of time I'll just do it like this so from the TVs pad we can just do this tar
(2:16:22) Junction and that's absolutely fine and also this T bar Junction on the other side we can also root for example to our 5V pad on the other side keep in mind this is a USB type-c connector so it's 180° flipped again we can either use polygon pores or traces to connect all of these up so I could do a polygon pore just as we did for example with a switch mode power supply feedback or output voltage node but for the sake of time let me just draw wide traces so ideally traces is wide as the pad so I can select for example 6 press X and hover
(2:16:52) over and just root in these traces like so the power on ground we do like so we can do little polygon paes for for example the ground for the ground pins pad 3 was also 5 Vols but if you remember back looking the LD pad 3 is not a current carrying pin it's just an enable signal so for that we can use a narrower Trace let's say .
(2:17:14) 19 mm we root out and just into to the wide Trace something like that is fine for our signal then for the output node we could for example do a polygon pull so on the right hand side or press control shift Zed click somewhere select 3.3 volts pad connections solid press okay and we can draw the polygon pae as usual and remember this needs to Encompass the vs as well and even with polygon paes of course you want to maintain clearance so keep in mind we have a trace directly underneath so a connection for example to start with we can draw a polygon pae
(2:17:45) and then we can of course drag the nodes to clean this up up a tiny bit like so then I can press B now we have a polygon P at the output of the Power Pin of the ldo the capacitor and the v's that I then used to feed the rest of our power distribution Network so effectively this is the source of our 3.
(2:18:01) 3 volts which we then have to hook up so for example when we have a 3.3 volt VR then we'd use for example the bottom layer so the bottom layer if I right click and then hide all layers but active I get this view which is just the bottom layer and at the moment we just have the Via pads and other pads and this one boot zero Trace so that's why it's quite nice with a four layer board I can use a very wide trace for example 0.
(2:18:24) 6 mm press X and this was the output those two vs of our regulator and I can just rout through for example all of these 3.3 Vol connections for example like so that's one way of doing it and that's very easy very straightforward we don't have many connections to do but what we could also do so if I undo all of that for example to the inner layer what we could also do is simply copy this polygon pole so contrl C r v select it and press e then we'll change it just to be the bottom copper layer and change that to 3.
(2:18:54) 3 Vols press okay and press B and now we can see on the bottom layer we have a 3.3 Vol polygon p and it's automatically connecting to all the 3.3 Vol vs and nothing else so we have clearance between our traces which is what we want and that's what we set in the properties but it connects to the 33 Vols and the nice thing is because we've done it like this we get a tiny bit of capacitance between the bottom copper layer and the ground layer which is facing the bottom layer and because those two layers so inner copper 2 and bottom copper are so
(2:19:22) close we actually get very very low inductance of the planes this is a very good thing for power delivery keep in mind it's definitely not needed for this design again we could have rooted power depends on how many other signal connections you have and so on we might have used far more of the bottom copper layer so you might of course think this is complete Overkill granted it might be but using four layers enabled us to use far thinner traces for the RF sections to hit that 50 ohms impedance and also for the USB differential pair and in the
(2:19:49) case we can also see this in 3D view so alt three we can see the top layer doesn't currently have a polygon pore but the bottom layer has this 3.3 volt polygon pore like so so we didn't have to do any further roting we just hooked up our 3.3 volts as before with just a single plane which is quite nice and quite handy now I do need to add a 3.
(2:20:08) 3 V here for the switch and of course I need to hook that up to the pad for example like so so now we have all of our 3.3 volt connections made but we also have to hook those 33 Vol connections also to for example to the qfn package of our MCU and for that we'll use a similar strategy as we did for example with the LX node we start with a trace that's as wide as the pad and as soon as we can and as soon as we have space we widen out and we'll do that for all of these pads and for the ground pad here pin 22 we won't actually connect that to the
(2:20:36) exposed pad because this is the RF ground and we'll make that tie to this capacitor which then goes via y Trace to an internal ground layer with a V so for that we'll use a .25 mm Trace and we'll simply root out for example something like so and for the 3.3 volts because we don't have particularly much space then we just hide the internal layers so we can see it a bit better X to root out and we just simply root into the pad and we can drag our traces a bit just to make the entries and exits a bit neater you can see the trace is not
(2:21:06) particularly wide it's just as wide as the pad because we don't have particularly much space to widen out before we hit the capacitor and this is fine for these very very short connections keep in mind these are fractions of millimeters or on the order of M I did have to remove the hsse out trace and it looks like we do have to rout in from the top again it's not my preferred method but for example some route like this is probably okay now I'd like you if you are following along of course to do the same principles as we
(2:21:32) did with the switch mode power supply LX pin for these 33 Vol pads that are more easily accessible and that we can widen out these traces and I'll see you in just a second now I've added either Trace connections or polygon pores they're also known as power puddles to these very ious 3.3 volt connections so for example sometimes you have enough space to start out with a small Trace which is wide enough just as wide as the pad then widens out into the pad of the capacitor wide Trace into the VR into the power plane we have on this board
(2:22:02) other times you would have enough space where you just have to have this thin short trace and that's fine as long as it's short enough and sometimes you might have these multiple capacitors and multiple power pins which you can connect up using these small polygon poles these are 3.3 volt poles in this case which Encompass the vs pads of the capacitors as well as pads of the qfn or of the IC this is fine Reflow as well so we've come pretty far already we've hooked up pretty much everything but we still have of course the ground
(2:22:31) connections or some of the ground connections missing so we could either continue by using these wide traces short wide traces and hooking up all of these ground connections like so so we have just a wide Trace let's say5 mm Trace press X and hook up all of these ground connection like so and that's completely fine and we work perfectly but one way that might make it easier also because now we have a bit of a copper imbalance because on the top layer we have quite a lot of copper that is etched away so we just have these
(2:23:00) small thin traces and most of the board of the top is empty then we have the first inner layer a pretty much solid ground plane the second inner layer which is also pretty much a completely Solid Ground plane and the bottom copper layer which is completely solid pretty much completely solid 3.
(2:23:14) 3 volt plane so we have the front copper which is kind of empty then we have full layer full layer full layer so what we have to do and this is called copper balance and this matters the larger the board is but it's also wasteful to etch away all of this copper So within reason and there are of course exceptions when you shouldn't do this but for a board like this we could for example pour the top layer with copper however if we do this for example if we take our inner copper layers and also add the front copper layer with ground let's do that press B
(2:23:40) to repour and let's look at the front copper layer we can see we have all of these copper Islands now poured as well we have thermal leaves on the pads which is something we would want to help with these small components and tombstoning for example but we also have copper these ground poles very close to these traces and any copper close to traces will change the impedance profile so what we would have to do is either increase the spacing or the clearance of the top copper layer to make sure it's far enough away from these RF pads that
(2:24:09) it doesn't make a difference and that's typically three times the height of the dialectric so if we go to edit board setup and look at our physical stack up again we we have a dilory that's .11 mm thick between for example top and inner first layer so we want our clearance to be at least about 3.
(2:24:27) 35 mm on the top copper layer currently we have about A3 mm clearance which is just about okay we' probably want a tiny bit more clearance than that another way we could do this is use a keep out area so we could draw a keep out area around the RF sections so if I on the right hand side or press control shift K I could draw a keep out area just for for the copper fills for example and then I could draw that around my RF section example like so press B and that would get rid of the copper around my RF traces for example but what we'll do instead is we'll just
(2:25:00) change the clearance to be35 and this won't have too large of an effect on the impedance so now all the pads and traces have 35 mm clearance which is just enough to not affect the impedance by too much but of course verify that with your PB manufacturer with these copper PS now in place you could of course just get rid of these large traces it depends on which route you want to go if you do go the route of just letting the copper pull the fill on the top layer do all the ground connections for you you can of course play with the parameters for
(2:25:30) example that the thermal relieves have a smaller Gap and maybe a larger spoke width for example and you can try out different parameters that might suit but keep in mind in Copper balances making sure that the Copp on one side of the component is similarly much as on the other side especially for these small parts for example for these spoke width then I would also move the vs back a bit so the CPP of the VR doesn't interfere with where there should be a thermal relief so I'd move them back a bit and adjust my vs for example like so what we
(2:25:58) also have to do because we have so many ground planes now we have front copper ground plane we have inner one and inner two we also need to add stitching vs stitching veers are effectively in this case grounded veers that we place at irregular intervals all across the board and this makes sure the impedance between these individual ground planes and fills and layers is minimized by having many of these parallel vs that we improve our return paths as well for this we can either use the 7 and3 mm vs or we can use larger 9.4 and place them
(2:26:29) scattered across the board so if I select vs I can place them across the board set up a grid that's fairly large maybe 1 mm and place vs all over the board the spacing of these vs is determined by the maximum frequency content of the signals on your PCB for us that'll most likely be be this 2.4 GHz Bluetooth Link and we can work out the wavelength by knowing that we have the speed of light so about 3 * 10 8 m/s we divide that by the square root of the dialectric constant and for us that was about 4.29 and our frequency is about
(2:27:02) 2.4 gz so 2.4 * 10 9 this wavelength we have to divide by 20 and this is what's typically known as the critical length and there's many different types of critical length and equations for this but a safe approximation is about divide by 20 and then I'm just timesing by the three to get millim so a spacing of about 3 mm is what we want for our stitching so 3 mm or smaller we can get to inspect measure tool or control shift M so we could even space our vs out further so now we have a 2 mm spacing but this can't hurt so let's continue
(2:27:33) that via stitching so for example very roughly some stitching would look like this if we go to 3D view again alt three we can see that we have loads of these copper pores sometimes these are these islands and it's important that these islands effectively don't float so they're tied down with vs which are spaced at the intervals we discussed I haven't done it completely here but the idea is that you don't get plain resonances and that you don't get of these copper areas that resonate by themselves and the way you can do that
(2:28:00) is by stitching and it also improves the inductance and impedance properties between all of these planes and these copper fills we have in this design now of course this is very quick very crude but for the most part we're now done with the layout and routing there are things we can clean up for example the differential pairs of course look maybe tiny bit funky and so on we don't need to do any delay tuning or anything this is USB full speed so we're pretty much fine in that regard what we need to do is a designer will check and clean this
(2:28:26) board up a tiny bit so you see a lot of this silk screen is on top of holes or too close or interfering we might need want to add teardrops remove unused VP pads and so on so there's a few steps now that we need to take and this is what you usually do at the end of a PCB design so the first thing you might do before you go over to DRC is just to clean up the design make sure everything's connected Ed and the drlc will of course also tell you that but for example make sure that silk screen doesn't overlap and if you are going to
(2:28:53) use silk screen designators that they aren't on top of holes under components and so on what we also can do to simplify the design rules and let the manufacturer deal with this we did set this up with the beginning so if we go to edit board setup go to solder mask and change the solder mask expansion and minimum we width to zero and then we'll ask the manufacturer to adjust the solder MK openings as they see fit and how it improves the manufacturing and assembly processes and this is easier what I actually normally do in for
(2:29:20) example professional designs is I adjust the solder mask openings myself and of course discussing with the manufacture but that is quite a lengthy process so we won't be discussing this in this video but now we can move silk screen around make sure it's not too close to the board things like that make sure to always use the 3D viewer because that's quite helpful you might detect silk screen under components or for example this U2 here is on top of the hole and so on of course this is manufactural and the manufacturer might edit that the
(2:29:47) themselves but I like to send a board off that's quite close to how I want it and not have the manufacturer so to speak mess around with my board files too much you want to be in control of your design but that would be some of the checks you might want to be doing before we move to the design roll check another thing is for these IR sections what we can do because we have top copper underneath we have this ground plane underneath we have yet another ground plane and underneath we have yet another Power plane so actually these
(2:30:13) traces at the top will couple predominantly of course just to the plane underneath but it could be that Parts couple also to the bottom to the lower two planes as well now given the dimensions of a four- layer board this is actually quite a scale layers 1 and two and layers three and four are far far closer to each other then those two layer PES are to each other so therefore you have a very thick core in between between layers two and three so actually get very very very little coupling but the overall effect of course is if you
(2:30:44) leave those bottom two power ground planes in and don't do a cutout underneath is that you actually will reduce the impedance because you do get more coupling so this needs to be taken care of in more critical systems in designs such as this yes you can add in a cutout but for the sake of time we won't do this another thing we can do for the RF section is add for example tear drops so we talked about that for example these RF traces are comparatively very narrow compared to the width of the pad and we can actually
(2:31:11) ease that transition so what we could do is globally add teardrops so go to tools add tear drop and we can change certain parameters here so these teardrops effectively adjust the joint so to speak from a wide pad to a narrow trace or if it's if tract to Via tract to pad and so on so we can do SMD pads only and if we just press okay you can see we adding these teardrops and these teardrops in 3D we can see here we can see we get these transitions between wider pads and narrower traces you can leave those in
(2:31:41) but it could lead to more design rule errors for us and for these short distances actually the impedance discontinuity here is pretty much irrelevant so we will not add teardrops what I would recommend you do however is go to tools remove unused pad shapes this is because if we just look at the inner copper layer we can see we have all these ground connections which are solid connections to these vs but then we have these 3.
(2:32:07) 3 Vol vs which still have the pad there which isn't connected to anything now we can get rid of those pads and make sure we have less of a ground plane cutout we're going to tools remove unused pads and we'll do fears and pads and remove or keep the outside pads though and press okay now if we go to Inner one again we can see the pads have been removed and press B to repour and we can see now we get smaller cutouts in our polygons due to that we do however see that closely spaced vs do increase our cutouts and we don't get slivers through them so for example
(2:32:40) we're going back to the top copper layer what we could do is we move our 3.3 Vol vs further apart press B to repour and now we see on the inner layer with these V Space further apart we now have this sliver of copper that can flow through these two vs with their pads removed and I've done that for the other Nets as well you can see on the bottom copper layer this is where have our 3.
(2:32:59) 3w polygon that's quite cut up and that's to be expected because we're leaving start and end layer pads of these vs also it doesn't really matter for this layer because this bottom layer isn't a reference layer the reference layers are inner one and inner two now with all this in place we've rooted our traces we've done some very basic checks of course there's plenty more checks you can do and that's a topic for another video we can run our designer or check or DLC for short the design rule check checks the rules we set up at the start
(2:33:28) so these design rules these constraints we can also change the severity of the design rules if we get errors or Warnings or if we ignore them and we can run the design rule Checker by going to the top these three check marks show the design rules Checker window then click run DRC little check and we have eight errors we have no unconnected items that's that's good and ignore tests we have some here as well but for us importantly are the violations and if we close this window we can go to these arrows where there are markers where the
(2:33:56) design rule Checker has found something so we can open that window again we see we have whole clearance violations and these seem all to be the same thing of this USB connector so we have this non-plated through hole which are these mounting pins or these mounting holes and that's too close to these copper features so we've set up a constraint of 26 mm but actually sometimes it's less than that or sometimes it's.
(2:34:21) 194 so there's a couple ways of doing that the first thing is we set up our clearance constraints to be quite conservative meaning the manufacturer might still be able to produce this and we just set up quite strict design rules so we could relax our design rules and then probably get rid of these errors we can't move the through hole but we can for example change the shape of the pads and still be okay so for example I could select one of these pads that has a violation press e to bring up the options editor and then simply adjust the pad now this
(2:34:49) should be really done in the library because this error is going to come up again and again every time you use this part or again relax your constraints so I'll just change the length of the pad from 1.15 to 1 and compensate the exposition for that change which is half of the change we had so that will be 505 press okay and now you can see the end position of the pad is still the same but I've reduced the distance from that non-plated through hole to the pad so if I rerun the designer R check run DRC you can see we have one violation less
(2:35:19) because we've solved one of them so now I've done this for all the other pads as well if I go to show the design rules Checker again run DLC we now have zero errors zero warnings because we've now fixed that now of course this might come across a bit crude but I've actually done this before on this footprint and I use this footprint quite a lot in other designs and exactly this method works very very well go to 3D View and then if we remove the SMD components you can see what we've done with these pads is simp
(2:35:46) simp L shorten the ends a tiny bit and this is by .15 mm so it doesn't make a very large difference but it does mean we have better clearance to that non-plated through hole again talk to your manufacturer that's the preferred route to see if it's manufacturer with the default footprint otherwise you can always adapt the footprint with that being said we're pretty much now done with the PCB design we've done the layout and routing we've hopefully checked the schematic and now it's time to check the routing as well so make
(2:36:13) sure you have adequate spacing between the traces if you want to add teardrops youve removed unused pad shapes you might want to void the additional ground and power planes underneath the RF section you might want to add test points you will want to add silk screen maybe your logo and so on so there's many many steps still to come after you've completed layout and routing you might also clean up the silk screen do mechanical checks there's a lot lot to do and that's actually a future video I'm planning as a PCB design check list
(2:36:40) that goes through this in detail for now I'm just going to add a tiny bit of silk screen and then we'll move over to generating the man facturing files and seeing how we can order this board so other than the checks we talked about and again that will be a future video I think this video will on its own already be very very long there are many checks you should do after a PCB design for now I'm just going to add some silk screen just to make it look maybe a tiny bit nicer so I can go to the silk screen layer on the right hand side and use the
(2:37:04) add text items so just adding a text I would for example put the name of the board so s32 demo PCB and then I could add for example silk screen to the board now of course this needs to fit I recommend a character height and width at least 1 mm and a thickness of about. 1.
(2:37:23) 15 mm as the absolute smallest so for example something like this maybe it's a bare minimum really you can get creative but for the sake of time I just added some Basics so indicating maybe what the connectors are this is zbug uart your logo or your name what revision date or date code your initials what connectors do and so on don't forget of course pin one indications maybe outline indicators and so on so you really can get creative but there are of course some Essentials I would definitely put pin one and anode cathode markers as a bare minimum you
(2:37:51) could of course also add for example what this led does and so on but this is just a basic very basic example with that being said now that we've done some very very basic checks of course you should check your PCB very very thoroughly make sure everything is in order communicate with your manufacturer but then we can actually start generating the manufacturing files and I'll walk you through the ordering process going back to the schematic editor let's start out with a bill of materials if you remember back after we
(2:38:17) finished the schematic we went to this bulk edit Fields button and then we added in distributor links manufacturer manufactur part numbers and this information we want to export to Bild materials excluding these fids and mounting holes the way we can do that is go to tools at the top generate bomb or B materials and I've copied a generator script which you can choose on the left hand side and added the custom Fields manufacturer manufacturer part number and distributor this I've placed as a custom python script in the plugin
(2:38:46) folder and all I've done I simply added manufacturer manufacturer part number dor Link in the headers and then also per row taken from the components now if I select that script at the output I'll just append B so build materials and click generate then I can click close And navigate to the directory where my project is and this is where you'll get whatever your project name is- bomb.
(2:39:11) CSV so for example we see the footprint how many we have the designator the value manufacturer manufacture part number and distributor link and this is one of the components we need if we want to get our board assembled is a SP of materials essentially just telling us what components they are what the manufacturer is manufactur part number where to Source them and where they are on the PCB as in their designators and their values this can then be used by your PCB manufacturer and assembler to Source those components and then
(2:39:37) correlate those with the pcbs and the way we correlate them with the pcbs is if we go to the PCB editor export the footprint position files and this is effectively the XY coordinates of the centers of the components so for example relative to a certain origin where is the micr controller placed or where is this capacitor placed and this is for the automatic assembly machines to automatically place rotate those components before soldering before we export that file I would like to set my grid origin and my place file origin to
(2:40:08) the bottom left of the board so I'll just set the grid origin to bottom left and then Place drill Place file origin also to the bottom left this is typically the datum you would select your origin to be at so bottom left of the board then we go to file fabrication outputs and then component placement IID directory we can click the little folder button just select the project folder or you can generate a separate for example assembly folder then we can change the format to either asky or CSV either as fine we'll just keep it it ask you for
(2:40:36) now unit as millimeters and because we only have top side assembly this right radio button isn't particularly relevant for us but typically a single file for the board the rest you can leave the same and click generate position file close and then we see this position file appear in the project folder I'll just call this CPL so component placement file I'll rename this to txt then we open this file we can see we have every single component listed every component on its individual row we have what value it is the package the position and
(2:41:07) rotation and what layer it is on and this information you would then send along with the will materials and what we'll Su next the Gerber files to your manufacturer and assembler and let me just create a new folder called manufacturing and I'll move those parts there so the build materials and component placement file for now and now of course these are the assembly files but we also need the actual fabrication manufacturing files of the PCB and a very common but rather old standard is Gerber files so we can go to file
(2:41:34) fabrication outputs Gerbers this is effectively the data per layer so we have the copper layers we have the paste layers silk screen layers mask layers outline and so on and that's what we have to select here so first all the output directory we'll select manufacturing then we can choose the layers you want to include so all the cou layers we want the paste only on the top layer because we don't have any paste or solder paste requirements on the bottom layer we want the front silk screen we don't actually have any silk
(2:41:58) screen on the bottom layer so we can uncheck that top layer mask and bottom layer mask this is the solder mask and the edge cut is the outline layer we can use the droal place file origin for this and remove the options for plot footprint values and reference designators and we'll keep the rest as set before we click plot we can also generate Dr files on the bottom right so click on that we'll keep plated through hole and non-plated through hole in separate files dral units will be millimet and we'll leave everything else
(2:42:25) as standard and click generate drill file click close then go to the manufacturing folder you'll see we have two drill files here now then we can click plot refill the Zone fills close in the manufacturing folder we will now see all these gbr files which are the Gerber files so to check those files we can go to key CAD the main window and click on Gerber viewer file open autodetected files Navigator manufacturing and select everything except the bill materials and the component placement file and click open and this is a check I would always do is
(2:42:56) use a gerber viewer just to check that the exports look correct so on the right side I can go to layers hide all and I would go through for example the front copper layer then for example I would check the inner copper layer then the second inner copper layer the bottom copper layer I can check the non-plated through holes for example for the USB connector and the Sero wire debug header plated through Hol which are my vs and for example my mounting holes as well as mask layers for bottom mask layer top the top paste layers as well as for
(2:43:23) example the silk screen layers and so this is a final check I would do and often times you can spot maybe small imperfections in your design just by looking at the Gerbers because they give you a different view Angle now that we've checked the Gerber files we take those exported files that were placed for example in my case in the manufacturing folder or wherever you exported your G files to we need to place them into an archive typically zip or is fine as you seeing here this is just an archive that contains all of the
(2:43:49) exported Gerber files because we'll need this later when we upload to our PCB manufacturer now that we have the build materials the component placement file or the pick and place file as well as our Gerber files all zipped up in an archive this would be the bare minimum one can send to a manufacturer to get an assembled PCB produced however it is very much recommended to add more information in particular in our case we might require control impedance or have certain specifications for our pcbs and we need to deliver those to our
(2:44:20) manufacturer as well of course you can use online quoting systems and so on and talk directly to your rep but it's best to include this information along with your design files or your design outputs the PDFs I'm showing you here are actually not from keycard are some very simple designs of what these additional documents might look like for one we have an assembly drawing or assembly information and effectively that's a PDF render typically of the top and bottom sides of your PCB depending on where components are and this allows for
(2:44:49) example manual checks for example if we're having manual placements and so on to see where components are where components need to be placed the orientations and so on and can contain additional assembly notes so for example for the sm32 WB PCB I had produced we have component designators we have pin one indications orientation indications from the top and also bottom sides of the PCB in the case of the boards I had produced now I originally had designed this board in a different ecad tool but you can do similar things also in key
(2:45:20) CAD there are a few tutorials that I'll leave online one option for example going back to key CAD is using the fabrication layers on the right hand side if I just select the fabrication layer that typically has this information for example typically taken from the footprint we can also add in the edge cards layer so show that on the right hand side if we export this for example as a PDF this might make a very very basic assembly drawing we have component designators we have pin one indication and so on so a very simple
(2:45:47) way to export this as a PDF would be to go to the top file plot then include layers for example we can just choose our fabrication so f. faab or if you have bottom layers and so on and plot on all layers we can select for example just the edge Cuts layer to make sure that outline is drawn we want to plot this as a PDF and the output directory just for example our manufacturing directory click plot and this might generate a file that isn't particularly pretty but it's a very very basic assembly drawing so we have component
(2:46:16) designators drawn we have the outline drawn as well as pin one indicators for the parts that do have that or for example anode cathode markings for diodes now there are definitely better ways of doing this but this might do as a very basic drawing again depending on the complexity of the design you might want to add in additional assembly notes for example where to pay attention to sensitive parts you might want to add bit materials directly in the PDF and so on other than for example an assembly drawing what I typically will add and
(2:46:42) again this was created in a different program but you can also just create create this in a gerber layer or just add a text file and that's what we'll do it's a manufacturing information document and this is a very very basic reduced version will give some basic information about the PCB for example what dimensions thickness how many layers what surface finishes and so on you might want and for example information on the stackup that you might have chosen or are basing your impedance control calculations on and
(2:47:08) then you might also indicate impedance control requirements in that document for example we need single in 50 ohms what type of Trace so m trip what the reference layers are so on and what your guess of a trace width might be and you list that for all the impedances you need in your design for example now this in itself is a very very simplified fabrication drawing typical fabrication notes will include far more information so for example for a different design of mine you would indicate for example fabrication notes given to certain IPC
(2:47:36) standards and so on and so forth and this will actually be the topic of a future video as well how to create your own very detailed fabrication notes this will go into stackups showing different layers what impedance control requirements there are a dral drawing for example what tolerances you need and could also include the assembly information in one document and that's what I've done for example on this design as well now you don't have to add this to the design for most of these quick turn PCB fabrication houses such
(2:48:03) as PCB way so for example just the Bild materials component placement files and Gerbers are enough but I would typically add an assembly drawing at a bare minimum as well as some notes on our PCB requirement for example now this is incredibly crude but for example just a simple text document that you then include in your Gerber zip file will do if you need special requirements for example we can just say we need impedance control we have two different types of impedance that we need we list those so we need 50 ohms with a certain
(2:48:30) tolerance and that's typically plus - 10% we want a single-ended and a micr strip so an external layer Trace we could also add in that we have a ground fill around the sides with a certain spacing so you can ask the manufacturer to also adjust that and then that would be called a c-l of micro strip with ground our Trace is on layer one and it's referencing layer 2 and we've assumed a trace width of about .
(2:48:53) 19 mm according to the calculators then we have another controlled impedance requirement that's 90 ohms plus- 10% this time it's differential again a micr strip and we can of course also specify a single ended impedance requirement as we can play with the individual Trace widths of our differential pair and for this will do 50 ohms plus - 10% single-ended again layer 1 referencing layer 2 this time we have to give a Trace width as well as a trace spacing we can then ask the manufacturer to confirm the trace widths and spacings
(2:49:21) and also adjust the stack up as necessary because we don't have any particular stringent requirements what materials they use and so on as long as they can hit these impedances so this document again this is incredibly crude we can just add to the zip file and this is a very very basic example again you saw the manufacturing assembly files before and that's what you really should do for professional level designs but something like this this is completely fine the reason we haven't actually added more information so for example
(2:49:49) what the layer counts solder MK silk screen all these types of information is because for example if you go via PCB way you will to use the online quoting service and enter this information manually anyway for the sake of time and simplicity we'll just enter the information here but typically this should always be put in your fabrication notes document so now with these files in place we have a very crude assembly drawing we have the build materials component placement Gerber and in the Gerber directory we have the impedance
(2:50:16) control notes made a typo here this is then what we can submit to PCB way so we can go to PCB way.com click on PCB instant quote and we can either enter the information ourselves here or go to Quick order PCB on the right click add go file and then open up our ZIP file or upload that of the Gerbers and now PCB Way's online system will automatically fit in quite a lot of this information what we do need to fill in is the layer order from top to bottom so looking at the zip archive top was F uncore cuu then in 1core cuu in 2core cuu and then
(2:50:50) bcore cuu like so and this is typically something you would have in your fabrication notes anyway so click on submit it's automatically identified the size of our pcbs we can choose the quantity layers it's automatically identified as four we want F fr4 the glass transition temperature of our F4 is fine minimum track spacing 5 mil is1 127 mm but1 127 or 5 mil spacing on track side just isn't a cost add so we can just leave it at this the minimum whole size we had 0.
(2:51:21) 3 mm and now you can play around you can have different solder mask colors green is of course the cheapest and white silk screen is of course the cheapest so we'll go with that the service finish can play quite an important role in your design and manufacturability solderability and so on but for us we can go with something as simple as hot air surfice leveling and that for that I typically go with lead free vs are tented but we can see the node here for Gober files this Choice does not affect anything finish copter 1 o in a copper 1 o yes I'd like
(2:51:48) to remove the product number and here if we open up customized Services we can click impedance control and this will also give a hint to the manufacturer that this is what we want and then we can also add in special requests and then I would for example just add a note please see impedance control text file in Goa zip archive just to hint the manufacturer to this this would be enough to then place an order for just the bare pcbs but we do want assembly as well so we can go with assembly service if we just check that we can either have
(2:52:16) PCB way Source the parts or we can send them to the parts or we can do a mixture of both the easiest is of course that PCB way handles the sourcing so this is TurnKey and we'll leave it as that board types we won't return to single pieces and the assembly is just the top side then we type in how many boards we want assembled let's say we just want five we don't have any sensitive parts and we don't accept any alternatives or substitutes other parameters now if you want a more accurate quote before the sales rep checks your bilding materials
(2:52:43) and so on you can enter the numbers you need n parts and so on here but we can leave this blank for now here we can also add in detailed assembly information but again I'd recommend creating a proper assembly drawing and referring your manufacturer to that then we can press save to cut we can agree to this we're not doing anything like this and what we have to do now is we've already uploaded the Gerber zip archive we have to upload the assembly information so we can click on ADD file in the middle we want to upload the Bild
(2:53:08) materials so click on that now we click on the B materials the centroid file which is our CPL text and other files for example assembly instructions and so on we would upload here and they do need a zip file so going back to manufacturing I can write click on my PDF and just compress that to a zip and then upload other files and we'll upload the assembly drawing as well then click submit order now and just like that we've submitted our PCB order for the bare pcbs with assembly and that PCB way sources all of these components for US
(2:53:39) based on our building materials so a pretty straightforward process so after about a day or two the sales will come back to you with an adjusted quote if you have special requirements for your PCB that might increase the cost or change the cost the assembly cost might change you have very complex Parts a very small or fine pitch parts that need x-raying and so on and of course the component cost isn't filled in yet but once they come back to you with the final quote you just say yes this is okay or not you will discuss for example
(2:54:06) impedance control how they might adjust the trace width and they can do this for you or you can then adjust the trace width once the manufacturer has talked to you about what the trace switch should be for their stackup and using their impedance control calculations but that's most of what's to this for these rather simple designs and hopefully this showed you that this is actually quite straightforward just to show you what it might look like what your manufacturer might get back to you with the regards to stackup so this is then the stack up
(2:54:33) information they sent back to me after I asked for these specific impedances so this is a four layer board the one I had produced we can see copper then we have prepregs of a certain type a core with copper either side pree and copper again and this is pretty much the stack up we had as well and we can see what their recommended line widths are and what actual impedances you might get of course within a certain tolerance as well as Trace spacing then for the differential pair so this is then what you would take and you can then adjust
(2:55:01) the design yourself or let the manufacturer adjust the traces and you of course need to tell them which ones they need to adjust but I'd strongly strongly suggest always speaking to your manufacturer getting feedback and of course also doing this before you even attempt the PCB design that you know what capabilities what manufacturing capabilities you can design too and these are then how the boards turned out I did create my own panel for these because the these were rather small so I had effectively three pcbs in one panel
(2:55:27) and as we saw earlier I actually exposed pretty much all of the pins on the sm32 WB 55 MCU and instead of a UFL connector I used a chip antenna and I'll demonstrate how to do that in a future video as well but other than that it's pretty much the same board we designed I have of course tested this and it works very nicely so there will be a firmware and getting started guide while using the Bluetooth line of microcontrollers from St in a future video so make sure to subscribe so you don't miss out on those videos in any case I hope this
(2:55:58) rather lengthy tutorial was helpful for you that it showed you how to create a schematic from scratch how to incorporate a microcontroller add in all of the supporting circuitry choose for referals and pinouts how to do the PCB layout and routing and also how to use kecat 7 hopefully in just a couple of hours you can see how quickly you can design your own boards and how comparatively easy it is if you follow typical rules of thumb manufacturer guidelines data sheets and so forth so thank you very very much for watching
(2:56:24) this video if you like the video please leave a like a comment if you have any questions and don't forget to subscribe to stay up to dat with any latest Hardware design DSP and PCB design videos there are many many different videos on my channel going into more detail than we can in this one very basic video if you like to support the Channel please do check out my courses and sign up to those as I can go into to far greater detail on more advanced topics on those again links in the description below thank you so much for
(2:56:50) watching and I hope to see you in the next video bye-bye