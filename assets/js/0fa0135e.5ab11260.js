"use strict";(self.webpackChunkPCB_Design=self.webpackChunkPCB_Design||[]).push([[2140],{5940:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"projects/project-stm32/stm32","title":"3. STM32 WB55 Microcontroller Power Architecture","description":"3.1 Power Domain Specifications","source":"@site/docs/09_projects/05_project-stm32/03_stm32.md","sourceDirName":"09_projects/05_project-stm32","slug":"/projects/project-stm32/stm32","permalink":"/PCB-Design-with-KiCad/docs/projects/project-stm32/stm32","draft":false,"unlisted":false,"editUrl":"https://github.com/CagriCatik/PCB-Design-with-KiCad/tree/edit/main/webpage/docs/09_projects/05_project-stm32/03_stm32.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{},"sidebar":"projectsSidebar","previous":{"title":"2. Schematic Design Basics","permalink":"/PCB-Design-with-KiCad/docs/projects/project-stm32/schematic"},"next":{"title":"4. RF Section Design","permalink":"/PCB-Design-with-KiCad/docs/projects/project-stm32/rf_design"}}');var r=n(4848),s=n(8453);const o={},a="3. STM32 WB55 Microcontroller Power Architecture",c={},l=[{value:"3.1 Power Domain Specifications",id:"31-power-domain-specifications",level:2},{value:"3.2 Decoupling Network Implementation",id:"32-decoupling-network-implementation",level:2},{value:"3.3 Grounding Strategy",id:"33-grounding-strategy",level:2},{value:"3.4 Switch-Mode Power Supply (SMPS) Circuit",id:"34-switch-mode-power-supply-smps-circuit",level:2},{value:"3.4.1 Topology",id:"341-topology",level:3},{value:"3.4.2 Passive Component Selection",id:"342-passive-component-selection",level:3},{value:"3.4.3 Layout Guidelines (AN5165 Compliance)",id:"343-layout-guidelines-an5165-compliance",level:3},{value:"3.5 Validation Metrics",id:"35-validation-metrics",level:2},{value:"Figure 1",id:"figure-1",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const i={h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"3-stm32-wb55-microcontroller-power-architecture",children:"3. STM32 WB55 Microcontroller Power Architecture"})}),"\n",(0,r.jsx)(i.h2,{id:"31-power-domain-specifications",children:"3.1 Power Domain Specifications"}),"\n",(0,r.jsx)(i.p,{children:"The STM32 WB55CEU microcontroller is designed with a sophisticated partitioned power architecture aimed at enhancing noise isolation and optimizing energy efficiency. This architecture delineates distinct power domains, each serving specific functional blocks within the microcontroller, thereby minimizing cross-interference and ensuring stable operation across various operational states. The power domains are specified as follows:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VDD (3.3V Digital):"})}),"\n",(0,r.jsx)(i.p,{children:"The VDD domain is the primary power supply for the microcontroller's core digital logic, General-Purpose Input/Output (GPIO) pins, and digital peripherals, including Serial Peripheral Interface (SPI), Inter-Integrated Circuit (I\xb2C), and Universal Asynchronous Receiver/Transmitter (UART). The current consumption for this domain is specified at 50 mA during active operation at 64 MHz, and it reduces to 1 \xb5A in shutdown mode. To ensure robust power delivery and mitigate high-frequency noise, each VDD pin is equipped with a 100 nF X7R Multilayer Ceramic Capacitor (MLCC) in an 0402 package rated for 10V. These capacitors are strategically placed within a 2 mm proximity to the Integrated Circuit (IC) to maintain low inductance and effective decoupling."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VDD_USB (3.3V):"})}),"\n",(0,r.jsx)(i.p,{children:"Dedicated to powering the USB 2.0 Physical Layer (PHY), the VDD_USB domain ensures that USB operations remain electrically isolated from the core digital circuitry. Isolation is achieved through the incorporation of a ferrite bead with a resistance of 600 \u03a9 at 100 MHz between the VDD and VDD_USB supplies. This ferrite bead functions as a high-frequency noise filter, preventing digital switching noise from propagating into the USB circuitry, thereby maintaining signal integrity and compliance with USB standards."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VDDA (3.3V Analog):"})}),"\n",(0,r.jsx)(i.p,{children:"The VDDA domain supplies power to analog components, including the Analog-to-Digital Converter (ADC), Digital-to-Analog Converter (DAC), and the internal voltage reference. To preserve the fidelity of analog signals and minimize noise coupling, the VDDA supply is subjected to a \u03c0-filter configuration comprising a 10 \u03a9 resistor and a combination of 100 nF and 1 \xb5F capacitors at the input. This filtering arrangement effectively attenuates high-frequency noise and stabilizes the analog supply voltage, ensuring precise analog signal processing."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VDD_RF (3.3V RF):"})}),"\n",(0,r.jsx)(i.p,{children:"Powering the 2.4 GHz RF transceiver, the VDD_RF domain is isolated from other digital domains to prevent RF noise from disrupting digital operations. The layout incorporates a guard ring with a spacing of 0.3 mm around the RF supply traces, effectively isolating them from adjacent digital nets. This isolation strategy reduces electromagnetic interference (EMI) and preserves the integrity of RF signals, which is critical for reliable Bluetooth Low Energy (BLE) communication."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VBAT (1.65\u20133.6V):"})}),"\n",(0,r.jsx)(i.p,{children:"The VBAT domain serves as a backup power supply for the Real-Time Clock (RTC) and SRAM retention, ensuring data persistence and accurate timekeeping during power outages or low-power states. A Schottky diode (BAT60A) is employed for diode isolation between VBAT and VDD, facilitating efficient power transfer while preventing reverse current flow. This isolation is crucial for maintaining the autonomy of the backup domain without introducing significant voltage drops or power losses."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"32-decoupling-network-implementation",children:"3.2 Decoupling Network Implementation"}),"\n",(0,r.jsx)(i.p,{children:"Effective decoupling is essential for maintaining power integrity and minimizing noise within the microcontroller's power domains. The decoupling strategy is bifurcated into local and bulk decoupling networks to address different frequency ranges and noise sources."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Local Decoupling:"})}),"\n",(0,r.jsx)(i.p,{children:"Local decoupling involves the placement of 100 nF MLCCs with C0G dielectric properties directly at each VDD pin, as illustrated in Figure 1(a). These capacitors are selected for their low Equivalent Series Inductance (ESL), which is critical for high-frequency decoupling. Utilizing via-in-pad techniques for capacitors in sizes 0402 or smaller further reduces inductance, enhancing the capacitors' effectiveness in filtering high-frequency noise. This proximity ensures that transient voltage spikes and high-frequency noise are swiftly mitigated, maintaining stable supply voltages for sensitive digital circuits."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Bulk Decoupling:"})}),"\n",(0,r.jsx)(i.p,{children:"The bulk decoupling network employs 4.7 \xb5F X5R MLCCs in an 0805 package, rated at 6.3V with an ESL below 0.5 nH. These capacitors are positioned at the output of the Switched-Mode Power Supply (SMPS) to stabilize the overall supply voltage and provide energy storage for transient loads. The low Equivalent Series Resistance (ESR) of these capacitors ensures loop stability, preventing oscillations and maintaining efficient power regulation under varying load conditions."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"33-grounding-strategy",children:"3.3 Grounding Strategy"}),"\n",(0,r.jsx)(i.p,{children:"A robust grounding strategy is pivotal for minimizing ground noise and ensuring reliable signal transmission across the Printed Circuit Board (PCB). The grounding approach for the STM32 WB55CEU microcontroller encompasses the following elements:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VSS Connections:"})}),"\n",(0,r.jsx)(i.p,{children:"All 14 VSS (ground) pins of the microcontroller are connected to a contiguous ground plane fabricated with 2 oz. copper to provide low-impedance paths for return currents. This continuous ground plane minimizes ground potential differences and reduces inductive and resistive losses. The thermal pad associated with the microcontroller is connected to the ground plane via a 4\xd74 via array, each with a diameter of 0.3 mm, ensuring effective thermal dissipation and robust electrical connectivity to the bottom-layer ground."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Partitioning:"})}),"\n",(0,r.jsx)(i.p,{children:"The grounding architecture segregates analog and digital grounds into separate domains\u2014Analog Ground (AGND) and Digital Ground (DGND), respectively. These domains are interconnected at a single-point star ground to prevent digital switching noise from contaminating the analog ground. Additionally, the RF ground is isolated using a 1 nH Murata inductor (LQW15AN1N0C00D), effectively decoupling RF return currents from the digital and analog grounds. This isolation is critical for maintaining signal integrity in RF operations and preventing EMI from affecting other functional blocks."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"34-switch-mode-power-supply-smps-circuit",children:"3.4 Switch-Mode Power Supply (SMPS) Circuit"}),"\n",(0,r.jsx)(i.p,{children:"The Switch-Mode Power Supply (SMPS) circuit within the STM32 WB55CEU microcontroller is integral to efficient power management, enabling dynamic voltage regulation and reducing power consumption through high-frequency switching. The SMPS implementation adheres to STM32 hardware design guidelines (AN5165) to ensure optimal performance and compliance with electromagnetic compatibility (EMC) standards."}),"\n",(0,r.jsx)(i.h3,{id:"341-topology",children:"3.4.1 Topology"}),"\n",(0,r.jsx)(i.p,{children:"The SMPS employs a buck converter topology, as depicted in Figure 1(b). This configuration steps down the input voltage to a lower output voltage, providing the necessary VCORE for the microcontroller's operation."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Input:"})}),"\n",(0,r.jsx)(i.p,{children:"The input to the buck converter is the 3.3V supply (VDD_SMPS), which is regulated to maintain a stable input voltage despite fluctuations in the main supply."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Output:"})}),"\n",(0,r.jsx)(i.p,{children:"The buck converter outputs a regulated 1.2V (VCORE) through an adjustable feedback loop (VFB_SMPS), ensuring precise voltage levels for the microcontroller's core operations."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Switching Frequency:"})}),"\n",(0,r.jsx)(i.p,{children:"The switching frequency is set at 4 MHz, configurable via the RCC_CFGR register. This high frequency allows for the use of smaller passive components, reducing PCB space and improving transient response."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"342-passive-component-selection",children:"3.4.2 Passive Component Selection"}),"\n",(0,r.jsx)(i.p,{children:"The selection of passive components is critical for the SMPS's efficiency and stability."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Inductors:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"L1:"})," A 10 nH inductor (Murata LQP15MN10N02D) in an 0402 package is utilized for high-frequency filtering, attenuating switching noise and smoothing the output voltage."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"L2:"})," A 10 \xb5H inductor (TDK VLS201610ET-100M) in an 0805 package serves as the energy storage element, maintaining continuous current flow during switching cycles."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Self-Resonant Frequency (SRF):"})}),"\n",(0,r.jsx)(i.p,{children:"Both inductors are selected to have an SRF exceeding 50 MHz, preventing parasitic resonance and ensuring stable operation at the 4 MHz switching frequency."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Capacitors:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"C_SMPS:"})," A 4.7 \xb5F X7R MLCC in an 0805 package with an ESL below 0.5 nH is employed at the SMPS output to stabilize the regulated voltage and filter out residual switching noise."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Placement:"})}),"\n",(0,r.jsx)(i.p,{children:"These capacitors are positioned within 5 mm of the SMPS pins (PF0, PF1) to minimize inductive loops and enhance filtering effectiveness."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"343-layout-guidelines-an5165-compliance",children:"3.4.3 Layout Guidelines (AN5165 Compliance)"}),"\n",(0,r.jsx)(i.p,{children:"Adherence to layout guidelines ensures that the SMPS operates within desired parameters and complies with EMC standards."}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Critical Paths:"})}),"\n",(0,r.jsx)(i.p,{children:"The Switch (SW) node, encompassing the connection from PF1 through L2 to C_SMPS, is maintained at a length of 10 mm or less. This constraint minimizes inductive and capacitive parasitics, reducing voltage overshoot and ringing, which are detrimental to SMPS stability."}),"\n",(0,r.jsx)(i.p,{children:"Parallel routing with RF or clock signals is strictly avoided to prevent coupling of switching noise into sensitive signal paths, thereby maintaining signal integrity across the PCB."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Thermal Relief:"})}),"\n",(0,r.jsx)(i.p,{children:"Inductor pads are connected to the ground plane via 0.5 mm thermal spokes. This design mitigates soldering stress by providing controlled thermal pathways, preventing thermal gradients that could lead to mechanical stress or solder joint failures."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"35-validation-metrics",children:"3.5 Validation Metrics"}),"\n",(0,r.jsx)(i.p,{children:"Validation of the power architecture is essential to ensure compliance with performance standards and design specifications. The following metrics are critical for assessing the efficacy of the power domains and SMPS circuit:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Power Integrity:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VDD Ripple:"})}),"\n",(0,r.jsx)(i.p,{children:"The ripple on the VDD supply must not exceed 30 mV peak-to-peak (mVpp) within a 20 MHz bandwidth under a 100 mA load. This criterion ensures stable voltage delivery to the digital core, minimizing the risk of operational instability or data corruption due to voltage fluctuations."}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"VDDA Noise:"})}),"\n",(0,r.jsx)(i.p,{children:"The noise on the VDDA supply is limited to 10 \xb5V root mean square (\xb5Vrms) across the frequency range of 10 Hz to 1 MHz. Low noise levels are imperative for maintaining the accuracy and precision of analog components such as ADCs and DACs."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"SMPS Efficiency:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The SMPS must achieve an efficiency of \u2265 88% at a 10 mA load and \u2265 92% at a 50 mA load. High efficiency reduces power loss and thermal dissipation, enhancing the overall energy efficiency of the system and prolonging battery life in portable applications."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Ground Impedance:"})}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"The ground impedance between VSS pins, measured using a 4-point probe at 1 kHz, must be less than 5 m\u03a9. Low ground impedance ensures minimal voltage drops and stable reference potentials across the microcontroller, which is essential for reliable operation of high-speed digital and RF circuits."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"figure-1",children:"Figure 1"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Figure 1(a):"})," Depicts the decoupling network for VDD pins, illustrating the placement of 100 nF MLCCs in close proximity to each VDD pin to facilitate effective high-frequency noise suppression."]}),"\n"]}),"\n",(0,r.jsxs)(i.li,{children:["\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Figure 1(b):"})," Illustrates the SMPS schematic, highlighting the arrangement of inductors (L1, L2) and the output capacitor (C_SMPS). This schematic provides a detailed view of the buck converter topology, showcasing the critical components and their interconnections essential for stable voltage regulation."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsx)(i.p,{children:"The power architecture of the STM32 WB55CEU microcontroller is meticulously engineered to ensure optimal performance, energy efficiency, and noise isolation across its various functional domains. By adhering to the STM32 hardware design guidelines (AN5165) and implementing robust decoupling, grounding, and power regulation strategies, the design effectively minimizes radiated emissions (CISPR 32 Class B) while maintaining signal integrity for BLE operations. The established validation metrics further guarantee that the power architecture meets stringent performance standards, ensuring reliable and efficient operation in advanced embedded applications."})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>o,x:()=>a});var t=n(6540);const r={},s=t.createContext(r);function o(e){const i=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:i},e.children)}}}]);